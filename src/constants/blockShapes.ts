import type { BlockShape } from "@/types/game";

/**
 * 블록 형태 정의 (2차원: 1 = 칸 존재, 0 = 빈칸)
 * 9x9 그리드에 맞춰 최대 9칸까지 사용 가능
 * 유사 블록끼리 그룹화: 1칸 → 2칸 → 3칸(가로/세로, ㄱㄴ) → 4칸(2x2, I, L, J, T, Z/S, 큰L, 작은L) → 5칸(5x1, 5칸L, +, T긴, U)
 * 총 43개, 인덱스 0~42 (큰큰 L 4방향, 5칸 L 4방향, T 긴 4방향 포함)
 */
export const BLOCK_SHAPES: BlockShape[] = [
  // ---- 1칸 ----
  [[1]], // 0: 1x1

  // ---- 2칸 ----
  [[1, 1]], // 1: 2x1 가로
  [[1], [1]], // 2: 2x1 세로

  // ---- 3칸 ----
  [[1, 1, 1]], // 3: 3x1 가로
  [[1], [1], [1]], // 4: 3x1 세로
  [
    [1, 1],
    [1, 0],
  ], // 5: ㄱ 왼위
  [
    [1, 1],
    [0, 1],
  ], // 6: ㄱ 오위
  [
    [1, 0],
    [1, 1],
  ], // 7: ㄴ 왼아래
  [
    [0, 1],
    [1, 1],
  ], // 8: ㄴ 오아래

  // ---- 4칸: 2x2, I ----
  [
    [1, 1],
    [1, 1],
  ], // 9: 2x2
  [[1, 1, 1, 1]], // 10: 4x1 가로 (I)
  [[1], [1], [1], [1]], // 11: 4x1 세로 (I)

  // ---- 4칸: L형 4방향 ----
  [
    [1, 1, 1],
    [1, 0, 0],
  ], // 12: L (발 아래 왼쪽)
  [
    [1, 0],
    [1, 0],
    [1, 1],
  ], // 13: L 90°
  [
    [0, 0, 1],
    [1, 1, 1],
  ], // 14: L 180°
  [
    [1, 1],
    [0, 1],
    [0, 1],
  ], // 15: L 270°

  // ---- 4칸: J형 4방향 ----
  [
    [1, 1, 1],
    [0, 0, 1],
  ], // 16: J (발 아래 오른쪽)
  [
    [0, 1],
    [0, 1],
    [1, 1],
  ], // 17: J 90°
  [
    [1, 0, 0],
    [1, 1, 1],
  ], // 18: J 180°
  [
    [1, 1],
    [1, 0],
    [1, 0],
  ], // 19: J 270°

  // ---- 4칸: T형 4방향 ----
  [
    [1, 1, 1],
    [0, 1, 0],
  ], // 20: T (발 아래)
  [
    [1, 0],
    [1, 1],
    [1, 0],
  ], // 21: T 90°
  [
    [0, 1, 0],
    [1, 1, 1],
  ], // 22: T 180°
  [
    [0, 1],
    [1, 1],
    [0, 1],
  ], // 23: T 270°

  // ---- 4칸: Z 2방향, S 2방향 ----
  [
    [1, 1, 0],
    [0, 1, 1],
  ], // 24: Z (가로)
  [
    [0, 1],
    [1, 1],
    [1, 0],
  ], // 25: Z 90° (세로)
  [
    [0, 1, 1],
    [1, 1, 0],
  ], // 26: S (가로)
  [
    [1, 0],
    [1, 1],
    [0, 1],
  ], // 27: S 90° (세로)

  // ---- 5칸: 큰큰 L 2방향 ----
  [
    [1, 0],
    [1, 1],
    [1, 1],
  ], // 28: 5칸 큰 L
  [
    [1, 1, 1],
    [1, 1, 0],
  ], // 29: 5칸 큰 L 90°
  [
    [1, 1],
    [1, 1],
    [0, 1],
  ], // 30: 5칸 큰 L 180°
  [
    [0, 1, 1],
    [1, 1, 1],
  ], // 31: 5칸 큰 L 270°

  // ---- 5칸: 5칸 L형 4방향 (큰 L) ----
  [
    [1, 1, 0],
    [1, 1, 1],
  ], // 32: 5칸 L (= 큰 L)
  [
    [1, 1],
    [1, 1],
    [1, 0],
  ], // 33: 5칸 L 90°
  [
    [1, 1, 1],
    [0, 1, 1],
  ], // 34: 5칸 L 180°
  [
    [0, 1],
    [1, 1],
    [1, 1],
  ], // 35: 5칸 L 270°

  // ---- 5칸: 5x1 ----
  [[1, 1, 1, 1, 1]], // 36: 5x1 가로
  [[1], [1], [1], [1], [1]], // 37: 5x1 세로

  // ---- 5칸: +, T긴, U ----
  [
    [0, 1, 0],
    [1, 1, 1],
    [0, 1, 0],
  ], // 38: + (플러스)
  [
    [1, 1, 1],
    [0, 1, 0],
    [0, 1, 0],
  ], // 39: T 긴 (발 아래)
  [
    [0, 0, 1],
    [1, 1, 1],
    [0, 0, 1],
  ], // 40: T 긴 (발 오른쪽 90°)
  [
    [0, 1, 0],
    [0, 1, 0],
    [1, 1, 1],
  ], // 41: T 긴 (발 위 180°)
  [
    [1, 0, 0],
    [1, 1, 1],
    [1, 0, 0],
  ], // 42: T 긴 (발 왼쪽 270°)
];

/** 블록 색상 (선명한 파스텔) — hue 균등 분포, 채도·밝기로 배경 대비 확보 */
function hslToHex(h: number, s: number, l: number): string {
  s /= 100;
  l /= 100;
  const a = s * Math.min(l, 1 - l);
  const f = (n: number) => {
    const k = (n + h / 30) % 12;
    return l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
  };
  const r = Math.round(f(0) * 255);
  const g = Math.round(f(8) * 255);
  const b = Math.round(f(4) * 255);
  return "#" + [r, g, b].map((x) => x.toString(16).padStart(2, "0")).join("");
}
const BLOCK_SATURATION = 72;
const BLOCK_LIGHTNESS = 72;
export const BLOCK_COLORS: string[] = Array.from(
  { length: BLOCK_SHAPES.length },
  (_, i) =>
    hslToHex(
      (i * 360) / BLOCK_SHAPES.length,
      BLOCK_SATURATION,
      BLOCK_LIGHTNESS,
    ),
);

export function getRandomBlockId(seed: number): number {
  return Math.abs(Math.floor(Math.sin(seed) * 1e6)) % BLOCK_SHAPES.length;
}

export function getBlockColor(index: number): string {
  return BLOCK_COLORS[index % BLOCK_COLORS.length];
}
