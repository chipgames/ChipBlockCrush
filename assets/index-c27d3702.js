var gt=Object.defineProperty;var mt=(e,t,n)=>t in e?gt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var pt=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Le=(e,t,n)=>(mt(e,typeof t!="symbol"?t+"":t,n),n);var _e=(e,t,n)=>new Promise((a,o)=>{var l=d=>{try{f(n.next(d))}catch(u){o(u)}},c=d=>{try{f(n.throw(d))}catch(u){o(u)}},f=d=>d.done?a(d.value):Promise.resolve(d.value).then(l,c);f((n=n.apply(e,t)).next())});import{r as i,a as nt,R as bt}from"./vendor-ffc9ac40.js";import{W as yt,q as wt}from"./helmet-6da975a7.js";var nn=pt($e=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}})();var ot={exports:{}},Ce={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vt=i,St=Symbol.for("react.element"),kt=Symbol.for("react.fragment"),xt=Object.prototype.hasOwnProperty,Ct=vt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,jt={key:!0,ref:!0,__self:!0,__source:!0};function st(e,t,n){var a,o={},l=null,c=null;n!==void 0&&(l=""+n),t.key!==void 0&&(l=""+t.key),t.ref!==void 0&&(c=t.ref);for(a in t)xt.call(t,a)&&!jt.hasOwnProperty(a)&&(o[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps,t)o[a]===void 0&&(o[a]=t[a]);return{$$typeof:St,type:e,key:l,ref:c,props:o,_owner:Ct.current}}Ce.Fragment=kt;Ce.jsx=st;Ce.jsxs=st;ot.exports=Ce;var s=ot.exports,Ie={},We=nt;Ie.createRoot=We.createRoot,Ie.hydrateRoot=We.hydrateRoot;class Et extends i.Component{constructor(){super(...arguments);Le(this,"state",{hasError:!1})}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,a){console.error("[ChipBlockCrush]",n,a)}render(){return this.state.hasError?s.jsxs("div",{className:"error-boundary",children:[s.jsx("h2",{children:"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"}),s.jsx("p",{children:"íŽ˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ ì£¼ì„¸ìš”."}),s.jsx("button",{type:"button",onClick:()=>window.location.reload(),children:"ìƒˆë¡œê³ ì¹¨"})]}):this.props.children}}const Rt="modulepreload",Nt=function(e){return"/ChipBlockCrush/"+e},He={},ge=function(t,n,a){if(!n||n.length===0)return t();const o=document.getElementsByTagName("link");return Promise.all(n.map(l=>{if(l=Nt(l),l in He)return;He[l]=!0;const c=l.endsWith(".css"),f=c?'[rel="stylesheet"]':"";if(!!a)for(let h=o.length-1;h>=0;h--){const S=o[h];if(S.href===l&&(!c||S.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${f}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":Rt,c||(u.as="script",u.crossOrigin=""),u.href=l,document.head.appendChild(u),c)return new Promise((h,S)=>{u.addEventListener("load",h),u.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${l}`)))})})).then(()=>t()).catch(l=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l})},Lt=(e,t)=>{const n=e[t];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((a,o)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(o.bind(null,new Error("Unknown variable dynamic import: "+t)))})},ke=["ko","en","ja","zh"],_t="ko",Mt={ko:"í•œêµ­ì–´",en:"English",ja:"æ—¥æœ¬èªž",zh:"ä¸­æ–‡"},me={debug:(...e)=>{},info:(...e)=>console.info("[ChipBlockCrush]",...e),warn:(...e)=>console.warn("[ChipBlockCrush]",...e),error:(...e)=>console.error("[ChipBlockCrush]",...e)},Ye="language";class Ue{detectBrowserLanguage(){const t=navigator.language.split("-")[0];return ke.includes(t)?t:_t}getStoredLanguage(){try{return localStorage.getItem(Ye)}catch(t){return me.error("Failed to get stored language",{error:t}),null}}setLanguage(t){if(ke.includes(t))try{localStorage.setItem(Ye,t),window.dispatchEvent(new CustomEvent("languageChanged",{detail:t})),me.debug("Language changed",{language:t})}catch(n){me.error("Failed to set language",{error:n,language:t})}}getCurrentLanguage(){const t=this.getStoredLanguage();return t&&ke.includes(t)?t:this.detectBrowserLanguage()}}const Me={},K=()=>{const[e,t]=i.useState(()=>new Ue().getCurrentLanguage()),[n,a]=i.useState(null),[o,l]=i.useState(!0);return i.useEffect(()=>{(()=>_e($e,null,function*(){l(!0);try{if(Me[e]){a(Me[e]),l(!1);return}const u=yield Lt(Object.assign({"../locales/en.json":()=>ge(()=>import("./en-4bc95cef.js"),[]),"../locales/ja.json":()=>ge(()=>import("./ja-784fba8f.js"),[]),"../locales/ko.json":()=>ge(()=>import("./ko-8249d8f0.js"),[]),"../locales/zh.json":()=>ge(()=>import("./zh-5a914837.js"),[])}),`../locales/${e}.json`);Me[e]=u.default,a(u.default)}catch(u){try{const h=yield ge(()=>import("./ko-8249d8f0.js"),[]);a(h.default)}catch(h){a({})}}finally{l(!1)}}))()},[e]),i.useEffect(()=>{const d=u=>{const h=u;h.detail&&(h.detail==="ko"||h.detail==="en"||h.detail==="ja"||h.detail==="zh")&&t(h.detail)};return window.addEventListener("languageChanged",d),()=>window.removeEventListener("languageChanged",d)},[]),{language:e,setLanguage:d=>{new Ue().setLanguage(d),(d==="ko"||d==="en"||d==="ja"||d==="zh")&&t(d)},t:d=>{if(o||!n)return d;const u=d.split(".");let h=n;for(const S of u)if(h=h==null?void 0:h[S],h===void 0)break;return(typeof h=="string"?h:d)||d},isLoading:o}},Be=i.memo(()=>{const{language:e,setLanguage:t}=K();return s.jsx("select",{className:"language-selector",value:e,onChange:n=>t(n.target.value),"aria-label":"ì–¸ì–´ ì„ íƒ",children:ke.map(n=>s.jsx("option",{value:n,children:Mt[n]},n))})});Be.displayName="LanguageSelector";const qe="chipBlockCrush_",X={get(e,t={}){var a,o;const n=qe+e;try{const l=localStorage.getItem(n);return l===null?(a=t.fallback)!=null?a:null:JSON.parse(l)}catch(l){return t.silent||me.warn("storage get failed",n,l),(o=t.fallback)!=null?o:null}},set(e,t,n={}){const a=qe+e;try{localStorage.setItem(a,JSON.stringify(t))}catch(o){n.silent||me.warn("storage set failed",a,o)}}},Te="theme",Tt=()=>{if(typeof window=="undefined")return"dark";try{return window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}catch(e){return"dark"}},Pe=e=>{if(typeof document=="undefined")return;document.documentElement.setAttribute("data-theme",e);const t=document.querySelector('meta[name="theme-color"]');t&&t.setAttribute("content",e==="light"?"#f5f5f8":"#1a1a2e")},rt=()=>{const[e,t]=i.useState(()=>{const o=X.get(Te,{fallback:null,silent:!0});return o==="light"||o==="dark"?o:Tt()}),n=i.useCallback(()=>{t(o=>{const l=o==="light"?"dark":"light";return X.set(Te,l,{silent:!0}),Pe(l),l})},[]),a=i.useCallback(o=>{t(o),X.set(Te,o,{silent:!0}),Pe(o)},[]);return i.useEffect(()=>{Pe(e)},[e]),{theme:e,toggleTheme:n,setTheme:a,isLight:e==="light",isDark:e==="dark"}},lt=i.memo(()=>{const{t:e}=K(),{theme:t,toggleTheme:n}=rt(),a=t==="light";return s.jsx("button",{type:"button",className:"theme-toggle",onClick:n,title:e(a?"header.darkMode":"header.lightMode"),"aria-label":e(a?"header.darkMode":"header.lightMode"),children:a?"ðŸŒ™":"â˜€ï¸"})});lt.displayName="ThemeToggle";class Pt{constructor(){Le(this,"enabled",!0)}setEnabled(t){this.enabled=t}playClick(){this.enabled}}const Xe=new Pt,at=i.memo(({onNavigate:e,onStartGame:t})=>{const{t:n}=K(),[a,o]=i.useState(()=>{var u;return(u=X.get("soundEnabled",{fallback:!0,silent:!0}))!=null?u:!0}),[l,c]=i.useState(!1);i.useEffect(()=>{Xe.setEnabled(a),X.set("soundEnabled",a,{silent:!0})},[a]),i.useEffect(()=>(document.body.style.overflow=l?"hidden":"",()=>{document.body.style.overflow=""}),[l]);const f=u=>{e==null||e(u),c(!1)},d=()=>{o(u=>!u),a&&Xe.playClick()};return s.jsx("header",{className:"header",children:s.jsxs("div",{className:"header-content",children:[s.jsxs("div",{className:"header-logo",onClick:()=>f("menu"),role:"button",tabIndex:0,onKeyDown:u=>u.key==="Enter"&&f("menu"),children:[s.jsx("img",{src:"/ChipBlockCrush/ChipGames_Logo.png",alt:n("header.logo"),className:"header-logo-img"}),s.jsx("span",{className:"header-game-title",children:n("header.gameTitle")})]}),l&&s.jsx("div",{className:"header-nav-overlay",onClick:()=>c(!1),"aria-hidden":!0}),s.jsxs("nav",{className:`header-nav ${l?"mobile-open":""}`,children:[s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>t?t():f("menu"),children:n("header.playGame")}),s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>f("guide"),children:n("header.guide")}),s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>f("help"),children:n("header.help")}),s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>f("about"),children:n("header.about")})]}),s.jsxs("div",{className:"header-right",children:[s.jsx(lt,{}),s.jsx("button",{type:"button",className:"header-sound-button",onClick:d,title:n(a?"header.soundOff":"header.soundOn"),"aria-label":n(a?"header.soundOff":"header.soundOn"),children:a?"ðŸ”Š":"ðŸ”‡"}),s.jsx(Be,{}),s.jsxs("button",{type:"button",className:"header-hamburger",onClick:()=>c(u=>!u),"aria-label":"ë©”ë‰´","aria-expanded":l,children:[s.jsx("span",{className:`hamburger-line ${l?"active":""}`}),s.jsx("span",{className:`hamburger-line ${l?"active":""}`}),s.jsx("span",{className:`hamburger-line ${l?"active":""}`})]})]})]})})});at.displayName="Header";const It="1.0.1",ct=i.memo(()=>{const{t:e}=K();return s.jsx("footer",{className:"footer",role:"contentinfo",children:s.jsxs("div",{className:"footer-content",children:[s.jsxs("nav",{className:"footer-links",children:[s.jsx("a",{href:"#privacy",className:"footer-link",children:e("footer.privacy")}),s.jsx("a",{href:"#contact",className:"footer-link",children:e("footer.contact")})]}),s.jsx("div",{className:"footer-center",children:s.jsx(Be,{})}),s.jsxs("div",{className:"footer-copyright",children:[e("footer.copyright")," | v",It]})]})})});ct.displayName="Footer";const Ot=({children:e})=>s.jsx("div",{className:"game-container",children:e}),At=({onNavigate:e,onStartGame:t})=>{const{t:n}=K();return s.jsxs("div",{className:"menu-screen",children:[s.jsx("div",{className:"menu-logo-wrap",children:s.jsx("img",{src:"/ChipBlockCrush/ChipGames_Logo.png",alt:n("header.logo"),className:"menu-logo"})}),s.jsx("h1",{className:"menu-title",children:n("header.gameTitle")}),s.jsx("p",{className:"menu-desc",children:n("menu.subtitle")}),s.jsx("button",{type:"button",className:"menu-play-btn",onClick:t,children:n("header.playGame")}),s.jsxs("nav",{className:"menu-links",children:[s.jsx("button",{type:"button",className:"menu-link",onClick:()=>e("guide"),children:n("header.guide")}),s.jsx("button",{type:"button",className:"menu-link",onClick:()=>e("help"),children:n("header.help")}),s.jsx("button",{type:"button",className:"menu-link",onClick:()=>e("about"),children:n("header.about")})]})]})},Bt=({onNavigate:e})=>{const{t}=K();return s.jsxs("div",{className:"guide-screen",children:[s.jsx("h1",{className:"guide-title",children:t("guide.title")}),s.jsx("p",{className:"guide-description",children:t("guide.description")}),s.jsxs("ol",{className:"guide-steps",children:[s.jsx("li",{children:t("guide.step1")}),s.jsx("li",{children:t("guide.step2")}),s.jsx("li",{children:t("guide.step3")})]}),s.jsx("button",{type:"button",className:"guide-back",onClick:()=>e("stageSelect"),children:t("header.playGame")})]})},zt=({onNavigate:e})=>{const{t}=K();return s.jsxs("div",{className:"help-screen",children:[s.jsx("h1",{className:"help-title",children:t("help.title")}),s.jsxs("div",{className:"help-faq",children:[s.jsx("p",{children:t("help.faq1")}),s.jsx("p",{children:t("help.faq2")})]}),s.jsx("button",{type:"button",className:"help-back",onClick:()=>e("stageSelect"),children:t("header.playGame")})]})},$t=({onNavigate:e})=>{const{t}=K();return s.jsxs("div",{className:"about-screen",children:[s.jsx("h1",{className:"about-title",children:t("about.title")}),s.jsx("p",{className:"about-description",children:t("about.description")}),s.jsx("button",{type:"button",className:"about-back",onClick:()=>e("stageSelect"),children:t("header.playGame")})]})},Dt=16/9;function Gt(e,t){const n=Dt,a=e/t;let o,l;return a>n?(l=t,o=t*n):(o=e,l=e/n),{width:Math.floor(o),height:Math.floor(l)}}const ze=[[[1]],[[1,1]],[[1],[1]],[[1,1,1]],[[1],[1],[1]],[[1,1],[1,0]],[[1,1],[0,1]],[[1,0],[1,1]],[[0,1],[1,1]],[[1,1],[1,1]],[[1,1,1,1]],[[1],[1],[1],[1]],[[1,1,1],[1,0,0]],[[1,1,1],[0,0,1]],[[1,1,1],[0,1,0]],[[1,0],[1,1],[1,0]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]],[[1,1],[1,1],[1,0]],[[1,1],[0,1],[0,1]],[[1,1,1,1,1]],[[1],[1],[1],[1],[1]],[[1,1,1],[1,1,0]],[[1,1,1],[0,1,1]],[[0,1,0],[1,1,1],[0,1,0]],[[1,1,1],[0,1,0],[0,1,0]],[[1,0,0],[1,1,1],[1,0,0]]],Ke=["#a8b5ff","#c5a3ff","#ffb3e6","#7fdfd4","#ffd89b","#ff9f9f","#b5c4ff","#d4b3ff","#ffc4e6","#8fefdf","#ffe0ab","#ffafaf","#a8e6cf","#dda0dd","#87ceeb","#f0e68c"];function Ve(e){return Math.abs(Math.floor(Math.sin(e)*1e6))%ze.length}function xe(e){return Ke[e%Ke.length]}const Oe=9,Je=3,Ft=10,Ze=[0,20,30,40,50,60,70,80,90,100];function Qe(e=Oe){return Array.from({length:e},()=>Array(e).fill(0))}function ie(e,t,n,a){var f,d;const o=t.length,l=(d=(f=t[0])==null?void 0:f.length)!=null?d:0,c=e.length;if(n<0||a<0||n+o>c||a+l>c)return!1;for(let u=0;u<o;u++)for(let h=0;h<l;h++)if(t[u][h]&&e[n+u][a+h]!==0)return!1;return!0}const it=15;function Wt(e,t,n,a,o,l){var h,S;const c=e.map(w=>[...w]),f=t.length,d=(S=(h=t[0])==null?void 0:h.length)!=null?S:0,u=o<<4|l&it;for(let w=0;w<f;w++)for(let R=0;R<d;R++)t[w][R]&&(c[n+w][a+R]=u);return c}function Ht(e){return e>0?e&it:0}function ut(e){var o,l;let t=0,n=0,a=0;for(let c=0;c<e.length;c++)for(let f=0;f<((l=(o=e[0])==null?void 0:o.length)!=null?l:0);f++)e[c][f]&&(t+=c,n+=f,a++);return a===0?{row:0,col:0}:{row:Math.floor(t/a),col:Math.floor(n/a)}}const ve=2;function et(e,t,n,a){const o=ut(t),l=n-o.row,c=a-o.col;let f=null,d=1/0;for(let u=-ve;u<=ve;u++)for(let h=-ve;h<=ve;h++){const S=l+u,w=c+h;if(!ie(e,t,S,w))continue;const R=S+o.row,A=w+o.col,k=Math.abs(R-n)+Math.abs(A-a);k<d&&(d=k,f={row:S,col:w})}return f}function Yt(e){const t=e.length,n=[],a=[];for(let o=0;o<t;o++){let l=!0,c=!0;for(let f=0;f<t;f++)e[o][f]===0&&(l=!1),e[f][o]===0&&(c=!1);l&&n.push(o),c&&a.push(o)}return{rows:n,cols:a}}function Ut(e,t,n){const a=e.length,o=e.map(l=>[...l]);for(const l of t)for(let c=0;c<a;c++)o[l][c]=0;for(const l of n)for(let c=0;c<a;c++)o[c][l]=0;return o}function qt(e,t){var o;const n=e*Ft,a=(o=Ze[Math.min(t,Ze.length-1)])!=null?o:0;return n+a}function Xt(e,t){var a,o;const n=e.length;for(const l of t){const c=ze[l];if(!c)continue;const f=c.length,d=(o=(a=c[0])==null?void 0:a.length)!=null?o:0;for(let u=0;u<=n-f;u++)for(let h=0;h<=n-d;h++)if(ie(e,c,u,h))return!0}return!1}function Ae(e){var t;return(t=ze[e])!=null?t:null}function Kt(e,t,n,a){const l=Math.min(e/400,t/300,1.2),c=Math.max(28,36*l),f=Math.max(56,72*l),d=Math.max(56,70*l),u=Math.max(22,28*l),h=Math.max(44,52*l),S=4,w=e-f-8*2,R=t-c-8*2,A=Math.min(w/n,R/n),k=8+(w-A*n)/2,j=c+8+(R-A*n)/2,M={x:8,y:8,w:d,h:u},z=[],I=e-f+(f-h)/2;let O=c+8;for(let Y=0;Y<a;Y++)z.push({x:I,y:O,w:h,h}),O+=h+S;return{padding:8,scale:l,topBarHeight:c,rightPanelWidth:f,menuRect:M,trayRects:z,offsetX:k,offsetY:j,cellSize:A,gridSize:n,traySlotSize:h}}const dt=i.forwardRef(({grid:e,onCellClick:t,preview:n,score:a=0,scoreLabel:o,onBack:l,backLabel:c,placeHintLabel:f,currentBlockIndices:d=[],selectedIndex:u=null,onBlockTrayClick:h,onBlockTrayPointerDown:S,onLayout:w,isLandscapeMode:R=!1},A)=>{const k=i.useRef(null),j=i.useRef(null),M=i.useRef(null),z=i.useRef(R);z.current=R;const I=e.length;i.useImperativeHandle(A,()=>({getCellFromPoint(r,v){const p=j.current;if(!p||!M.current)return null;const b=p.getBoundingClientRect();let g=r-b.left,x=v-b.top;if(z.current){const C=parseInt(p.style.width||"0",10),U=parseInt(p.style.height||"0",10);if(C&&U){const ae=r-b.left;g=v-b.top,x=U-ae}}const E=M.current,N=Math.floor((g-E.offsetX)/E.cellSize),m=Math.floor((x-E.offsetY)/E.cellSize);return m>=0&&m<E.gridSize&&N>=0&&N<E.gridSize?{row:m,col:N}:null},getCellSize(){var r,v;return(v=(r=M.current)==null?void 0:r.cellSize)!=null?v:24}}),[]);const O=i.useCallback((r,v,p)=>{var ce,De;const b=Math.max(1,d.length),g=Kt(v,p,I,b);M.current=g,w==null||w({cellSize:g.cellSize});const{padding:x,scale:E,rightPanelWidth:N,menuRect:m,trayRects:C,offsetX:U,offsetY:ae}=g,be=8;r.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--canvas-bg").trim()||"#1a1a1a",r.fillRect(0,0,v,p);const ee=document.documentElement.getAttribute("data-theme")==="light",je=ee?"rgba(220, 222, 235, 0.95)":"rgba(40, 42, 62, 0.95)",Ee=ee?"rgba(124, 138, 255, 0.55)":"rgba(168, 181, 255, 0.5)",y=ee?"rgba(0,0,0,0.03)":"rgba(255,255,255,0.04)",T=ee?"rgba(0,0,0,0.12)":"rgba(255,255,255,0.22)",q=ee?"#2d2d2d":"#e8e8e8",V=ee?"rgba(168, 181, 255, 0.35)":"rgba(102, 126, 234, 0.4)",G=ee?"rgba(124, 138, 255, 0.6)":"rgba(168, 181, 255, 0.6)",J=Math.max(10,12*E);r.font=`600 ${J}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,r.textAlign="left",r.textBaseline="middle",l&&c&&(r.fillStyle=V,r.strokeStyle=G,r.lineWidth=2,typeof r.roundRect=="function"?(r.beginPath(),r.roundRect(m.x,m.y,m.w,m.h,8),r.fill(),r.stroke()):(r.fillRect(m.x,m.y,m.w,m.h),r.strokeRect(m.x,m.y,m.w,m.h)),r.fillStyle=q,r.textAlign="center",r.fillText(c,m.x+m.w/2,m.y+m.h/2),r.textAlign="left");const L=m.x+m.w+x,W=m.y+m.h/2;r.textAlign="left",r.fillStyle=q,r.fillText(o!=null?`${o}: ${a}`:String(a),L,W,v-L-N-x),d.forEach((te,ne)=>{var he,fe;const P=C[ne];if(!P)return;const D=Ae(te);if(u===ne&&(r.fillStyle="rgba(168, 181, 255, 0.25)",r.strokeStyle="rgba(168, 181, 255, 0.8)",r.lineWidth=2,typeof r.roundRect=="function"&&(r.beginPath(),r.roundRect(P.x-2,P.y-2,P.w+4,P.h+4,10),r.fill(),r.stroke())),D){const Re=D.length,Ne=(fe=(he=D[0])==null?void 0:he.length)!=null?fe:0,le=Math.min((P.w-8)/Ne,(P.h-8)/Re,14),ht=P.x+(P.w-Ne*le)/2,ft=P.y+(P.h-Re*le)/2;r.fillStyle=xe(te),r.strokeStyle="rgba(255,255,255,0.4)",r.lineWidth=1;for(let ye=0;ye<Re;ye++)for(let we=0;we<Ne;we++)if(D[ye][we]){const Ge=ht+we*le+1,Fe=ft+ye*le+1;r.fillRect(Ge,Fe,le-2,le-2),r.strokeRect(Ge,Fe,le-2,le-2)}}});const H=g.cellSize*I,F=g.cellSize*I,_=U-2,$=ae-2,se=H+4,de=F+4;r.beginPath(),typeof r.roundRect=="function"?r.roundRect(_,$,se,de,be):r.rect(_,$,se,de),r.fillStyle=je,r.fill(),r.strokeStyle=Ee,r.lineWidth=3,r.stroke();for(let te=0;te<I;te++)for(let ne=0;ne<I;ne++){const P=U+ne*g.cellSize,D=ae+te*g.cellSize,re=e[te][ne];re>0?(r.fillStyle=xe(Ht(re)),r.fillRect(P+2,D+2,g.cellSize-4,g.cellSize-4),r.strokeStyle="rgba(255,255,255,0.35)",r.lineWidth=1,r.strokeRect(P+2,D+2,g.cellSize-4,g.cellSize-4)):(r.fillStyle=y,r.fillRect(P+1,D+1,g.cellSize-2,g.cellSize-2),r.strokeStyle=T,r.lineWidth=1,r.strokeRect(P+1,D+1,g.cellSize-2,g.cellSize-2))}if(n&&n.shape){const te=n.colorIndex!==void 0?xe(n.colorIndex):"rgba(168, 181, 255, 0.6)";r.fillStyle=te,r.globalAlpha=.7,r.strokeStyle="rgba(255,255,255,0.6)",r.lineWidth=2;const ne=n.shape.length,P=(De=(ce=n.shape[0])==null?void 0:ce.length)!=null?De:0;for(let D=0;D<ne;D++)for(let re=0;re<P;re++)if(n.shape[D][re]){const he=U+(n.col+re)*g.cellSize+2,fe=ae+(n.row+D)*g.cellSize+2;r.fillRect(he,fe,g.cellSize-4,g.cellSize-4),r.strokeRect(he,fe,g.cellSize-4,g.cellSize-4)}r.globalAlpha=1}},[e,I,n,a,o,c,l,d,u,w]);i.useEffect(()=>{const r=k.current,v=j.current;if(!r||!v)return;const p=v.getContext("2d");if(!p)return;const b=()=>{const x=r.clientWidth,E=r.clientHeight,{width:N,height:m}=Gt(x,E),C=window.devicePixelRatio||1;v.width=N*C,v.height=m*C,v.style.width=`${N}px`,v.style.height=`${m}px`,p.setTransform(1,0,0,1,0,0),p.scale(C,C),O(p,N,m)};b();const g=new ResizeObserver(b);return g.observe(r),()=>g.disconnect()},[O]),i.useEffect(()=>{const r=j.current;if(!r)return;const v=r.getContext("2d");if(!v)return;const p=parseInt(r.style.width||"0",10),b=parseInt(r.style.height||"0",10);p&&b&&O(v,p,b)},[e,O]);const Y=i.useCallback((r,v)=>{const p=j.current;if(!p)return null;const b=p.getBoundingClientRect(),g=r-b.left,x=v-b.top;if(!R)return{px:g,py:x};const E=parseInt(p.style.width||"0",10),N=parseInt(p.style.height||"0",10);if(!E||!N)return{px:g,py:x};const m=x,C=N-g;return{px:m,py:C}},[R]),B=i.useCallback(r=>{const v="touches"in r?r.touches[0].clientX:r.clientX,p="touches"in r?r.touches[0].clientY:r.clientY,b=Y(v,p);if(!b||!M.current||!S)return;const x=M.current.trayRects.findIndex(E=>b.px>=E.x&&b.px<=E.x+E.w&&b.py>=E.y&&b.py<=E.y+E.h);x>=0&&S(x,v,p)},[Y,S]),oe=i.useCallback((r,v)=>{const p=Y(r,v);if(!p)return;const{px:b,py:g}=p,x=M.current;if(!x)return;if(l&&c){const C=x.menuRect;if(b>=C.x&&b<=C.x+C.w&&g>=C.y&&g<=C.y+C.h){l();return}}const E=x.trayRects.findIndex(C=>b>=C.x&&b<=C.x+C.w&&g>=C.y&&g<=C.y+C.h);if(E>=0&&h){h(E);return}const N=Math.floor((b-x.offsetX)/x.cellSize),m=Math.floor((g-x.offsetY)/x.cellSize);t&&m>=0&&m<x.gridSize&&N>=0&&N<x.gridSize&&t(m,N)},[Y,l,c,h,t]),Z=i.useCallback(r=>{oe(r.clientX,r.clientY)},[oe]),Q=i.useRef(null),ue=i.useCallback(r=>{Q.current={x:r.touches[0].clientX,y:r.touches[0].clientY,t:Date.now()}},[]),pe=i.useCallback(r=>{const v=Q.current;if(Q.current=null,!v||!r.changedTouches[0])return;const p=r.changedTouches[0].clientX-v.x,b=r.changedTouches[0].clientY-v.y;Date.now()-v.t<=400&&p*p+b*b<=400&&(r.preventDefault(),oe(r.changedTouches[0].clientX,r.changedTouches[0].clientY))},[oe]);return s.jsx("div",{ref:k,className:"block-crush-canvas-wrap",children:s.jsx("canvas",{ref:j,className:"block-crush-canvas",onClick:Z,onMouseDown:B,onTouchStart:r=>{B(r),ue(r)},onTouchEnd:pe,"aria-label":f})})});dt.displayName="BlockCrushCanvas";const tt="landscapeMode",Vt=({stageNumber:e,onBack:t})=>{const{t:n}=K(),a=i.useRef(null),[o,l]=i.useState(()=>Qe(Oe)),[c,f]=i.useState([]),[d,u]=i.useState(null),[h,S]=i.useState(0),[w,R]=i.useState(!1),[A,k]=i.useState(1),[j,M]=i.useState(()=>{if(typeof window=="undefined")return!1;const y=X.get(tt,{fallback:!1,silent:!0});return y!=null?y:!1}),[z,I]=i.useState(()=>typeof window=="undefined"?!1:window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0),[O,Y]=i.useState(null),[B,oe]=i.useState(null),[Z,Q]=i.useState(null),[ue,pe]=i.useState(null),[r,v]=i.useState(28),p=i.useRef(null),b=i.useRef(null),g=i.useRef(null),x=i.useRef(null),E=8,N=e*1e3,m=i.useCallback(()=>{const y=[];for(let T=0;T<Je;T++)y.push(Ve(N+Date.now()+T));f(y)},[N]);i.useEffect(()=>{m()},[m]);const C=i.useCallback(()=>{const y=!j;M(y),X.set(tt,y,{silent:!0})},[j]);i.useEffect(()=>{const y=()=>{typeof window!="undefined"&&I(window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0)};return window.addEventListener("resize",y),window.addEventListener("orientationchange",y),()=>{window.removeEventListener("resize",y),window.removeEventListener("orientationchange",y)}},[]),i.useEffect(()=>{if(c.length===0)return;Xt(o,c)||R(!0)},[o,c]);const U=i.useCallback((y,T,q)=>{const V=c[q],G=Ae(V);if(!G||!ie(o,G,y,T))return;let J=Wt(o,G,y,T,A,V);k(_=>_+1);let L=0;for(;;){const{rows:_,cols:$}=Yt(J);if(_.length===0&&$.length===0)break;L+=_.length+$.length,J=Ut(J,_,$)}const W=G.flat().filter(Boolean).length,H=qt(W,L);S(_=>_+H),l(J);const F=c.filter((_,$)=>$!==q);F.length<Je&&F.push(Ve(N+Date.now()+F.length)),f(F),u(null)},[o,c,A,N]),ae=i.useCallback((y,T)=>{if(!w&&d!==null){U(y,T,d);return}},[w,d,U]),be=i.useCallback((y,T,q)=>{if(w)return;const V=c[y],G=Ae(V);G&&(Y({x:T,y:q,index:y,shapeIdx:V,shape:G}),x.current={index:y})},[c,w]),ee=i.useCallback(y=>{w||u(T=>T===y?null:y)},[w]);g.current=B,p.current=Z,i.useEffect(()=>{if(!O&&!B)return;const y=(L,W)=>{var F;if(pe({x:L,y:W}),O&&!B){const _=L-O.x,$=W-O.y;if(Math.sqrt(_*_+$*$)>=E){const se={index:O.index,shapeIdx:O.shapeIdx,shape:O.shape};oe(se),g.current=se,Y(null),x.current=null}}const H=g.current;if(H){const _=(F=a.current)==null?void 0:F.getCellFromPoint(L,W);if(_){b.current=_;const $=ut(H.shape),se=_.row-$.row,de=_.col-$.col;let ce=ie(o,H.shape,se,de)?{row:se,col:de}:et(o,H.shape,_.row,_.col);ce?(Q(ce),p.current=ce):(Q(null),p.current=null)}else Q(null),p.current=null}},T=L=>y(L.clientX,L.clientY),q=L=>{L.preventDefault(),y(L.touches[0].clientX,L.touches[0].clientY)},V=()=>{const L=p.current,W=g.current,H=b.current;if(W){let F=L&&ie(o,W.shape,L.row,L.col)?L:H?et(o,W.shape,H.row,H.col):null;F&&U(F.row,F.col,W.index)}oe(null),Y(null),Q(null),pe(null),p.current=null,b.current=null,g.current=null,x.current=null},G=()=>{window.removeEventListener("mousemove",T),window.removeEventListener("mouseup",G),V()},J=()=>{window.removeEventListener("touchmove",q,{capture:!0}),window.removeEventListener("touchend",J,{capture:!0}),V()};return window.addEventListener("mousemove",T),window.addEventListener("mouseup",G),window.addEventListener("touchmove",q,{passive:!1,capture:!0}),window.addEventListener("touchend",J,{capture:!0}),()=>{window.removeEventListener("mousemove",T),window.removeEventListener("mouseup",G),window.removeEventListener("touchmove",q,{capture:!0}),window.removeEventListener("touchend",J,{capture:!0})}},[O,B,o,U]);const je=i.useMemo(()=>!B||!Z||!ie(o,B.shape,Z.row,Z.col)?null:{shape:B.shape,row:Z.row,col:Z.col,colorIndex:B.shapeIdx},[B,Z,o]),Ee=()=>{l(Qe(Oe)),S(0),R(!1),u(null),oe(null),Q(null),k(1),m()};return s.jsxs("div",{className:"game-screen",children:[s.jsx("div",{className:`game-board-container ${j?"landscape-mode":""}`,children:s.jsx("div",{className:`game-area ${w?"game-over":""}`,children:s.jsx("div",{className:"game-view-16-9",children:s.jsx(dt,{ref:a,grid:o,onCellClick:ae,preview:je,onLayout:y=>v(y.cellSize),score:h,scoreLabel:n("game.score"),onBack:t,backLabel:n("game.backToStage"),placeHintLabel:n("game.placeHint"),currentBlockIndices:c,selectedIndex:d,onBlockTrayClick:ee,onBlockTrayPointerDown:be,isLandscapeMode:j})})})}),z&&s.jsxs("button",{type:"button",className:`orientation-toggle-button ${j?"landscape-mode":""}`,onClick:C,"aria-label":n(j?"game.switchToPortrait":"game.switchToLandscape"),title:n(j?"game.switchToPortrait":"game.switchToLandscape"),children:[s.jsx("span",{className:"orientation-icon",children:j?"ðŸ“±":"ðŸ”„"}),s.jsx("span",{className:"orientation-text",children:n(j?"game.portraitMode":"game.landscapeMode")})]}),B&&ue&&typeof document!="undefined"&&nt.createPortal(s.jsx("div",{className:`game-drag-ghost ${j?"landscape-mode":""}`,style:{left:ue.x,top:ue.y},"aria-hidden":!0,children:s.jsx(Jt,{shape:B.shape,colorIndex:B.shapeIdx,size:r})}),document.body),w&&s.jsx("div",{className:"game-overlay",children:s.jsxs("div",{className:"game-over-box",children:[s.jsx("h2",{children:n("game.gameOver")}),s.jsxs("p",{children:[n("game.score"),": ",h]}),s.jsxs("div",{className:"game-over-buttons",children:[s.jsx("button",{type:"button",onClick:Ee,children:n("game.playAgain")}),s.jsx("button",{type:"button",onClick:t,children:n("game.backToStage")})]})]})})]})};function Jt({shape:e,colorIndex:t,size:n=24}){var u,h;const a=xe(t),o=e.length,l=(h=(u=e[0])==null?void 0:u.length)!=null?h:0,c=n,f=l*c,d=o*c;return s.jsx("svg",{width:f,height:d,viewBox:`0 0 ${f} ${d}`,className:"block-preview-svg",children:e.map((S,w)=>S.map((R,A)=>R?s.jsx("rect",{x:A*c+2,y:w*c+2,width:c-4,height:c-4,fill:a,stroke:"rgba(255,255,255,0.4)",strokeWidth:1,rx:4},`${w}-${A}`):null))})}const Zt="https://chipgames.github.io/ChipBlockCrush/",Qt=({title:e,description:t,keywords:n,url:a=Zt})=>{const{t:o,language:l}=K(),c=e!=null?e:o("seo.title"),f=t!=null?t:o("seo.description"),d=n!=null?n:o("seo.keywords"),u=l!=="ko"?`?lang=${l}`:"";return s.jsxs(yt,{children:[s.jsx("title",{children:c}),s.jsx("meta",{name:"description",content:f}),s.jsx("meta",{name:"keywords",content:d}),s.jsx("meta",{property:"og:title",content:c}),s.jsx("meta",{property:"og:description",content:f}),s.jsx("meta",{property:"og:type",content:"website"}),s.jsx("meta",{property:"og:url",content:a+u}),s.jsx("link",{rel:"canonical",href:a+u})]})};function en(){if(typeof window=="undefined"||!("serviceWorker"in navigator))return;const e="/ChipBlockCrush/";window.addEventListener("load",()=>{navigator.serviceWorker.register(`${e}sw.js`,{scope:e}).catch(()=>{})})}const Se="chipBlockCrush_orientationLocked",tn=()=>{rt();const{t:e}=K();i.useEffect(()=>{en()},[]);const[t,n]=i.useState("menu"),[a,o]=i.useState(null),[l,c]=i.useState(()=>typeof window=="undefined"?!1:window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0),[f,d]=i.useState(()=>{var k;return(k=typeof window!="undefined"&&X.get(Se,{fallback:"false"})==="true")!=null?k:!1}),[u,h]=i.useState(!1),S=k=>{n(k)},w=()=>{o(1),n("game")},R=()=>{n("menu"),o(null)},A=()=>_e($e,null,function*(){const k=screen;if(typeof window=="undefined"||!k.orientation){alert(e("header.orientationUnlock"));return}const j=k.orientation;try{if(f)yield j.unlock(),d(!1),X.set(Se,"false",{silent:!0});else{try{const I=document.documentElement;I.requestFullscreen?yield I.requestFullscreen():I.webkitRequestFullscreen&&(yield I.webkitRequestFullscreen())}catch(I){}const z=j.type.startsWith("portrait")?"portrait":"landscape";yield j.lock(z),d(!0),X.set(Se,"true",{silent:!0})}}catch(M){console.warn("í™”ë©´ ê³ ì • ì‹¤íŒ¨:",M);const z=M instanceof Error?M.message:String(M);(z.includes("not allowed")||z.includes("denied"))&&alert(e("header.orientationUnlock"))}});return i.useEffect(()=>{const k=()=>{typeof window!="undefined"&&c(window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0)};return window.addEventListener("resize",k),window.addEventListener("orientationchange",k),()=>{window.removeEventListener("resize",k),window.removeEventListener("orientationchange",k)}},[]),i.useEffect(()=>{const k=screen;if(typeof window=="undefined"||!k.orientation||!f)return;const j=k.orientation,z=j.type.startsWith("portrait")?"portrait":"landscape";j.lock(z).catch(()=>{d(!1),X.set(Se,"false",{silent:!0})})},[]),s.jsx(Et,{children:s.jsxs(wt,{children:[s.jsx(Qt,{}),s.jsxs("div",{className:`app-container${u?" menu-footer-hidden":""}`,children:[s.jsx(at,{onNavigate:S,onStartGame:w,currentScreen:t}),s.jsxs(Ot,{children:[t==="guide"&&s.jsx(Bt,{onNavigate:S}),t==="help"&&s.jsx(zt,{onNavigate:S}),t==="about"&&s.jsx($t,{onNavigate:S}),t==="menu"&&s.jsx(At,{onNavigate:S,onStartGame:w}),t==="game"&&a!=null&&s.jsx(Vt,{stageNumber:a,onBack:R})]}),s.jsx(ct,{})]}),l&&typeof window!="undefined"&&screen.orientation?s.jsx("button",{type:"button",className:"orientation-lock-button",onClick:A,"aria-label":e(f?"header.orientationUnlock":"header.orientationLock"),title:e(f?"header.orientationUnlock":"header.orientationLock"),children:f?"ðŸ”’":"ðŸ”“"}):null,l&&s.jsx("button",{type:"button",className:"menu-footer-toggle",onClick:()=>h(k=>!k),"aria-label":e(u?"header.showMenuFooter":"header.hideMenuFooter"),title:e(u?"header.showMenuFooter":"header.hideMenuFooter"),children:u?"â˜°":"âœ•"})]})})};Ie.createRoot(document.getElementById("root")).render(s.jsx(bt.StrictMode,{children:s.jsx(tn,{})}))});export default nn();
