var bt=Object.defineProperty;var vt=(t,e,n)=>e in t?bt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var St=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Ce=(t,e,n)=>(vt(t,typeof e!="symbol"?e+"":e,n),n);var de=(t,e,n)=>new Promise((a,o)=>{var l=d=>{try{h(n.next(d))}catch(f){o(f)}},c=d=>{try{h(n.throw(d))}catch(f){o(f)}},h=d=>d.done?a(d.value):Promise.resolve(d.value).then(l,c);h((n=n.apply(t,e)).next())});import{r as i,a as at,R as xt}from"./vendor-ffc9ac40.js";import{W as kt,q as Ct}from"./helmet-6da975a7.js";var an=St(be=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}})();var ct={exports:{}},Ie={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jt=i,Et=Symbol.for("react.element"),Rt=Symbol.for("react.fragment"),Nt=Object.prototype.hasOwnProperty,It=jt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Lt={key:!0,ref:!0,__self:!0,__source:!0};function it(t,e,n){var a,o={},l=null,c=null;n!==void 0&&(l=""+n),e.key!==void 0&&(l=""+e.key),e.ref!==void 0&&(c=e.ref);for(a in e)Nt.call(e,a)&&!Lt.hasOwnProperty(a)&&(o[a]=e[a]);if(t&&t.defaultProps)for(a in e=t.defaultProps,e)o[a]===void 0&&(o[a]=e[a]);return{$$typeof:Et,type:t,key:l,ref:c,props:o,_owner:It.current}}Ie.Fragment=Rt;Ie.jsx=it;Ie.jsxs=it;ct.exports=Ie;var s=ct.exports,ze={},Xe=at;ze.createRoot=Xe.createRoot,ze.hydrateRoot=Xe.hydrateRoot;class Tt extends i.Component{constructor(){super(...arguments);Ce(this,"state",{hasError:!1})}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,a){console.error("[ChipBlockCrush]",n,a)}render(){return this.state.hasError?s.jsxs("div",{className:"error-boundary",children:[s.jsx("h2",{children:"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"}),s.jsx("p",{children:"íŽ˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ ì£¼ì„¸ìš”."}),s.jsx("button",{type:"button",onClick:()=>window.location.reload(),children:"ìƒˆë¡œê³ ì¹¨"})]}):this.props.children}}const _t="modulepreload",Mt=function(t){return"/ChipBlockCrush/"+t},Ke={},we=function(e,n,a){if(!n||n.length===0)return e();const o=document.getElementsByTagName("link");return Promise.all(n.map(l=>{if(l=Mt(l),l in Ke)return;Ke[l]=!0;const c=l.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(!!a)for(let u=o.length-1;u>=0;u--){const p=o[u];if(p.href===l&&(!c||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${h}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":_t,c||(f.as="script",f.crossOrigin=""),f.href=l,document.head.appendChild(f),c)return new Promise((u,p)=>{f.addEventListener("load",u),f.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})})).then(()=>e()).catch(l=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l})},Pt=(t,e)=>{const n=t[e];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((a,o)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(o.bind(null,new Error("Unknown variable dynamic import: "+e)))})},Re=["ko","en","ja","zh"],Ot="ko",At={ko:"í•œêµ­ì–´",en:"English",ja:"æ—¥æœ¬èªž",zh:"ä¸­æ–‡"},ye={debug:(...t)=>{},info:(...t)=>console.info("[ChipBlockCrush]",...t),warn:(...t)=>console.warn("[ChipBlockCrush]",...t),error:(...t)=>console.error("[ChipBlockCrush]",...t)},Ve="language";class Je{detectBrowserLanguage(){const e=navigator.language.split("-")[0];return Re.includes(e)?e:Ot}getStoredLanguage(){try{return localStorage.getItem(Ve)}catch(e){return ye.error("Failed to get stored language",{error:e}),null}}setLanguage(e){if(Re.includes(e))try{localStorage.setItem(Ve,e),window.dispatchEvent(new CustomEvent("languageChanged",{detail:e})),ye.debug("Language changed",{language:e})}catch(n){ye.error("Failed to set language",{error:n,language:e})}}getCurrentLanguage(){const e=this.getStoredLanguage();return e&&Re.includes(e)?e:this.detectBrowserLanguage()}}const Ae={},Q=()=>{const[t,e]=i.useState(()=>new Je().getCurrentLanguage()),[n,a]=i.useState(null),[o,l]=i.useState(!0);return i.useEffect(()=>{(()=>de(be,null,function*(){l(!0);try{if(Ae[t]){a(Ae[t]),l(!1);return}const f=yield Pt(Object.assign({"../locales/en.json":()=>we(()=>import("./en-83a5104e.js"),[]),"../locales/ja.json":()=>we(()=>import("./ja-cb8af516.js"),[]),"../locales/ko.json":()=>we(()=>import("./ko-c9f05848.js"),[]),"../locales/zh.json":()=>we(()=>import("./zh-b69c03a5.js"),[])}),`../locales/${t}.json`);Ae[t]=f.default,a(f.default)}catch(f){try{const u=yield we(()=>import("./ko-c9f05848.js"),[]);a(u.default)}catch(u){a({})}}finally{l(!1)}}))()},[t]),i.useEffect(()=>{const d=f=>{const u=f;u.detail&&(u.detail==="ko"||u.detail==="en"||u.detail==="ja"||u.detail==="zh")&&e(u.detail)};return window.addEventListener("languageChanged",d),()=>window.removeEventListener("languageChanged",d)},[]),{language:t,setLanguage:d=>{new Je().setLanguage(d),(d==="ko"||d==="en"||d==="ja"||d==="zh")&&e(d)},t:d=>{if(o||!n)return d;const f=d.split(".");let u=n;for(const p of f)if(u=u==null?void 0:u[p],u===void 0)break;return(typeof u=="string"?u:d)||d},isLoading:o}};function ut(){const[t,e]=i.useState(null),[n,a]=i.useState(!1),[o,l]=i.useState(!1);return i.useEffect(()=>{if(typeof window=="undefined")return;const d=window.matchMedia("(display-mode: standalone)").matches||navigator.standalone===!0;a(d);const f=/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1;l(f);const u=p=>{p.preventDefault(),e(p)};return window.addEventListener("beforeinstallprompt",u),()=>window.removeEventListener("beforeinstallprompt",u)},[]),{canInstall:!!t&&!n,isIOS:o,isStandalone:n,promptInstall:()=>de(this,null,function*(){t&&(yield t.prompt(),yield t.userChoice,e(null))})}}const He=i.memo(()=>{const{language:t,setLanguage:e}=Q();return s.jsx("select",{className:"language-selector",value:t,onChange:n=>e(n.target.value),"aria-label":"ì–¸ì–´ ì„ íƒ",children:Re.map(n=>s.jsx("option",{value:n,children:At[n]},n))})});He.displayName="LanguageSelector";const Ze="chipBlockCrush_",U={get(t,e={}){var a,o;const n=Ze+t;try{const l=localStorage.getItem(n);return l===null?(a=e.fallback)!=null?a:null:JSON.parse(l)}catch(l){return e.silent||ye.warn("storage get failed",n,l),(o=e.fallback)!=null?o:null}},set(t,e,n={}){const a=Ze+t;try{localStorage.setItem(a,JSON.stringify(e))}catch(o){n.silent||ye.warn("storage set failed",a,o)}}},Be="theme",Bt=()=>{if(typeof window=="undefined")return"dark";try{return window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}catch(t){return"dark"}},$e=t=>{if(typeof document=="undefined")return;document.documentElement.setAttribute("data-theme",t);const e=document.querySelector('meta[name="theme-color"]');e&&e.setAttribute("content",t==="light"?"#f5f5f8":"#1a1a2e")},dt=()=>{const[t,e]=i.useState(()=>{const o=U.get(Be,{fallback:null,silent:!0});return o==="light"||o==="dark"?o:Bt()}),n=i.useCallback(()=>{e(o=>{const l=o==="light"?"dark":"light";return U.set(Be,l,{silent:!0}),$e(l),l})},[]),a=i.useCallback(o=>{e(o),U.set(Be,o,{silent:!0}),$e(o)},[]);return i.useEffect(()=>{$e(t)},[t]),{theme:t,toggleTheme:n,setTheme:a,isLight:t==="light",isDark:t==="dark"}},ft=i.memo(()=>{const{t}=Q(),{theme:e,toggleTheme:n}=dt(),a=e==="light";return s.jsx("button",{type:"button",className:"theme-toggle",onClick:n,title:t(a?"header.darkMode":"header.lightMode"),"aria-label":t(a?"header.darkMode":"header.lightMode"),children:a?"ðŸŒ™":"â˜€ï¸"})});ft.displayName="ThemeToggle";class $t{constructor(){Ce(this,"enabled",!0);Ce(this,"ctx",null)}setEnabled(e){this.enabled=e}getContext(){return typeof window=="undefined"||!window.AudioContext?null:(this.ctx||(this.ctx=new window.AudioContext),this.ctx)}playClick(){if(!this.enabled)return;const e=this.getContext();if(!e)return;const n=()=>{try{const a=e.currentTime,o=e.createOscillator(),l=e.createGain();o.connect(l),l.connect(e.destination),o.type="sine",o.frequency.setValueAtTime(880,a),o.frequency.exponentialRampToValueAtTime(440,a+.05),l.gain.setValueAtTime(.12,a),l.gain.exponentialRampToValueAtTime(.001,a+.08),o.start(a),o.stop(a+.08)}catch(a){}};e.state==="suspended"?e.resume().then(n).catch(()=>{}):n()}playPlace(){if(!this.enabled)return;const e=this.getContext();if(!e)return;const n=()=>{try{const a=e.currentTime,o=e.createOscillator(),l=e.createGain();o.connect(l),l.connect(e.destination),o.type="sine",o.frequency.setValueAtTime(660,a),l.gain.setValueAtTime(.1,a),l.gain.exponentialRampToValueAtTime(.001,a+.06),o.start(a),o.stop(a+.06)}catch(a){}};e.state==="suspended"?e.resume().then(n).catch(()=>{}):n()}}const De=new $t,ht=i.memo(({onNavigate:t,onStartGame:e})=>{const{t:n}=Q(),{canInstall:a,isIOS:o,isStandalone:l,promptInstall:c}=ut(),h=!l,[d,f]=i.useState(()=>{var g;return(g=U.get("soundEnabled",{fallback:!0,silent:!0}))!=null?g:!0}),[u,p]=i.useState(!1);i.useEffect(()=>{De.setEnabled(d),U.set("soundEnabled",d,{silent:!0})},[d]),i.useEffect(()=>(document.body.style.overflow=u?"hidden":"",()=>{document.body.style.overflow=""}),[u]);const y=g=>{t==null||t(g),p(!1)},N=()=>{f(g=>!g),d&&De.playClick()},j=()=>de(be,null,function*(){a?(yield c(),p(!1)):o?(window.alert(n("menu.installInstructionsIOS")),p(!1)):(window.alert(n("menu.installInstructionsFallback")),p(!1))});return s.jsx("header",{className:"header",children:s.jsxs("div",{className:"header-content",children:[s.jsxs("div",{className:"header-logo",onClick:()=>y("menu"),role:"button",tabIndex:0,onKeyDown:g=>g.key==="Enter"&&y("menu"),children:[s.jsx("img",{src:"/ChipBlockCrush/ChipGames_Logo.png",alt:n("header.logo"),className:"header-logo-img"}),s.jsx("span",{className:"header-game-title",children:n("header.gameTitle")})]}),u&&s.jsx("div",{className:"header-nav-overlay",onClick:()=>p(!1),"aria-hidden":!0}),s.jsxs("nav",{className:`header-nav ${u?"mobile-open":""}`,children:[s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>e?e():y("menu"),children:n("header.playGame")}),h&&s.jsx("button",{type:"button",className:"header-nav-button header-nav-button-download",onClick:j,children:n("header.download")}),s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>y("guide"),children:n("header.guide")}),s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>y("help"),children:n("header.help")}),s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>y("about"),children:n("header.about")})]}),s.jsxs("div",{className:"header-right",children:[s.jsx(ft,{}),s.jsx("button",{type:"button",className:"header-sound-button",onClick:N,title:n(d?"header.soundOff":"header.soundOn"),"aria-label":n(d?"header.soundOff":"header.soundOn"),children:d?"ðŸ”Š":"ðŸ”‡"}),s.jsx(He,{}),s.jsxs("button",{type:"button",className:"header-hamburger",onClick:()=>p(g=>!g),"aria-label":"ë©”ë‰´","aria-expanded":u,children:[s.jsx("span",{className:`hamburger-line ${u?"active":""}`}),s.jsx("span",{className:`hamburger-line ${u?"active":""}`}),s.jsx("span",{className:`hamburger-line ${u?"active":""}`})]})]})]})})});ht.displayName="Header";const zt="1.0.5",mt=i.memo(()=>{const{t}=Q();return s.jsx("footer",{className:"footer",role:"contentinfo",children:s.jsxs("div",{className:"footer-content",children:[s.jsxs("nav",{className:"footer-links",children:[s.jsx("a",{href:"#privacy",className:"footer-link",children:t("footer.privacy")}),s.jsx("a",{href:"#contact",className:"footer-link",children:t("footer.contact")})]}),s.jsx("div",{className:"footer-center",children:s.jsx(He,{})}),s.jsxs("div",{className:"footer-copyright",children:[t("footer.copyright")," | v",zt]})]})})});mt.displayName="Footer";const Dt=({children:t})=>s.jsx("div",{className:"game-container",children:t}),Gt=({onNavigate:t,onStartGame:e})=>{const{t:n}=Q(),{canInstall:a,isIOS:o,isStandalone:l,promptInstall:c}=ut(),[h,d]=i.useState(!1),[f,u]=i.useState(null),p=!l,y=()=>de(be,null,function*(){a?yield c():o?(u("ios"),d(!0)):(u("fallback"),d(!0))});return s.jsxs("div",{className:"menu-screen",children:[s.jsx("div",{className:"menu-logo-wrap",children:s.jsx("img",{src:"/ChipBlockCrush/ChipGames_Logo.png",alt:n("header.logo"),className:"menu-logo"})}),s.jsx("h1",{className:"menu-title",children:n("header.gameTitle")}),s.jsx("p",{className:"menu-desc",children:n("menu.subtitle")}),s.jsx("button",{type:"button",className:"menu-play-btn",onClick:e,children:n("header.playGame")}),s.jsxs("nav",{className:"menu-links",children:[p&&s.jsx("button",{type:"button",className:"menu-link menu-link-download",onClick:y,children:n("header.download")}),s.jsx("button",{type:"button",className:"menu-link",onClick:()=>t("guide"),children:n("header.guide")}),s.jsx("button",{type:"button",className:"menu-link",onClick:()=>t("help"),children:n("header.help")}),s.jsx("button",{type:"button",className:"menu-link",onClick:()=>t("about"),children:n("header.about")})]}),h&&f&&s.jsx("div",{className:"menu-ios-install-overlay",onClick:()=>{d(!1),u(null)},role:"dialog","aria-modal":"true","aria-label":n(f==="ios"?"menu.installInstructionsIOS":"menu.installInstructionsFallback"),children:s.jsxs("div",{className:"menu-ios-install-box",onClick:N=>N.stopPropagation(),children:[s.jsx("p",{className:"menu-ios-install-text",children:n(f==="ios"?"menu.installInstructionsIOS":"menu.installInstructionsFallback")}),s.jsx("button",{type:"button",className:"menu-ios-install-close",onClick:()=>{d(!1),u(null)},children:n("menu.confirm")})]})})]})},Ft=({onNavigate:t})=>{const{t:e}=Q();return s.jsxs("div",{className:"guide-screen",children:[s.jsx("h1",{className:"guide-title",children:e("guide.title")}),s.jsx("p",{className:"guide-description",children:e("guide.description")}),s.jsxs("ol",{className:"guide-steps",children:[s.jsx("li",{children:e("guide.step1")}),s.jsx("li",{children:e("guide.step2")}),s.jsx("li",{children:e("guide.step3")})]}),s.jsx("button",{type:"button",className:"guide-back",onClick:()=>t("stageSelect"),children:e("header.playGame")})]})},Ht=({onNavigate:t})=>{const{t:e}=Q();return s.jsxs("div",{className:"help-screen",children:[s.jsx("h1",{className:"help-title",children:e("help.title")}),s.jsxs("div",{className:"help-faq",children:[s.jsx("p",{children:e("help.faq1")}),s.jsx("p",{children:e("help.faq2")})]}),s.jsx("button",{type:"button",className:"help-back",onClick:()=>t("stageSelect"),children:e("header.playGame")})]})},Wt=({onNavigate:t})=>{const{t:e}=Q();return s.jsxs("div",{className:"about-screen",children:[s.jsx("h1",{className:"about-title",children:e("about.title")}),s.jsx("p",{className:"about-description",children:e("about.description")}),s.jsx("button",{type:"button",className:"about-back",onClick:()=>t("stageSelect"),children:e("header.playGame")})]})},Yt=16/9;function qt(t,e){const n=Yt,a=t/e;let o,l;return a>n?(l=e,o=e*n):(o=t,l=t/n),{width:Math.floor(o),height:Math.floor(l)}}const We=[[[1]],[[1,1]],[[1],[1]],[[1,1,1]],[[1],[1],[1]],[[1,1],[1,0]],[[1,1],[0,1]],[[1,0],[1,1]],[[0,1],[1,1]],[[1,1],[1,1]],[[1,1,1,1]],[[1],[1],[1],[1]],[[1,1,1],[1,0,0]],[[1,1,1],[0,0,1]],[[1,1,1],[0,1,0]],[[1,0],[1,1],[1,0]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]],[[1,1],[1,1],[1,0]],[[1,1],[0,1],[0,1]],[[1,1,1,1,1]],[[1],[1],[1],[1],[1]],[[1,1,1],[1,1,0]],[[1,1,1],[0,1,1]],[[0,1,0],[1,1,1],[0,1,0]],[[1,1,1],[0,1,0],[0,1,0]],[[1,0,0],[1,1,1],[1,0,0]]],Qe=["#a8b5ff","#c5a3ff","#ffb3e6","#7fdfd4","#ffd89b","#ff9f9f","#b5c4ff","#d4b3ff","#ffc4e6","#8fefdf","#ffe0ab","#ffafaf","#a8e6cf","#dda0dd","#87ceeb","#f0e68c"];function et(t){return Math.abs(Math.floor(Math.sin(t)*1e6))%We.length}function Ne(t){return Qe[t%Qe.length]}const Ge=9,tt=3,Ut=10,nt=[0,20,30,40,50,60,70,80,90,100];function ot(t=Ge){return Array.from({length:t},()=>Array(t).fill(0))}function fe(t,e,n,a){var h,d;const o=e.length,l=(d=(h=e[0])==null?void 0:h.length)!=null?d:0,c=t.length;if(n<0||a<0||n+o>c||a+l>c)return!1;for(let f=0;f<o;f++)for(let u=0;u<l;u++)if(e[f][u]&&t[n+f][a+u]!==0)return!1;return!0}const gt=15;function Xt(t,e,n,a,o,l){var u,p;const c=t.map(y=>[...y]),h=e.length,d=(p=(u=e[0])==null?void 0:u.length)!=null?p:0,f=o<<4|l&gt;for(let y=0;y<h;y++)for(let N=0;N<d;N++)e[y][N]&&(c[n+y][a+N]=f);return c}function Kt(t){return t>0?t&gt:0}function Ye(t){var o,l;let e=0,n=0,a=0;for(let c=0;c<t.length;c++)for(let h=0;h<((l=(o=t[0])==null?void 0:o.length)!=null?l:0);h++)t[c][h]&&(e+=c,n+=h,a++);return a===0?{row:0,col:0}:{row:Math.floor(e/a),col:Math.floor(n/a)}}const je=2;function st(t,e,n,a){const o=Ye(e),l=n-o.row,c=a-o.col;let h=null,d=1/0;for(let f=-je;f<=je;f++)for(let u=-je;u<=je;u++){const p=l+f,y=c+u;if(!fe(t,e,p,y))continue;const N=p+o.row,j=y+o.col,g=Math.abs(N-n)+Math.abs(j-a);g<d&&(d=g,h={row:p,col:y})}return h}function Vt(t){const e=t.length,n=[],a=[];for(let o=0;o<e;o++){let l=!0,c=!0;for(let h=0;h<e;h++)t[o][h]===0&&(l=!1),t[h][o]===0&&(c=!1);l&&n.push(o),c&&a.push(o)}return{rows:n,cols:a}}function Jt(t,e,n){const a=t.length,o=t.map(l=>[...l]);for(const l of e)for(let c=0;c<a;c++)o[l][c]=0;for(const l of n)for(let c=0;c<a;c++)o[c][l]=0;return o}function Zt(t,e){var o;const n=t*Ut,a=(o=nt[Math.min(e,nt.length-1)])!=null?o:0;return n+a}function Qt(t,e){var a,o;const n=t.length;for(const l of e){const c=We[l];if(!c)continue;const h=c.length,d=(o=(a=c[0])==null?void 0:a.length)!=null?o:0;for(let f=0;f<=n-h;f++)for(let u=0;u<=n-d;u++)if(fe(t,c,f,u))return!0}return!1}function Fe(t){var e;return(e=We[t])!=null?e:null}function en(t,e,n,a){const l=Math.min(t/400,e/300,1.2),c=Math.max(28,36*l),h=Math.max(56,72*l),d=Math.max(56,70*l),f=Math.max(22,28*l),u=Math.max(44,52*l),p=4,y=t-h-8*2,N=e-c-8*2,j=Math.min(y/n,N/n),g=8+(y-j*n)/2,H=c+8+(N-j*n)/2,D={x:8,y:8,w:d,h:f},k=[],P=t-h+(h-u)/2;let ee=c+8;for(let Y=0;Y<a;Y++)k.push({x:P,y:ee,w:u,h:u}),ee+=u+p;return{padding:8,scale:l,topBarHeight:c,rightPanelWidth:h,menuRect:D,trayRects:k,offsetX:g,offsetY:H,cellSize:j,gridSize:n,traySlotSize:u}}const pt=i.forwardRef(({grid:t,onCellClick:e,preview:n,score:a=0,scoreLabel:o,bestScore:l=0,bestScoreLabel:c,onBack:h,backLabel:d,placeHintLabel:f,currentBlockIndices:u=[],selectedIndex:p=null,onBlockTrayClick:y,onBlockTrayPointerDown:N,onLayout:j,isLandscapeMode:g=!1},H)=>{const D=i.useRef(null),k=i.useRef(null),P=i.useRef(null),ee=i.useRef(g);ee.current=g;const Y=t.length;i.useImperativeHandle(H,()=>({getCellFromPoint(r,S){const w=k.current;if(!w||!P.current)return null;const x=w.getBoundingClientRect();let m=r-x.left,C=S-x.top;if(ee.current){const R=parseInt(w.style.width||"0",10),J=parseInt(w.style.height||"0",10);if(R&&J){const re=r-x.left;m=S-x.top,C=J-re}}const E=P.current,L=Math.floor((m-E.offsetX)/E.cellSize),b=Math.floor((C-E.offsetY)/E.cellSize);return b>=0&&b<E.gridSize&&L>=0&&L<E.gridSize?{row:b,col:L}:null},getCellSize(){var r,S;return(S=(r=P.current)==null?void 0:r.cellSize)!=null?S:24}}),[]);const G=i.useCallback((r,S,w)=>{var ae,ue;const x=Math.max(1,u.length),m=en(S,w,Y,x);P.current=m,j==null||j({cellSize:m.cellSize});const{padding:C,scale:E,rightPanelWidth:L,menuRect:b,trayRects:R,offsetX:J,offsetY:re}=m,ve=8;r.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--canvas-bg").trim()||"#1a1a1a",r.fillRect(0,0,S,w);const X=document.documentElement.getAttribute("data-theme")==="light",Le=X?"rgba(220, 222, 235, 0.95)":"rgba(40, 42, 62, 0.95)",Te=X?"rgba(124, 138, 255, 0.55)":"rgba(168, 181, 255, 0.5)",_e=X?"rgba(0,0,0,0.03)":"rgba(255,255,255,0.04)",Me=X?"rgba(0,0,0,0.12)":"rgba(255,255,255,0.22)",Se=X?"#2d2d2d":"#e8e8e8",v=X?"rgba(168, 181, 255, 0.35)":"rgba(102, 126, 234, 0.4)",$=X?"rgba(124, 138, 255, 0.6)":"rgba(168, 181, 255, 0.6)",Z=Math.max(10,12*E);r.font=`600 ${Z}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,r.textAlign="left",r.textBaseline="middle",h&&d&&(r.fillStyle=v,r.strokeStyle=$,r.lineWidth=2,typeof r.roundRect=="function"?(r.beginPath(),r.roundRect(b.x,b.y,b.w,b.h,8),r.fill(),r.stroke()):(r.fillRect(b.x,b.y,b.w,b.h),r.strokeRect(b.x,b.y,b.w,b.h)),r.fillStyle=Se,r.textAlign="center",r.fillText(d,b.x+b.w/2,b.y+b.h/2),r.textAlign="left");const q=b.x+b.w+C,W=b.y+b.h/2,ne=Z+2;r.textAlign="left",r.fillStyle=Se,r.fillText(o!=null?`${o}: ${a}`:String(a),q,W,S-q-L-C),c!=null&&r.fillText(`${c}: ${l}`,q,W+ne,S-q-L-C),u.forEach((F,V)=>{var ge,pe;const T=R[V];if(!T)return;const z=Fe(F);if(p===V&&(r.fillStyle="rgba(168, 181, 255, 0.25)",r.strokeStyle="rgba(168, 181, 255, 0.8)",r.lineWidth=2,typeof r.roundRect=="function"&&(r.beginPath(),r.roundRect(T.x-2,T.y-2,T.w+4,T.h+4,10),r.fill(),r.stroke())),z){const Pe=z.length,Oe=(pe=(ge=z[0])==null?void 0:ge.length)!=null?pe:0,ie=Math.min((T.w-8)/Oe,(T.h-8)/Pe,14),wt=T.x+(T.w-Oe*ie)/2,yt=T.y+(T.h-Pe*ie)/2;r.fillStyle=Ne(F),r.strokeStyle="rgba(255,255,255,0.4)",r.lineWidth=1;for(let xe=0;xe<Pe;xe++)for(let ke=0;ke<Oe;ke++)if(z[xe][ke]){const qe=wt+ke*ie+1,Ue=yt+xe*ie+1;r.fillRect(qe,Ue,ie-2,ie-2),r.strokeRect(qe,Ue,ie-2,ie-2)}}});const I=m.cellSize*Y,O=m.cellSize*Y,K=J-2,A=re-2,_=I+4,M=O+4;r.beginPath(),typeof r.roundRect=="function"?r.roundRect(K,A,_,M,ve):r.rect(K,A,_,M),r.fillStyle=Le,r.fill(),r.strokeStyle=Te,r.lineWidth=3,r.stroke();for(let F=0;F<Y;F++)for(let V=0;V<Y;V++){const T=J+V*m.cellSize,z=re+F*m.cellSize,ce=t[F][V];ce>0?(r.fillStyle=Ne(Kt(ce)),r.fillRect(T+2,z+2,m.cellSize-4,m.cellSize-4),r.strokeStyle="rgba(255,255,255,0.35)",r.lineWidth=1,r.strokeRect(T+2,z+2,m.cellSize-4,m.cellSize-4)):(r.fillStyle=_e,r.fillRect(T+1,z+1,m.cellSize-2,m.cellSize-2),r.strokeStyle=Me,r.lineWidth=1,r.strokeRect(T+1,z+1,m.cellSize-2,m.cellSize-2))}if(n&&n.shape){const F=n.colorIndex!==void 0?Ne(n.colorIndex):"rgba(168, 181, 255, 0.6)";r.fillStyle=F,r.globalAlpha=.7,r.strokeStyle="rgba(255,255,255,0.6)",r.lineWidth=2;const V=n.shape.length,T=(ue=(ae=n.shape[0])==null?void 0:ae.length)!=null?ue:0;for(let z=0;z<V;z++)for(let ce=0;ce<T;ce++)if(n.shape[z][ce]){const ge=J+(n.col+ce)*m.cellSize+2,pe=re+(n.row+z)*m.cellSize+2;r.fillRect(ge,pe,m.cellSize-4,m.cellSize-4),r.strokeRect(ge,pe,m.cellSize-4,m.cellSize-4)}r.globalAlpha=1}},[t,Y,n,a,o,l,c,d,h,u,p,j]);i.useEffect(()=>{const r=D.current,S=k.current;if(!r||!S)return;const w=S.getContext("2d");if(!w)return;const x=()=>{const C=r.clientWidth,E=r.clientHeight,{width:L,height:b}=qt(C,E),R=window.devicePixelRatio||1;S.width=L*R,S.height=b*R,S.style.width=`${L}px`,S.style.height=`${b}px`,w.setTransform(1,0,0,1,0,0),w.scale(R,R),G(w,L,b)};x();const m=new ResizeObserver(x);return m.observe(r),()=>m.disconnect()},[G]),i.useEffect(()=>{const r=k.current;if(!r)return;const S=r.getContext("2d");if(!S)return;const w=parseInt(r.style.width||"0",10),x=parseInt(r.style.height||"0",10);w&&x&&G(S,w,x)},[t,G]);const te=i.useCallback((r,S)=>{const w=k.current;if(!w)return null;const x=w.getBoundingClientRect(),m=r-x.left,C=S-x.top;if(!g)return{px:m,py:C};const E=parseInt(w.style.width||"0",10),L=parseInt(w.style.height||"0",10);if(!E||!L)return{px:m,py:C};const b=C,R=L-m;return{px:b,py:R}},[g]),B=i.useCallback(r=>{const S="touches"in r?r.touches[0].clientX:r.clientX,w="touches"in r?r.touches[0].clientY:r.clientY,x=te(S,w);if(!x||!P.current||!N)return;const C=P.current.trayRects.findIndex(E=>x.px>=E.x&&x.px<=E.x+E.w&&x.py>=E.y&&x.py<=E.y+E.h);C>=0&&N(C,S,w)},[te,N]),le=i.useCallback((r,S)=>{const w=te(r,S);if(!w)return;const{px:x,py:m}=w,C=P.current;if(!C)return;if(h&&d){const R=C.menuRect;if(x>=R.x&&x<=R.x+R.w&&m>=R.y&&m<=R.y+R.h){h();return}}const E=C.trayRects.findIndex(R=>x>=R.x&&x<=R.x+R.w&&m>=R.y&&m<=R.y+R.h);if(E>=0&&y){y(E);return}const L=Math.floor((x-C.offsetX)/C.cellSize),b=Math.floor((m-C.offsetY)/C.cellSize);e&&b>=0&&b<C.gridSize&&L>=0&&L<C.gridSize&&e(b,L)},[te,h,d,y,e]),oe=i.useCallback(r=>{le(r.clientX,r.clientY)},[le]),se=i.useRef(null),he=i.useCallback(r=>{se.current={x:r.touches[0].clientX,y:r.touches[0].clientY,t:Date.now()}},[]),me=i.useCallback(r=>{const S=se.current;if(se.current=null,!S||!r.changedTouches[0])return;const w=r.changedTouches[0].clientX-S.x,x=r.changedTouches[0].clientY-S.y;Date.now()-S.t<=400&&w*w+x*x<=400&&(r.preventDefault(),le(r.changedTouches[0].clientX,r.changedTouches[0].clientY))},[le]);return s.jsx("div",{ref:D,className:"block-crush-canvas-wrap",children:s.jsx("canvas",{ref:k,className:"block-crush-canvas",onClick:oe,onMouseDown:B,onTouchStart:r=>{B(r),he(r)},onTouchEnd:me,"aria-label":f})})});pt.displayName="BlockCrushCanvas";const rt="landscapeMode",lt="highScore",tn=({stageNumber:t,onBack:e})=>{const{t:n}=Q(),a=i.useRef(null),[o,l]=i.useState(()=>ot(Ge)),[c,h]=i.useState([]),[d,f]=i.useState(null),[u,p]=i.useState(0),[y,N]=i.useState(()=>{if(typeof window=="undefined")return 0;const v=U.get(lt,{fallback:0,silent:!0});return typeof v=="number"&&v>=0?v:0}),[j,g]=i.useState(!1),[H,D]=i.useState(1),[k,P]=i.useState(()=>{if(typeof window=="undefined")return!1;const v=U.get(rt,{fallback:!1,silent:!0});return v!=null?v:!1}),[ee,Y]=i.useState(()=>typeof window=="undefined"?!1:window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0),[G,te]=i.useState(null),[B,le]=i.useState(null),[oe,se]=i.useState(null),[he,me]=i.useState(null),[r,S]=i.useState(28),w=i.useRef(null),x=i.useRef(null),m=i.useRef(null),C=i.useRef(null),E=i.useRef(null),L=i.useRef(null),b=i.useRef(null),R=8,J=t*1e3,re=i.useCallback(()=>{const v=[];for(let $=0;$<tt;$++)v.push(et(J+Date.now()+$));h(v)},[J]);i.useEffect(()=>{re()},[re]);const ve=i.useCallback(()=>{const v=!k;P(v),U.set(rt,v,{silent:!0})},[k]);i.useEffect(()=>{const v=()=>{typeof window!="undefined"&&Y(window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0)};return window.addEventListener("resize",v),window.addEventListener("orientationchange",v),()=>{window.removeEventListener("resize",v),window.removeEventListener("orientationchange",v)}},[]),i.useEffect(()=>{if(c.length===0)return;Qt(o,c)||g(!0)},[o,c]),i.useEffect(()=>{u<=y||(N(u),U.set(lt,u,{silent:!0}))},[u,y]);const X=i.useCallback((v,$,Z)=>{const q=c[Z],W=Fe(q);if(!W||!fe(o,W,v,$))return;De.playPlace();let ne=Xt(o,W,v,$,H,q);D(_=>_+1);let I=0;for(;;){const{rows:_,cols:M}=Vt(ne);if(_.length===0&&M.length===0)break;I+=_.length+M.length,ne=Jt(ne,_,M)}const O=W.flat().filter(Boolean).length,K=Zt(O,I);p(_=>_+K),l(ne);const A=c.filter((_,M)=>M!==Z);A.length<tt&&A.push(et(J+Date.now()+A.length)),h(A),f(null)},[o,c,H,J]),Le=i.useCallback((v,$)=>{if(!j&&d!==null){X(v,$,d);return}},[j,d,X]),Te=i.useCallback((v,$,Z)=>{if(j)return;const q=c[v],W=Fe(q);W&&(te({x:$,y:Z,index:v,shapeIdx:q,shape:W}),C.current={index:v})},[c,j]),_e=i.useCallback(v=>{j||f($=>$===v?null:v)},[j]);m.current=B,w.current=oe,i.useEffect(()=>{if(!G&&!B)return;const v=(I,O)=>{const K=m.current;if(K&&E.current?(E.current.style.left=`${I}px`,E.current.style.top=`${O}px`):me({x:I,y:O}),G&&!B){const A=I-G.x,_=O-G.y;if(Math.sqrt(A*A+_*_)>=R){const M={index:G.index,shapeIdx:G.shapeIdx,shape:G.shape};le(M),m.current=M,te(null),C.current=null,me({x:I,y:O})}}K&&(b.current={x:I,y:O},L.current==null&&(L.current=requestAnimationFrame(()=>{var ae;L.current=null;const A=b.current,_=m.current;if(!A||!_)return;const M=(ae=a.current)==null?void 0:ae.getCellFromPoint(A.x,A.y);if(M){x.current=M;const ue=Ye(_.shape),F=M.row-ue.row,V=M.col-ue.col,T=fe(o,_.shape,F,V)?{row:F,col:V}:st(o,_.shape,M.row,M.col);if(T){const z=w.current;(!z||z.row!==T.row||z.col!==T.col)&&(se(T),w.current=T)}else w.current!==null&&(se(null),w.current=null)}else w.current!==null&&(se(null),w.current=null)})))},$=I=>v(I.clientX,I.clientY),Z=I=>{I.preventDefault(),v(I.touches[0].clientX,I.touches[0].clientY)},q=(I,O)=>{var M;const K=w.current,A=m.current,_=x.current;if(A){const ae=I!=null&&O!=null,ue=ae&&((M=a.current)==null?void 0:M.getCellFromPoint(I,O))!=null;if(!(ae&&!ue)){let F=K&&fe(o,A.shape,K.row,K.col)?K:_?st(o,A.shape,_.row,_.col):null;F&&X(F.row,F.col,A.index)}}L.current!=null&&(cancelAnimationFrame(L.current),L.current=null),b.current=null,le(null),te(null),se(null),me(null),w.current=null,x.current=null,m.current=null,C.current=null},W=I=>{window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",W),q(I.clientX,I.clientY)},ne=I=>{window.removeEventListener("touchmove",Z,{capture:!0}),window.removeEventListener("touchend",ne,{capture:!0});const O=I.changedTouches[0];q(O==null?void 0:O.clientX,O==null?void 0:O.clientY)};return window.addEventListener("mousemove",$),window.addEventListener("mouseup",W),window.addEventListener("touchmove",Z,{passive:!1,capture:!0}),window.addEventListener("touchend",ne,{capture:!0}),()=>{window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",W),window.removeEventListener("touchmove",Z,{capture:!0}),window.removeEventListener("touchend",ne,{capture:!0})}},[G,B,o,X]);const Me=i.useMemo(()=>!B||!oe||!fe(o,B.shape,oe.row,oe.col)?null:{shape:B.shape,row:oe.row,col:oe.col,colorIndex:B.shapeIdx},[B,oe,o]),Se=()=>{l(ot(Ge)),p(0),g(!1),f(null),le(null),se(null),D(1),re()};return s.jsxs("div",{className:"game-screen",children:[s.jsx("div",{className:`game-board-container ${k?"landscape-mode":""}`,children:s.jsx("div",{className:`game-area ${j?"game-over":""}`,children:s.jsx("div",{className:"game-view-16-9",children:s.jsx(pt,{ref:a,grid:o,onCellClick:Le,preview:Me,onLayout:v=>S(v.cellSize),score:u,scoreLabel:n("game.score"),bestScore:y,bestScoreLabel:n("game.bestScore"),onBack:e,backLabel:n("game.backToStage"),placeHintLabel:n("game.placeHint"),currentBlockIndices:c,selectedIndex:d,onBlockTrayClick:_e,onBlockTrayPointerDown:Te,isLandscapeMode:k})})})}),ee&&s.jsxs("button",{type:"button",className:`orientation-toggle-button ${k?"landscape-mode":""}`,onClick:ve,"aria-label":n(k?"game.switchToPortrait":"game.switchToLandscape"),title:n(k?"game.switchToPortrait":"game.switchToLandscape"),children:[s.jsx("span",{className:"orientation-icon",children:k?"ðŸ“±":"ðŸ”„"}),s.jsx("span",{className:"orientation-text",children:n(k?"game.portraitMode":"game.landscapeMode")})]}),B&&he&&typeof document!="undefined"&&at.createPortal(s.jsx("div",{ref:E,className:`game-drag-ghost ${k?"landscape-mode":""}`,style:{left:he.x,top:he.y},"aria-hidden":!0,children:s.jsx(nn,{shape:B.shape,colorIndex:B.shapeIdx,size:r})}),document.body),j&&s.jsx("div",{className:"game-overlay",children:s.jsxs("div",{className:"game-over-box",children:[s.jsx("h2",{children:n("game.gameOver")}),s.jsxs("p",{children:[n("game.score"),": ",u]}),s.jsxs("p",{className:"game-over-best",children:[n("game.bestScore"),": ",y]}),s.jsxs("div",{className:"game-over-buttons",children:[s.jsx("button",{type:"button",onClick:Se,children:n("game.playAgain")}),s.jsx("button",{type:"button",onClick:e,children:n("game.backToStage")})]})]})})]})};function nn({shape:t,colorIndex:e,size:n=24}){var P,ee;const a=Ne(e),o=t.length,l=(ee=(P=t[0])==null?void 0:P.length)!=null?ee:0,c=n,h=l*c,d=o*c,f=Ye(t),u=f.col*c+c/2,p=f.row*c+c/2,y=h/2-u,N=d/2-p,j=4,g=Math.min(0,y)-j,H=Math.min(0,N)-j,D=h+Math.abs(y)+j*2,k=d+Math.abs(N)+j*2;return s.jsx("svg",{width:D,height:k,viewBox:`${g} ${H} ${D} ${k}`,className:"block-preview-svg",children:s.jsx("g",{transform:`translate(${y}, ${N})`,children:t.map((Y,G)=>Y.map((te,B)=>te?s.jsx("rect",{x:B*c+1,y:G*c+1,width:c-1,height:c-1,fill:a,stroke:"rgba(255,255,255,0.4)",strokeWidth:1,rx:4},`${G}-${B}`):null))})})}const on="https://chipgames.github.io/ChipBlockCrush/",sn=({title:t,description:e,keywords:n,url:a=on})=>{const{t:o,language:l}=Q(),c=t!=null?t:o("seo.title"),h=e!=null?e:o("seo.description"),d=n!=null?n:o("seo.keywords"),f=l!=="ko"?`?lang=${l}`:"";return s.jsxs(kt,{children:[s.jsx("title",{children:c}),s.jsx("meta",{name:"description",content:h}),s.jsx("meta",{name:"keywords",content:d}),s.jsx("meta",{property:"og:title",content:c}),s.jsx("meta",{property:"og:description",content:h}),s.jsx("meta",{property:"og:type",content:"website"}),s.jsx("meta",{property:"og:url",content:a+f}),s.jsx("link",{rel:"canonical",href:a+f})]})};function rn(){if(typeof window=="undefined"||!("serviceWorker"in navigator))return;const t="/ChipBlockCrush/";window.addEventListener("load",()=>{navigator.serviceWorker.register(`${t}sw.js`,{scope:t}).catch(()=>{})})}const Ee="chipBlockCrush_orientationLocked",ln=()=>{dt();const{t}=Q();i.useEffect(()=>{rn()},[]);const[e,n]=i.useState("menu"),[a,o]=i.useState(null),[l,c]=i.useState(()=>typeof window=="undefined"?!1:window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0),[h,d]=i.useState(()=>{var g;return(g=typeof window!="undefined"&&U.get(Ee,{fallback:"false"})==="true")!=null?g:!1}),[f,u]=i.useState(!1),p=g=>{n(g)},y=()=>{o(1),n("game")},N=()=>{n("menu"),o(null)},j=()=>de(be,null,function*(){const g=screen;if(typeof window=="undefined"||!g.orientation){alert(t("header.orientationUnlock"));return}const H=g.orientation;try{if(h)yield H.unlock(),d(!1),U.set(Ee,"false",{silent:!0});else{try{const P=document.documentElement;P.requestFullscreen?yield P.requestFullscreen():P.webkitRequestFullscreen&&(yield P.webkitRequestFullscreen())}catch(P){}const k=H.type.startsWith("portrait")?"portrait":"landscape";yield H.lock(k),d(!0),U.set(Ee,"true",{silent:!0})}}catch(D){console.warn("í™”ë©´ ê³ ì • ì‹¤íŒ¨:",D);const k=D instanceof Error?D.message:String(D);(k.includes("not allowed")||k.includes("denied"))&&alert(t("header.orientationUnlock"))}});return i.useEffect(()=>{const g=()=>{typeof window!="undefined"&&c(window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0)};return window.addEventListener("resize",g),window.addEventListener("orientationchange",g),()=>{window.removeEventListener("resize",g),window.removeEventListener("orientationchange",g)}},[]),i.useEffect(()=>{const g=screen;if(typeof window=="undefined"||!g.orientation||!h)return;const H=g.orientation,k=H.type.startsWith("portrait")?"portrait":"landscape";H.lock(k).catch(()=>{d(!1),U.set(Ee,"false",{silent:!0})})},[]),s.jsx(Tt,{children:s.jsxs(Ct,{children:[s.jsx(sn,{}),s.jsxs("div",{className:`app-container${f?" menu-footer-hidden":""}`,children:[s.jsx(ht,{onNavigate:p,onStartGame:y,currentScreen:e}),s.jsxs(Dt,{children:[e==="guide"&&s.jsx(Ft,{onNavigate:p}),e==="help"&&s.jsx(Ht,{onNavigate:p}),e==="about"&&s.jsx(Wt,{onNavigate:p}),e==="menu"&&s.jsx(Gt,{onNavigate:p,onStartGame:y}),e==="game"&&a!=null&&s.jsx(tn,{stageNumber:a,onBack:N})]}),s.jsx(mt,{})]}),l&&typeof window!="undefined"&&screen.orientation?s.jsx("button",{type:"button",className:"orientation-lock-button",onClick:j,"aria-label":t(h?"header.orientationUnlock":"header.orientationLock"),title:t(h?"header.orientationUnlock":"header.orientationLock"),children:h?"ðŸ”’":"ðŸ”“"}):null,l&&s.jsx("button",{type:"button",className:"menu-footer-toggle",onClick:()=>u(g=>!g),"aria-label":t(f?"header.showMenuFooter":"header.hideMenuFooter"),title:t(f?"header.showMenuFooter":"header.hideMenuFooter"),children:f?"â˜°":"âœ•"})]})})};ze.createRoot(document.getElementById("root")).render(s.jsx(xt.StrictMode,{children:s.jsx(ln,{})}))});export default an();
