var wt=Object.defineProperty;var bt=(t,e,n)=>e in t?wt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var vt=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var xe=(t,e,n)=>(bt(t,typeof e!="symbol"?e+"":e,n),n);var Oe=(t,e,n)=>new Promise((a,o)=>{var r=f=>{try{h(n.next(f))}catch(u){o(u)}},c=f=>{try{h(n.throw(f))}catch(u){o(u)}},h=f=>f.done?a(f.value):Promise.resolve(f.value).then(r,c);h((n=n.apply(t,e)).next())});import{r as i,a as at,R as St}from"./vendor-ffc9ac40.js";import{W as xt,q as kt}from"./helmet-6da975a7.js";var ln=vt(Ye=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();var ct={exports:{}},Re={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ct=i,jt=Symbol.for("react.element"),Et=Symbol.for("react.fragment"),Rt=Object.prototype.hasOwnProperty,Nt=Ct.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Lt={key:!0,ref:!0,__self:!0,__source:!0};function it(t,e,n){var a,o={},r=null,c=null;n!==void 0&&(r=""+n),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(c=e.ref);for(a in e)Rt.call(e,a)&&!Lt.hasOwnProperty(a)&&(o[a]=e[a]);if(t&&t.defaultProps)for(a in e=t.defaultProps,e)o[a]===void 0&&(o[a]=e[a]);return{$$typeof:jt,type:t,key:r,ref:c,props:o,_owner:Nt.current}}Re.Fragment=Et;Re.jsx=it;Re.jsxs=it;ct.exports=Re;var s=ct.exports,$e={},Xe=at;$e.createRoot=Xe.createRoot,$e.hydrateRoot=Xe.hydrateRoot;class Tt extends i.Component{constructor(){super(...arguments);xe(this,"state",{hasError:!1})}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,a){console.error("[ChipBlockCrush]",n,a)}render(){return this.state.hasError?s.jsxs("div",{className:"error-boundary",children:[s.jsx("h2",{children:"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"}),s.jsx("p",{children:"íŽ˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ ì£¼ì„¸ìš”."}),s.jsx("button",{type:"button",onClick:()=>window.location.reload(),children:"ìƒˆë¡œê³ ì¹¨"})]}):this.props.children}}const _t="modulepreload",Mt=function(t){return"/ChipBlockCrush/"+t},Ke={},pe=function(e,n,a){if(!n||n.length===0)return e();const o=document.getElementsByTagName("link");return Promise.all(n.map(r=>{if(r=Mt(r),r in Ke)return;Ke[r]=!0;const c=r.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(!!a)for(let d=o.length-1;d>=0;d--){const S=o[d];if(S.href===r&&(!c||S.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${h}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":_t,c||(u.as="script",u.crossOrigin=""),u.href=r,document.head.appendChild(u),c)return new Promise((d,S)=>{u.addEventListener("load",d),u.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>e()).catch(r=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=r,window.dispatchEvent(c),!c.defaultPrevented)throw r})},Pt=(t,e)=>{const n=t[e];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((a,o)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(o.bind(null,new Error("Unknown variable dynamic import: "+e)))})},je=["ko","en","ja","zh"],Ot="ko",At={ko:"í•œêµ­ì–´",en:"English",ja:"æ—¥æœ¬èªž",zh:"ä¸­æ–‡"},ye={debug:(...t)=>{},info:(...t)=>console.info("[ChipBlockCrush]",...t),warn:(...t)=>console.warn("[ChipBlockCrush]",...t),error:(...t)=>console.error("[ChipBlockCrush]",...t)},Ve="language";class Je{detectBrowserLanguage(){const e=navigator.language.split("-")[0];return je.includes(e)?e:Ot}getStoredLanguage(){try{return localStorage.getItem(Ve)}catch(e){return ye.error("Failed to get stored language",{error:e}),null}}setLanguage(e){if(je.includes(e))try{localStorage.setItem(Ve,e),window.dispatchEvent(new CustomEvent("languageChanged",{detail:e})),ye.debug("Language changed",{language:e})}catch(n){ye.error("Failed to set language",{error:n,language:e})}}getCurrentLanguage(){const e=this.getStoredLanguage();return e&&je.includes(e)?e:this.detectBrowserLanguage()}}const Ae={},Q=()=>{const[t,e]=i.useState(()=>new Je().getCurrentLanguage()),[n,a]=i.useState(null),[o,r]=i.useState(!0);return i.useEffect(()=>{(()=>Oe(Ye,null,function*(){r(!0);try{if(Ae[t]){a(Ae[t]),r(!1);return}const u=yield Pt(Object.assign({"../locales/en.json":()=>pe(()=>import("./en-0d0c3768.js"),[]),"../locales/ja.json":()=>pe(()=>import("./ja-f1d73617.js"),[]),"../locales/ko.json":()=>pe(()=>import("./ko-3b0b0601.js"),[]),"../locales/zh.json":()=>pe(()=>import("./zh-67bd03a5.js"),[])}),`../locales/${t}.json`);Ae[t]=u.default,a(u.default)}catch(u){try{const d=yield pe(()=>import("./ko-3b0b0601.js"),[]);a(d.default)}catch(d){a({})}}finally{r(!1)}}))()},[t]),i.useEffect(()=>{const f=u=>{const d=u;d.detail&&(d.detail==="ko"||d.detail==="en"||d.detail==="ja"||d.detail==="zh")&&e(d.detail)};return window.addEventListener("languageChanged",f),()=>window.removeEventListener("languageChanged",f)},[]),{language:t,setLanguage:f=>{new Je().setLanguage(f),(f==="ko"||f==="en"||f==="ja"||f==="zh")&&e(f)},t:f=>{if(o||!n)return f;const u=f.split(".");let d=n;for(const S of u)if(d=d==null?void 0:d[S],d===void 0)break;return(typeof d=="string"?d:f)||f},isLoading:o}},Fe=i.memo(()=>{const{language:t,setLanguage:e}=Q();return s.jsx("select",{className:"language-selector",value:t,onChange:n=>e(n.target.value),"aria-label":"ì–¸ì–´ ì„ íƒ",children:je.map(n=>s.jsx("option",{value:n,children:At[n]},n))})});Fe.displayName="LanguageSelector";const Ze="chipBlockCrush_",U={get(t,e={}){var a,o;const n=Ze+t;try{const r=localStorage.getItem(n);return r===null?(a=e.fallback)!=null?a:null:JSON.parse(r)}catch(r){return e.silent||ye.warn("storage get failed",n,r),(o=e.fallback)!=null?o:null}},set(t,e,n={}){const a=Ze+t;try{localStorage.setItem(a,JSON.stringify(e))}catch(o){n.silent||ye.warn("storage set failed",a,o)}}},Ie="theme",It=()=>{if(typeof window=="undefined")return"dark";try{return window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}catch(t){return"dark"}},Be=t=>{if(typeof document=="undefined")return;document.documentElement.setAttribute("data-theme",t);const e=document.querySelector('meta[name="theme-color"]');e&&e.setAttribute("content",t==="light"?"#f5f5f8":"#1a1a2e")},ut=()=>{const[t,e]=i.useState(()=>{const o=U.get(Ie,{fallback:null,silent:!0});return o==="light"||o==="dark"?o:It()}),n=i.useCallback(()=>{e(o=>{const r=o==="light"?"dark":"light";return U.set(Ie,r,{silent:!0}),Be(r),r})},[]),a=i.useCallback(o=>{e(o),U.set(Ie,o,{silent:!0}),Be(o)},[]);return i.useEffect(()=>{Be(t)},[t]),{theme:t,toggleTheme:n,setTheme:a,isLight:t==="light",isDark:t==="dark"}},dt=i.memo(()=>{const{t}=Q(),{theme:e,toggleTheme:n}=ut(),a=e==="light";return s.jsx("button",{type:"button",className:"theme-toggle",onClick:n,title:t(a?"header.darkMode":"header.lightMode"),"aria-label":t(a?"header.darkMode":"header.lightMode"),children:a?"ðŸŒ™":"â˜€ï¸"})});dt.displayName="ThemeToggle";class Bt{constructor(){xe(this,"enabled",!0);xe(this,"ctx",null)}setEnabled(e){this.enabled=e}getContext(){return typeof window=="undefined"||!window.AudioContext?null:(this.ctx||(this.ctx=new window.AudioContext),this.ctx)}playClick(){if(!this.enabled)return;const e=this.getContext();if(!e)return;const n=()=>{try{const a=e.currentTime,o=e.createOscillator(),r=e.createGain();o.connect(r),r.connect(e.destination),o.type="sine",o.frequency.setValueAtTime(880,a),o.frequency.exponentialRampToValueAtTime(440,a+.05),r.gain.setValueAtTime(.12,a),r.gain.exponentialRampToValueAtTime(.001,a+.08),o.start(a),o.stop(a+.08)}catch(a){}};e.state==="suspended"?e.resume().then(n).catch(()=>{}):n()}playPlace(){if(!this.enabled)return;const e=this.getContext();if(!e)return;const n=()=>{try{const a=e.currentTime,o=e.createOscillator(),r=e.createGain();o.connect(r),r.connect(e.destination),o.type="sine",o.frequency.setValueAtTime(660,a),r.gain.setValueAtTime(.1,a),r.gain.exponentialRampToValueAtTime(.001,a+.06),o.start(a),o.stop(a+.06)}catch(a){}};e.state==="suspended"?e.resume().then(n).catch(()=>{}):n()}}const ze=new Bt,ht=i.memo(({onNavigate:t,onStartGame:e})=>{const{t:n}=Q(),[a,o]=i.useState(()=>{var u;return(u=U.get("soundEnabled",{fallback:!0,silent:!0}))!=null?u:!0}),[r,c]=i.useState(!1);i.useEffect(()=>{ze.setEnabled(a),U.set("soundEnabled",a,{silent:!0})},[a]),i.useEffect(()=>(document.body.style.overflow=r?"hidden":"",()=>{document.body.style.overflow=""}),[r]);const h=u=>{t==null||t(u),c(!1)},f=()=>{o(u=>!u),a&&ze.playClick()};return s.jsx("header",{className:"header",children:s.jsxs("div",{className:"header-content",children:[s.jsxs("div",{className:"header-logo",onClick:()=>h("menu"),role:"button",tabIndex:0,onKeyDown:u=>u.key==="Enter"&&h("menu"),children:[s.jsx("img",{src:"/ChipBlockCrush/ChipGames_Logo.png",alt:n("header.logo"),className:"header-logo-img"}),s.jsx("span",{className:"header-game-title",children:n("header.gameTitle")})]}),r&&s.jsx("div",{className:"header-nav-overlay",onClick:()=>c(!1),"aria-hidden":!0}),s.jsxs("nav",{className:`header-nav ${r?"mobile-open":""}`,children:[s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>e?e():h("menu"),children:n("header.playGame")}),s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>h("guide"),children:n("header.guide")}),s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>h("help"),children:n("header.help")}),s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>h("about"),children:n("header.about")})]}),s.jsxs("div",{className:"header-right",children:[s.jsx(dt,{}),s.jsx("button",{type:"button",className:"header-sound-button",onClick:f,title:n(a?"header.soundOff":"header.soundOn"),"aria-label":n(a?"header.soundOff":"header.soundOn"),children:a?"ðŸ”Š":"ðŸ”‡"}),s.jsx(Fe,{}),s.jsxs("button",{type:"button",className:"header-hamburger",onClick:()=>c(u=>!u),"aria-label":"ë©”ë‰´","aria-expanded":r,children:[s.jsx("span",{className:`hamburger-line ${r?"active":""}`}),s.jsx("span",{className:`hamburger-line ${r?"active":""}`}),s.jsx("span",{className:`hamburger-line ${r?"active":""}`})]})]})]})})});ht.displayName="Header";const $t="1.0.2",ft=i.memo(()=>{const{t}=Q();return s.jsx("footer",{className:"footer",role:"contentinfo",children:s.jsxs("div",{className:"footer-content",children:[s.jsxs("nav",{className:"footer-links",children:[s.jsx("a",{href:"#privacy",className:"footer-link",children:t("footer.privacy")}),s.jsx("a",{href:"#contact",className:"footer-link",children:t("footer.contact")})]}),s.jsx("div",{className:"footer-center",children:s.jsx(Fe,{})}),s.jsxs("div",{className:"footer-copyright",children:[t("footer.copyright")," | v",$t]})]})})});ft.displayName="Footer";const zt=({children:t})=>s.jsx("div",{className:"game-container",children:t}),Gt=({onNavigate:t,onStartGame:e})=>{const{t:n}=Q();return s.jsxs("div",{className:"menu-screen",children:[s.jsx("div",{className:"menu-logo-wrap",children:s.jsx("img",{src:"/ChipBlockCrush/ChipGames_Logo.png",alt:n("header.logo"),className:"menu-logo"})}),s.jsx("h1",{className:"menu-title",children:n("header.gameTitle")}),s.jsx("p",{className:"menu-desc",children:n("menu.subtitle")}),s.jsx("button",{type:"button",className:"menu-play-btn",onClick:e,children:n("header.playGame")}),s.jsxs("nav",{className:"menu-links",children:[s.jsx("button",{type:"button",className:"menu-link",onClick:()=>t("guide"),children:n("header.guide")}),s.jsx("button",{type:"button",className:"menu-link",onClick:()=>t("help"),children:n("header.help")}),s.jsx("button",{type:"button",className:"menu-link",onClick:()=>t("about"),children:n("header.about")})]})]})},Dt=({onNavigate:t})=>{const{t:e}=Q();return s.jsxs("div",{className:"guide-screen",children:[s.jsx("h1",{className:"guide-title",children:e("guide.title")}),s.jsx("p",{className:"guide-description",children:e("guide.description")}),s.jsxs("ol",{className:"guide-steps",children:[s.jsx("li",{children:e("guide.step1")}),s.jsx("li",{children:e("guide.step2")}),s.jsx("li",{children:e("guide.step3")})]}),s.jsx("button",{type:"button",className:"guide-back",onClick:()=>t("stageSelect"),children:e("header.playGame")})]})},Ft=({onNavigate:t})=>{const{t:e}=Q();return s.jsxs("div",{className:"help-screen",children:[s.jsx("h1",{className:"help-title",children:e("help.title")}),s.jsxs("div",{className:"help-faq",children:[s.jsx("p",{children:e("help.faq1")}),s.jsx("p",{children:e("help.faq2")})]}),s.jsx("button",{type:"button",className:"help-back",onClick:()=>t("stageSelect"),children:e("header.playGame")})]})},Ht=({onNavigate:t})=>{const{t:e}=Q();return s.jsxs("div",{className:"about-screen",children:[s.jsx("h1",{className:"about-title",children:e("about.title")}),s.jsx("p",{className:"about-description",children:e("about.description")}),s.jsx("button",{type:"button",className:"about-back",onClick:()=>t("stageSelect"),children:e("header.playGame")})]})},Wt=16/9;function Yt(t,e){const n=Wt,a=t/e;let o,r;return a>n?(r=e,o=e*n):(o=t,r=t/n),{width:Math.floor(o),height:Math.floor(r)}}const He=[[[1]],[[1,1]],[[1],[1]],[[1,1,1]],[[1],[1],[1]],[[1,1],[1,0]],[[1,1],[0,1]],[[1,0],[1,1]],[[0,1],[1,1]],[[1,1],[1,1]],[[1,1,1,1]],[[1],[1],[1],[1]],[[1,1,1],[1,0,0]],[[1,1,1],[0,0,1]],[[1,1,1],[0,1,0]],[[1,0],[1,1],[1,0]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]],[[1,1],[1,1],[1,0]],[[1,1],[0,1],[0,1]],[[1,1,1,1,1]],[[1],[1],[1],[1],[1]],[[1,1,1],[1,1,0]],[[1,1,1],[0,1,1]],[[0,1,0],[1,1,1],[0,1,0]],[[1,1,1],[0,1,0],[0,1,0]],[[1,0,0],[1,1,1],[1,0,0]]],Qe=["#a8b5ff","#c5a3ff","#ffb3e6","#7fdfd4","#ffd89b","#ff9f9f","#b5c4ff","#d4b3ff","#ffc4e6","#8fefdf","#ffe0ab","#ffafaf","#a8e6cf","#dda0dd","#87ceeb","#f0e68c"];function et(t){return Math.abs(Math.floor(Math.sin(t)*1e6))%He.length}function Ee(t){return Qe[t%Qe.length]}const Ge=9,tt=3,qt=10,nt=[0,20,30,40,50,60,70,80,90,100];function ot(t=Ge){return Array.from({length:t},()=>Array(t).fill(0))}function de(t,e,n,a){var h,f;const o=e.length,r=(f=(h=e[0])==null?void 0:h.length)!=null?f:0,c=t.length;if(n<0||a<0||n+o>c||a+r>c)return!1;for(let u=0;u<o;u++)for(let d=0;d<r;d++)if(e[u][d]&&t[n+u][a+d]!==0)return!1;return!0}const gt=15;function Ut(t,e,n,a,o,r){var d,S;const c=t.map(x=>[...x]),h=e.length,f=(S=(d=e[0])==null?void 0:d.length)!=null?S:0,u=o<<4|r&gt;for(let x=0;x<h;x++)for(let M=0;M<f;M++)e[x][M]&&(c[n+x][a+M]=u);return c}function Xt(t){return t>0?t&gt:0}function We(t){var o,r;let e=0,n=0,a=0;for(let c=0;c<t.length;c++)for(let h=0;h<((r=(o=t[0])==null?void 0:o.length)!=null?r:0);h++)t[c][h]&&(e+=c,n+=h,a++);return a===0?{row:0,col:0}:{row:Math.floor(e/a),col:Math.floor(n/a)}}const ke=2;function st(t,e,n,a){const o=We(e),r=n-o.row,c=a-o.col;let h=null,f=1/0;for(let u=-ke;u<=ke;u++)for(let d=-ke;d<=ke;d++){const S=r+u,x=c+d;if(!de(t,e,S,x))continue;const M=S+o.row,E=x+o.col,v=Math.abs(M-n)+Math.abs(E-a);v<f&&(f=v,h={row:S,col:x})}return h}function Kt(t){const e=t.length,n=[],a=[];for(let o=0;o<e;o++){let r=!0,c=!0;for(let h=0;h<e;h++)t[o][h]===0&&(r=!1),t[h][o]===0&&(c=!1);r&&n.push(o),c&&a.push(o)}return{rows:n,cols:a}}function Vt(t,e,n){const a=t.length,o=t.map(r=>[...r]);for(const r of e)for(let c=0;c<a;c++)o[r][c]=0;for(const r of n)for(let c=0;c<a;c++)o[c][r]=0;return o}function Jt(t,e){var o;const n=t*qt,a=(o=nt[Math.min(e,nt.length-1)])!=null?o:0;return n+a}function Zt(t,e){var a,o;const n=t.length;for(const r of e){const c=He[r];if(!c)continue;const h=c.length,f=(o=(a=c[0])==null?void 0:a.length)!=null?o:0;for(let u=0;u<=n-h;u++)for(let d=0;d<=n-f;d++)if(de(t,c,u,d))return!0}return!1}function De(t){var e;return(e=He[t])!=null?e:null}function Qt(t,e,n,a){const r=Math.min(t/400,e/300,1.2),c=Math.max(28,36*r),h=Math.max(56,72*r),f=Math.max(56,70*r),u=Math.max(22,28*r),d=Math.max(44,52*r),S=4,x=t-h-8*2,M=e-c-8*2,E=Math.min(x/n,M/n),v=8+(x-E*n)/2,H=c+8+(M-E*n)/2,G={x:8,y:8,w:f,h:u},k=[],O=t-h+(h-d)/2;let ee=c+8;for(let Y=0;Y<a;Y++)k.push({x:O,y:ee,w:d,h:d}),ee+=d+S;return{padding:8,scale:r,topBarHeight:c,rightPanelWidth:h,menuRect:G,trayRects:k,offsetX:v,offsetY:H,cellSize:E,gridSize:n,traySlotSize:d}}const mt=i.forwardRef(({grid:t,onCellClick:e,preview:n,score:a=0,scoreLabel:o,bestScore:r=0,bestScoreLabel:c,onBack:h,backLabel:f,placeHintLabel:u,currentBlockIndices:d=[],selectedIndex:S=null,onBlockTrayClick:x,onBlockTrayPointerDown:M,onLayout:E,isLandscapeMode:v=!1},H)=>{const G=i.useRef(null),k=i.useRef(null),O=i.useRef(null),ee=i.useRef(v);ee.current=v;const Y=t.length;i.useImperativeHandle(H,()=>({getCellFromPoint(l,w){const m=k.current;if(!m||!O.current)return null;const b=m.getBoundingClientRect();let g=l-b.left,C=w-b.top;if(ee.current){const R=parseInt(m.style.width||"0",10),J=parseInt(m.style.height||"0",10);if(R&&J){const re=l-b.left;g=w-b.top,C=J-re}}const j=O.current,L=Math.floor((g-j.offsetX)/j.cellSize),p=Math.floor((C-j.offsetY)/j.cellSize);return p>=0&&p<j.gridSize&&L>=0&&L<j.gridSize?{row:p,col:L}:null},getCellSize(){var l,w;return(w=(l=O.current)==null?void 0:l.cellSize)!=null?w:24}}),[]);const D=i.useCallback((l,w,m)=>{var ae,ue;const b=Math.max(1,d.length),g=Qt(w,m,Y,b);O.current=g,E==null||E({cellSize:g.cellSize});const{padding:C,scale:j,rightPanelWidth:L,menuRect:p,trayRects:R,offsetX:J,offsetY:re}=g,we=8;l.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--canvas-bg").trim()||"#1a1a1a",l.fillRect(0,0,w,m);const X=document.documentElement.getAttribute("data-theme")==="light",Ne=X?"rgba(220, 222, 235, 0.95)":"rgba(40, 42, 62, 0.95)",Le=X?"rgba(124, 138, 255, 0.55)":"rgba(168, 181, 255, 0.5)",Te=X?"rgba(0,0,0,0.03)":"rgba(255,255,255,0.04)",_e=X?"rgba(0,0,0,0.12)":"rgba(255,255,255,0.22)",be=X?"#2d2d2d":"#e8e8e8",y=X?"rgba(168, 181, 255, 0.35)":"rgba(102, 126, 234, 0.4)",$=X?"rgba(124, 138, 255, 0.6)":"rgba(168, 181, 255, 0.6)",Z=Math.max(10,12*j);l.font=`600 ${Z}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,l.textAlign="left",l.textBaseline="middle",h&&f&&(l.fillStyle=y,l.strokeStyle=$,l.lineWidth=2,typeof l.roundRect=="function"?(l.beginPath(),l.roundRect(p.x,p.y,p.w,p.h,8),l.fill(),l.stroke()):(l.fillRect(p.x,p.y,p.w,p.h),l.strokeRect(p.x,p.y,p.w,p.h)),l.fillStyle=be,l.textAlign="center",l.fillText(f,p.x+p.w/2,p.y+p.h/2),l.textAlign="left");const q=p.x+p.w+C,W=p.y+p.h/2,ne=Z+2;l.textAlign="left",l.fillStyle=be,l.fillText(o!=null?`${o}: ${a}`:String(a),q,W,w-q-L-C),c!=null&&l.fillText(`${c}: ${r}`,q,W+ne,w-q-L-C),d.forEach((F,V)=>{var ge,me;const T=R[V];if(!T)return;const z=De(F);if(S===V&&(l.fillStyle="rgba(168, 181, 255, 0.25)",l.strokeStyle="rgba(168, 181, 255, 0.8)",l.lineWidth=2,typeof l.roundRect=="function"&&(l.beginPath(),l.roundRect(T.x-2,T.y-2,T.w+4,T.h+4,10),l.fill(),l.stroke())),z){const Me=z.length,Pe=(me=(ge=z[0])==null?void 0:ge.length)!=null?me:0,ie=Math.min((T.w-8)/Pe,(T.h-8)/Me,14),pt=T.x+(T.w-Pe*ie)/2,yt=T.y+(T.h-Me*ie)/2;l.fillStyle=Ee(F),l.strokeStyle="rgba(255,255,255,0.4)",l.lineWidth=1;for(let ve=0;ve<Me;ve++)for(let Se=0;Se<Pe;Se++)if(z[ve][Se]){const qe=pt+Se*ie+1,Ue=yt+ve*ie+1;l.fillRect(qe,Ue,ie-2,ie-2),l.strokeRect(qe,Ue,ie-2,ie-2)}}});const N=g.cellSize*Y,A=g.cellSize*Y,K=J-2,I=re-2,_=N+4,P=A+4;l.beginPath(),typeof l.roundRect=="function"?l.roundRect(K,I,_,P,we):l.rect(K,I,_,P),l.fillStyle=Ne,l.fill(),l.strokeStyle=Le,l.lineWidth=3,l.stroke();for(let F=0;F<Y;F++)for(let V=0;V<Y;V++){const T=J+V*g.cellSize,z=re+F*g.cellSize,ce=t[F][V];ce>0?(l.fillStyle=Ee(Xt(ce)),l.fillRect(T+2,z+2,g.cellSize-4,g.cellSize-4),l.strokeStyle="rgba(255,255,255,0.35)",l.lineWidth=1,l.strokeRect(T+2,z+2,g.cellSize-4,g.cellSize-4)):(l.fillStyle=Te,l.fillRect(T+1,z+1,g.cellSize-2,g.cellSize-2),l.strokeStyle=_e,l.lineWidth=1,l.strokeRect(T+1,z+1,g.cellSize-2,g.cellSize-2))}if(n&&n.shape){const F=n.colorIndex!==void 0?Ee(n.colorIndex):"rgba(168, 181, 255, 0.6)";l.fillStyle=F,l.globalAlpha=.7,l.strokeStyle="rgba(255,255,255,0.6)",l.lineWidth=2;const V=n.shape.length,T=(ue=(ae=n.shape[0])==null?void 0:ae.length)!=null?ue:0;for(let z=0;z<V;z++)for(let ce=0;ce<T;ce++)if(n.shape[z][ce]){const ge=J+(n.col+ce)*g.cellSize+2,me=re+(n.row+z)*g.cellSize+2;l.fillRect(ge,me,g.cellSize-4,g.cellSize-4),l.strokeRect(ge,me,g.cellSize-4,g.cellSize-4)}l.globalAlpha=1}},[t,Y,n,a,o,r,c,f,h,d,S,E]);i.useEffect(()=>{const l=G.current,w=k.current;if(!l||!w)return;const m=w.getContext("2d");if(!m)return;const b=()=>{const C=l.clientWidth,j=l.clientHeight,{width:L,height:p}=Yt(C,j),R=window.devicePixelRatio||1;w.width=L*R,w.height=p*R,w.style.width=`${L}px`,w.style.height=`${p}px`,m.setTransform(1,0,0,1,0,0),m.scale(R,R),D(m,L,p)};b();const g=new ResizeObserver(b);return g.observe(l),()=>g.disconnect()},[D]),i.useEffect(()=>{const l=k.current;if(!l)return;const w=l.getContext("2d");if(!w)return;const m=parseInt(l.style.width||"0",10),b=parseInt(l.style.height||"0",10);m&&b&&D(w,m,b)},[t,D]);const te=i.useCallback((l,w)=>{const m=k.current;if(!m)return null;const b=m.getBoundingClientRect(),g=l-b.left,C=w-b.top;if(!v)return{px:g,py:C};const j=parseInt(m.style.width||"0",10),L=parseInt(m.style.height||"0",10);if(!j||!L)return{px:g,py:C};const p=C,R=L-g;return{px:p,py:R}},[v]),B=i.useCallback(l=>{const w="touches"in l?l.touches[0].clientX:l.clientX,m="touches"in l?l.touches[0].clientY:l.clientY,b=te(w,m);if(!b||!O.current||!M)return;const C=O.current.trayRects.findIndex(j=>b.px>=j.x&&b.px<=j.x+j.w&&b.py>=j.y&&b.py<=j.y+j.h);C>=0&&M(C,w,m)},[te,M]),le=i.useCallback((l,w)=>{const m=te(l,w);if(!m)return;const{px:b,py:g}=m,C=O.current;if(!C)return;if(h&&f){const R=C.menuRect;if(b>=R.x&&b<=R.x+R.w&&g>=R.y&&g<=R.y+R.h){h();return}}const j=C.trayRects.findIndex(R=>b>=R.x&&b<=R.x+R.w&&g>=R.y&&g<=R.y+R.h);if(j>=0&&x){x(j);return}const L=Math.floor((b-C.offsetX)/C.cellSize),p=Math.floor((g-C.offsetY)/C.cellSize);e&&p>=0&&p<C.gridSize&&L>=0&&L<C.gridSize&&e(p,L)},[te,h,f,x,e]),oe=i.useCallback(l=>{le(l.clientX,l.clientY)},[le]),se=i.useRef(null),he=i.useCallback(l=>{se.current={x:l.touches[0].clientX,y:l.touches[0].clientY,t:Date.now()}},[]),fe=i.useCallback(l=>{const w=se.current;if(se.current=null,!w||!l.changedTouches[0])return;const m=l.changedTouches[0].clientX-w.x,b=l.changedTouches[0].clientY-w.y;Date.now()-w.t<=400&&m*m+b*b<=400&&(l.preventDefault(),le(l.changedTouches[0].clientX,l.changedTouches[0].clientY))},[le]);return s.jsx("div",{ref:G,className:"block-crush-canvas-wrap",children:s.jsx("canvas",{ref:k,className:"block-crush-canvas",onClick:oe,onMouseDown:B,onTouchStart:l=>{B(l),he(l)},onTouchEnd:fe,"aria-label":u})})});mt.displayName="BlockCrushCanvas";const rt="landscapeMode",lt="highScore",en=({stageNumber:t,onBack:e})=>{const{t:n}=Q(),a=i.useRef(null),[o,r]=i.useState(()=>ot(Ge)),[c,h]=i.useState([]),[f,u]=i.useState(null),[d,S]=i.useState(0),[x,M]=i.useState(()=>{if(typeof window=="undefined")return 0;const y=U.get(lt,{fallback:0,silent:!0});return typeof y=="number"&&y>=0?y:0}),[E,v]=i.useState(!1),[H,G]=i.useState(1),[k,O]=i.useState(()=>{if(typeof window=="undefined")return!1;const y=U.get(rt,{fallback:!1,silent:!0});return y!=null?y:!1}),[ee,Y]=i.useState(()=>typeof window=="undefined"?!1:window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0),[D,te]=i.useState(null),[B,le]=i.useState(null),[oe,se]=i.useState(null),[he,fe]=i.useState(null),[l,w]=i.useState(28),m=i.useRef(null),b=i.useRef(null),g=i.useRef(null),C=i.useRef(null),j=i.useRef(null),L=i.useRef(null),p=i.useRef(null),R=8,J=t*1e3,re=i.useCallback(()=>{const y=[];for(let $=0;$<tt;$++)y.push(et(J+Date.now()+$));h(y)},[J]);i.useEffect(()=>{re()},[re]);const we=i.useCallback(()=>{const y=!k;O(y),U.set(rt,y,{silent:!0})},[k]);i.useEffect(()=>{const y=()=>{typeof window!="undefined"&&Y(window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0)};return window.addEventListener("resize",y),window.addEventListener("orientationchange",y),()=>{window.removeEventListener("resize",y),window.removeEventListener("orientationchange",y)}},[]),i.useEffect(()=>{if(c.length===0)return;Zt(o,c)||v(!0)},[o,c]),i.useEffect(()=>{d<=x||(M(d),U.set(lt,d,{silent:!0}))},[d,x]);const X=i.useCallback((y,$,Z)=>{const q=c[Z],W=De(q);if(!W||!de(o,W,y,$))return;ze.playPlace();let ne=Ut(o,W,y,$,H,q);G(_=>_+1);let N=0;for(;;){const{rows:_,cols:P}=Kt(ne);if(_.length===0&&P.length===0)break;N+=_.length+P.length,ne=Vt(ne,_,P)}const A=W.flat().filter(Boolean).length,K=Jt(A,N);S(_=>_+K),r(ne);const I=c.filter((_,P)=>P!==Z);I.length<tt&&I.push(et(J+Date.now()+I.length)),h(I),u(null)},[o,c,H,J]),Ne=i.useCallback((y,$)=>{if(!E&&f!==null){X(y,$,f);return}},[E,f,X]),Le=i.useCallback((y,$,Z)=>{if(E)return;const q=c[y],W=De(q);W&&(te({x:$,y:Z,index:y,shapeIdx:q,shape:W}),C.current={index:y})},[c,E]),Te=i.useCallback(y=>{E||u($=>$===y?null:y)},[E]);g.current=B,m.current=oe,i.useEffect(()=>{if(!D&&!B)return;const y=(N,A)=>{const K=g.current;if(K&&j.current?(j.current.style.left=`${N}px`,j.current.style.top=`${A}px`):fe({x:N,y:A}),D&&!B){const I=N-D.x,_=A-D.y;if(Math.sqrt(I*I+_*_)>=R){const P={index:D.index,shapeIdx:D.shapeIdx,shape:D.shape};le(P),g.current=P,te(null),C.current=null,fe({x:N,y:A})}}K&&(p.current={x:N,y:A},L.current==null&&(L.current=requestAnimationFrame(()=>{var ae;L.current=null;const I=p.current,_=g.current;if(!I||!_)return;const P=(ae=a.current)==null?void 0:ae.getCellFromPoint(I.x,I.y);if(P){b.current=P;const ue=We(_.shape),F=P.row-ue.row,V=P.col-ue.col,T=de(o,_.shape,F,V)?{row:F,col:V}:st(o,_.shape,P.row,P.col);if(T){const z=m.current;(!z||z.row!==T.row||z.col!==T.col)&&(se(T),m.current=T)}else m.current!==null&&(se(null),m.current=null)}else m.current!==null&&(se(null),m.current=null)})))},$=N=>y(N.clientX,N.clientY),Z=N=>{N.preventDefault(),y(N.touches[0].clientX,N.touches[0].clientY)},q=(N,A)=>{var P;const K=m.current,I=g.current,_=b.current;if(I){const ae=N!=null&&A!=null,ue=ae&&((P=a.current)==null?void 0:P.getCellFromPoint(N,A))!=null;if(!(ae&&!ue)){let F=K&&de(o,I.shape,K.row,K.col)?K:_?st(o,I.shape,_.row,_.col):null;F&&X(F.row,F.col,I.index)}}L.current!=null&&(cancelAnimationFrame(L.current),L.current=null),p.current=null,le(null),te(null),se(null),fe(null),m.current=null,b.current=null,g.current=null,C.current=null},W=N=>{window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",W),q(N.clientX,N.clientY)},ne=N=>{window.removeEventListener("touchmove",Z,{capture:!0}),window.removeEventListener("touchend",ne,{capture:!0});const A=N.changedTouches[0];q(A==null?void 0:A.clientX,A==null?void 0:A.clientY)};return window.addEventListener("mousemove",$),window.addEventListener("mouseup",W),window.addEventListener("touchmove",Z,{passive:!1,capture:!0}),window.addEventListener("touchend",ne,{capture:!0}),()=>{window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",W),window.removeEventListener("touchmove",Z,{capture:!0}),window.removeEventListener("touchend",ne,{capture:!0})}},[D,B,o,X]);const _e=i.useMemo(()=>!B||!oe||!de(o,B.shape,oe.row,oe.col)?null:{shape:B.shape,row:oe.row,col:oe.col,colorIndex:B.shapeIdx},[B,oe,o]),be=()=>{r(ot(Ge)),S(0),v(!1),u(null),le(null),se(null),G(1),re()};return s.jsxs("div",{className:"game-screen",children:[s.jsx("div",{className:`game-board-container ${k?"landscape-mode":""}`,children:s.jsx("div",{className:`game-area ${E?"game-over":""}`,children:s.jsx("div",{className:"game-view-16-9",children:s.jsx(mt,{ref:a,grid:o,onCellClick:Ne,preview:_e,onLayout:y=>w(y.cellSize),score:d,scoreLabel:n("game.score"),bestScore:x,bestScoreLabel:n("game.bestScore"),onBack:e,backLabel:n("game.backToStage"),placeHintLabel:n("game.placeHint"),currentBlockIndices:c,selectedIndex:f,onBlockTrayClick:Te,onBlockTrayPointerDown:Le,isLandscapeMode:k})})})}),ee&&s.jsxs("button",{type:"button",className:`orientation-toggle-button ${k?"landscape-mode":""}`,onClick:we,"aria-label":n(k?"game.switchToPortrait":"game.switchToLandscape"),title:n(k?"game.switchToPortrait":"game.switchToLandscape"),children:[s.jsx("span",{className:"orientation-icon",children:k?"ðŸ“±":"ðŸ”„"}),s.jsx("span",{className:"orientation-text",children:n(k?"game.portraitMode":"game.landscapeMode")})]}),B&&he&&typeof document!="undefined"&&at.createPortal(s.jsx("div",{ref:j,className:`game-drag-ghost ${k?"landscape-mode":""}`,style:{left:he.x,top:he.y},"aria-hidden":!0,children:s.jsx(tn,{shape:B.shape,colorIndex:B.shapeIdx,size:l})}),document.body),E&&s.jsx("div",{className:"game-overlay",children:s.jsxs("div",{className:"game-over-box",children:[s.jsx("h2",{children:n("game.gameOver")}),s.jsxs("p",{children:[n("game.score"),": ",d]}),s.jsxs("p",{className:"game-over-best",children:[n("game.bestScore"),": ",x]}),s.jsxs("div",{className:"game-over-buttons",children:[s.jsx("button",{type:"button",onClick:be,children:n("game.playAgain")}),s.jsx("button",{type:"button",onClick:e,children:n("game.backToStage")})]})]})})]})};function tn({shape:t,colorIndex:e,size:n=24}){var O,ee;const a=Ee(e),o=t.length,r=(ee=(O=t[0])==null?void 0:O.length)!=null?ee:0,c=n,h=r*c,f=o*c,u=We(t),d=u.col*c+c/2,S=u.row*c+c/2,x=h/2-d,M=f/2-S,E=4,v=Math.min(0,x)-E,H=Math.min(0,M)-E,G=h+Math.abs(x)+E*2,k=f+Math.abs(M)+E*2;return s.jsx("svg",{width:G,height:k,viewBox:`${v} ${H} ${G} ${k}`,className:"block-preview-svg",children:s.jsx("g",{transform:`translate(${x}, ${M})`,children:t.map((Y,D)=>Y.map((te,B)=>te?s.jsx("rect",{x:B*c+1,y:D*c+1,width:c-1,height:c-1,fill:a,stroke:"rgba(255,255,255,0.4)",strokeWidth:1,rx:4},`${D}-${B}`):null))})})}const nn="https://chipgames.github.io/ChipBlockCrush/",on=({title:t,description:e,keywords:n,url:a=nn})=>{const{t:o,language:r}=Q(),c=t!=null?t:o("seo.title"),h=e!=null?e:o("seo.description"),f=n!=null?n:o("seo.keywords"),u=r!=="ko"?`?lang=${r}`:"";return s.jsxs(xt,{children:[s.jsx("title",{children:c}),s.jsx("meta",{name:"description",content:h}),s.jsx("meta",{name:"keywords",content:f}),s.jsx("meta",{property:"og:title",content:c}),s.jsx("meta",{property:"og:description",content:h}),s.jsx("meta",{property:"og:type",content:"website"}),s.jsx("meta",{property:"og:url",content:a+u}),s.jsx("link",{rel:"canonical",href:a+u})]})};function sn(){if(typeof window=="undefined"||!("serviceWorker"in navigator))return;const t="/ChipBlockCrush/";window.addEventListener("load",()=>{navigator.serviceWorker.register(`${t}sw.js`,{scope:t}).catch(()=>{})})}const Ce="chipBlockCrush_orientationLocked",rn=()=>{ut();const{t}=Q();i.useEffect(()=>{sn()},[]);const[e,n]=i.useState("menu"),[a,o]=i.useState(null),[r,c]=i.useState(()=>typeof window=="undefined"?!1:window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0),[h,f]=i.useState(()=>{var v;return(v=typeof window!="undefined"&&U.get(Ce,{fallback:"false"})==="true")!=null?v:!1}),[u,d]=i.useState(!1),S=v=>{n(v)},x=()=>{o(1),n("game")},M=()=>{n("menu"),o(null)},E=()=>Oe(Ye,null,function*(){const v=screen;if(typeof window=="undefined"||!v.orientation){alert(t("header.orientationUnlock"));return}const H=v.orientation;try{if(h)yield H.unlock(),f(!1),U.set(Ce,"false",{silent:!0});else{try{const O=document.documentElement;O.requestFullscreen?yield O.requestFullscreen():O.webkitRequestFullscreen&&(yield O.webkitRequestFullscreen())}catch(O){}const k=H.type.startsWith("portrait")?"portrait":"landscape";yield H.lock(k),f(!0),U.set(Ce,"true",{silent:!0})}}catch(G){console.warn("í™”ë©´ ê³ ì • ì‹¤íŒ¨:",G);const k=G instanceof Error?G.message:String(G);(k.includes("not allowed")||k.includes("denied"))&&alert(t("header.orientationUnlock"))}});return i.useEffect(()=>{const v=()=>{typeof window!="undefined"&&c(window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0)};return window.addEventListener("resize",v),window.addEventListener("orientationchange",v),()=>{window.removeEventListener("resize",v),window.removeEventListener("orientationchange",v)}},[]),i.useEffect(()=>{const v=screen;if(typeof window=="undefined"||!v.orientation||!h)return;const H=v.orientation,k=H.type.startsWith("portrait")?"portrait":"landscape";H.lock(k).catch(()=>{f(!1),U.set(Ce,"false",{silent:!0})})},[]),s.jsx(Tt,{children:s.jsxs(kt,{children:[s.jsx(on,{}),s.jsxs("div",{className:`app-container${u?" menu-footer-hidden":""}`,children:[s.jsx(ht,{onNavigate:S,onStartGame:x,currentScreen:e}),s.jsxs(zt,{children:[e==="guide"&&s.jsx(Dt,{onNavigate:S}),e==="help"&&s.jsx(Ft,{onNavigate:S}),e==="about"&&s.jsx(Ht,{onNavigate:S}),e==="menu"&&s.jsx(Gt,{onNavigate:S,onStartGame:x}),e==="game"&&a!=null&&s.jsx(en,{stageNumber:a,onBack:M})]}),s.jsx(ft,{})]}),r&&typeof window!="undefined"&&screen.orientation?s.jsx("button",{type:"button",className:"orientation-lock-button",onClick:E,"aria-label":t(h?"header.orientationUnlock":"header.orientationLock"),title:t(h?"header.orientationUnlock":"header.orientationLock"),children:h?"ðŸ”’":"ðŸ”“"}):null,r&&s.jsx("button",{type:"button",className:"menu-footer-toggle",onClick:()=>d(v=>!v),"aria-label":t(u?"header.showMenuFooter":"header.hideMenuFooter"),title:t(u?"header.showMenuFooter":"header.hideMenuFooter"),children:u?"â˜°":"âœ•"})]})})};$e.createRoot(document.getElementById("root")).render(s.jsx(St.StrictMode,{children:s.jsx(rn,{})}))});export default ln();
