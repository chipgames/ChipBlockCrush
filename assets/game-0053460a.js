var tt=Object.defineProperty;var nt=(o,t,n)=>t in o?tt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n;var _e=(o,t,n)=>(nt(o,typeof t!="symbol"?t+"":t,n),n);var Ne=(o,t,n)=>new Promise((c,s)=>{var r=u=>{try{h(n.next(u))}catch(f){s(f)}},l=u=>{try{h(n.throw(u))}catch(f){s(f)}},h=u=>u.done?c(u.value):Promise.resolve(u.value).then(r,l);h((n=n.apply(o,t)).next())});import{r as i,j as M,a as ot}from"./vendor-dfffe2de.js";const st="modulepreload",rt=function(o){return"/ChipBlockCrush/"+o},De={},he=function(t,n,c){if(!n||n.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(n.map(r=>{if(r=rt(r),r in De)return;De[r]=!0;const l=r.endsWith(".css"),h=l?'[rel="stylesheet"]':"";if(!!c)for(let a=s.length-1;a>=0;a--){const x=s[a];if(x.href===r&&(!l||x.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${h}`))return;const f=document.createElement("link");if(f.rel=l?"stylesheet":st,l||(f.as="script",f.crossOrigin=""),f.href=r,document.head.appendChild(f),l)return new Promise((a,x)=>{f.addEventListener("load",a),f.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>t()).catch(r=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=r,window.dispatchEvent(l),!l.defaultPrevented)throw r})},lt=(o,t)=>{const n=o[t];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((c,s)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(s.bind(null,new Error("Unknown variable dynamic import: "+t)))})},Pe=["ko","en","ja","zh"],ct="ko",Tt={ko:"í•œêµ­ì–´",en:"English",ja:"æ—¥æœ¬èªž",zh:"ä¸­æ–‡"},ge={debug:(...o)=>{},info:(...o)=>console.info("[ChipBlockCrush]",...o),warn:(...o)=>console.warn("[ChipBlockCrush]",...o),error:(...o)=>console.error("[ChipBlockCrush]",...o)},$e="language";class Ge{detectBrowserLanguage(){const t=navigator.language.split("-")[0];return Pe.includes(t)?t:ct}getStoredLanguage(){try{return localStorage.getItem($e)}catch(t){return ge.error("Failed to get stored language",{error:t}),null}}setLanguage(t){if(Pe.includes(t))try{localStorage.setItem($e,t),window.dispatchEvent(new CustomEvent("languageChanged",{detail:t})),ge.debug("Language changed",{language:t})}catch(n){ge.error("Failed to set language",{error:n,language:t})}}getCurrentLanguage(){const t=this.getStoredLanguage();return t&&Pe.includes(t)?t:this.detectBrowserLanguage()}}const Ae={},at=()=>{const[o,t]=i.useState(()=>new Ge().getCurrentLanguage()),[n,c]=i.useState(null),[s,r]=i.useState(!0);return i.useEffect(()=>{(()=>Ne(void 0,null,function*(){r(!0);try{if(Ae[o]){c(Ae[o]),r(!1);return}const f=yield lt(Object.assign({"../locales/en.json":()=>he(()=>import("./en-b2856937.js"),[]),"../locales/ja.json":()=>he(()=>import("./ja-21955580.js"),[]),"../locales/ko.json":()=>he(()=>import("./ko-1b6ee49c.js"),[]),"../locales/zh.json":()=>he(()=>import("./zh-2511d938.js"),[])}),`../locales/${o}.json`);Ae[o]=f.default,c(f.default)}catch(f){try{const a=yield he(()=>import("./ko-1b6ee49c.js"),[]);c(a.default)}catch(a){c({})}}finally{r(!1)}}))()},[o]),i.useEffect(()=>{const u=f=>{const a=f;a.detail&&(a.detail==="ko"||a.detail==="en"||a.detail==="ja"||a.detail==="zh")&&t(a.detail)};return window.addEventListener("languageChanged",u),()=>window.removeEventListener("languageChanged",u)},[]),{language:o,setLanguage:u=>{new Ge().setLanguage(u),(u==="ko"||u==="en"||u==="ja"||u==="zh")&&t(u)},t:u=>{if(s||!n)return u;const f=u.split(".");let a=n;for(const x of f)if(a=a==null?void 0:a[x],a===void 0)break;return(typeof a=="string"?a:u)||u},isLoading:s}},He="chipBlockCrush_",ve={get(o,t={}){var c,s;const n=He+o;try{const r=localStorage.getItem(n);return r===null?(c=t.fallback)!=null?c:null:JSON.parse(r)}catch(r){return t.silent||ge.warn("storage get failed",n,r),(s=t.fallback)!=null?s:null}},set(o,t,n={}){const c=He+o;try{localStorage.setItem(c,JSON.stringify(t))}catch(s){n.silent||ge.warn("storage set failed",c,s)}}};class it{constructor(){_e(this,"enabled",!0);_e(this,"ctx",null)}setEnabled(t){this.enabled=t}getContext(){return typeof window=="undefined"||!window.AudioContext?null:(this.ctx||(this.ctx=new window.AudioContext),this.ctx)}playClick(){if(!this.enabled)return;const t=this.getContext();if(!t)return;const n=()=>{try{const c=t.currentTime,s=t.createOscillator(),r=t.createGain();s.connect(r),r.connect(t.destination),s.type="sine",s.frequency.setValueAtTime(880,c),s.frequency.exponentialRampToValueAtTime(440,c+.05),r.gain.setValueAtTime(.12,c),r.gain.exponentialRampToValueAtTime(.001,c+.08),s.start(c),s.stop(c+.08)}catch(c){}};t.state==="suspended"?t.resume().then(n).catch(()=>{}):n()}playPlace(){if(!this.enabled)return;const t=this.getContext();if(!t)return;const n=()=>{try{const c=t.currentTime,s=t.createOscillator(),r=t.createGain();s.connect(r),r.connect(t.destination),s.type="sine",s.frequency.setValueAtTime(660,c),r.gain.setValueAtTime(.1,c),r.gain.exponentialRampToValueAtTime(.001,c+.06),s.start(c),s.stop(c+.06)}catch(c){}};t.state==="suspended"?t.resume().then(n).catch(()=>{}):n()}}const ut=new it,me=[[[1]],[[1,1]],[[1],[1]],[[1,1,1]],[[1],[1],[1]],[[1,1],[1,0]],[[1,1],[0,1]],[[1,0],[1,1]],[[0,1],[1,1]],[[1,1],[1,1]],[[1,1,1,1]],[[1],[1],[1],[1]],[[1,1,1],[1,0,0]],[[1,0],[1,0],[1,1]],[[0,0,1],[1,1,1]],[[1,1],[0,1],[0,1]],[[1,1,1],[0,0,1]],[[0,1],[0,1],[1,1]],[[1,0,0],[1,1,1]],[[1,1],[1,0],[1,0]],[[1,1,1],[0,1,0]],[[1,0],[1,1],[1,0]],[[0,1,0],[1,1,1]],[[0,1],[1,1],[0,1]],[[1,1,0],[0,1,1]],[[0,1],[1,1],[1,0]],[[0,1,1],[1,1,0]],[[1,0],[1,1],[0,1]],[[1,0],[1,1],[1,1]],[[1,1,1],[1,1,0]],[[1,1],[1,1],[0,1]],[[0,1,1],[1,1,1]],[[1,1,0],[1,1,1]],[[1,1],[1,1],[1,0]],[[1,1,1],[0,1,1]],[[0,1],[1,1],[1,1]],[[1,1,1,1,1]],[[1],[1],[1],[1],[1]],[[0,1,0],[1,1,1],[0,1,0]],[[1,1,1],[0,1,0],[0,1,0]],[[0,0,1],[1,1,1],[0,0,1]],[[0,1,0],[0,1,0],[1,1,1]],[[1,0,0],[1,1,1],[1,0,0]]];function ft(o,t,n){t/=100,n/=100;const c=t*Math.min(n,1-n),s=u=>{const f=(u+o/30)%12;return n-c*Math.max(Math.min(f-3,9-f,1),-1)},r=Math.round(s(0)*255),l=Math.round(s(8)*255),h=Math.round(s(4)*255);return"#"+[r,l,h].map(u=>u.toString(16).padStart(2,"0")).join("")}const dt=72,ht=72,Ye=Array.from({length:me.length},(o,t)=>ft(t*360/me.length,dt,ht));function We(o){return Math.abs(Math.floor(Math.sin(o)*1e6))%me.length}function Ce(o){return Ye[o%Ye.length]}const gt=16/9;function mt(o,t){const n=gt,c=o/t;let s,r;return c>n?(r=t,s=t*n):(s=o,r=o/n),{width:Math.floor(s),height:Math.floor(r)}}const Ie=9,Xe=3,pt=10,Ue=[0,20,30,40,50,60,70,80,90,100];function Fe(o=Ie){return Array.from({length:o},()=>Array(o).fill(0))}function ae(o,t,n,c){var h,u;const s=t.length,r=(u=(h=t[0])==null?void 0:h.length)!=null?u:0,l=o.length;if(n<0||c<0||n+s>l||c+r>l)return!1;for(let f=0;f<s;f++)for(let a=0;a<r;a++)if(t[f][a]&&o[n+f][c+a]!==0)return!1;return!0}const Je=63;function wt(o,t,n,c,s,r){var a,x;const l=o.map(b=>[...b]),h=t.length,u=(x=(a=t[0])==null?void 0:a.length)!=null?x:0,f=s<<6|r&Je;for(let b=0;b<h;b++)for(let z=0;z<u;z++)t[b][z]&&(l[n+b][c+z]=f);return l}function yt(o){return o>0?o&Je:0}function Be(o){var s,r;let t=0,n=0,c=0;for(let l=0;l<o.length;l++)for(let h=0;h<((r=(s=o[0])==null?void 0:s.length)!=null?r:0);h++)o[l][h]&&(t+=l,n+=h,c++);return c===0?{row:0,col:0}:{row:Math.floor(t/c),col:Math.floor(n/c)}}const be=2;function Ve(o,t,n,c){const s=Be(t),r=n-s.row,l=c-s.col;let h=null,u=1/0;for(let f=-be;f<=be;f++)for(let a=-be;a<=be;a++){const x=r+f,b=l+a;if(!ae(o,t,x,b))continue;const z=x+s.row,E=b+s.col,$=Math.abs(z-n)+Math.abs(E-c);$<u&&(u=$,h={row:x,col:b})}return h}function St(o){const t=o.length,n=[],c=[];for(let s=0;s<t;s++){let r=!0,l=!0;for(let h=0;h<t;h++)o[s][h]===0&&(r=!1),o[h][s]===0&&(l=!1);r&&n.push(s),l&&c.push(s)}return{rows:n,cols:c}}function vt(o,t,n){const c=o.length,s=o.map(r=>[...r]);for(const r of t)for(let l=0;l<c;l++)s[r][l]=0;for(const r of n)for(let l=0;l<c;l++)s[l][r]=0;return s}function bt(o,t){var s;const n=o*pt,c=(s=Ue[Math.min(t,Ue.length-1)])!=null?s:0;return n+c}function Ct(o,t){var c,s;const n=o.length;for(const r of t){const l=me[r];if(!l)continue;const h=l.length,u=(s=(c=l[0])==null?void 0:c.length)!=null?s:0;for(let f=0;f<=n-h;f++)for(let a=0;a<=n-u;a++)if(ae(o,l,f,a))return!0}return!1}function ze(o){var t;return(t=me[o])!=null?t:null}function Rt(o,t,n,c){const r=Math.min(o/400,t/300,1.2),l=Math.max(28,36*r),h=Math.max(56,72*r),u=Math.max(56,70*r),f=Math.max(22,28*r),a=Math.max(44,52*r),x=4,b=o-h-8*2,z=t-l-8*2,E=Math.min(b/n,z/n),$=8+(b-E*n)/2,se=l+8+(z-E*n)/2,Z={x:8,y:8,w:u,h:f},T=[],G=o-h+(h-a)/2;let Y=l+8;for(let W=0;W<c;W++)T.push({x:G,y:Y,w:a,h:a}),Y+=a+x;return{padding:8,scale:r,topBarHeight:l,rightPanelWidth:h,menuRect:Z,trayRects:T,offsetX:$,offsetY:se,cellSize:E,gridSize:n,traySlotSize:a}}const Ze=i.forwardRef(({grid:o,onCellClick:t,preview:n,score:c=0,scoreLabel:s,bestScore:r=0,bestScoreLabel:l,onBack:h,backLabel:u,placeHintLabel:f,currentBlockIndices:a=[],selectedIndex:x=null,onBlockTrayClick:b,onBlockTrayPointerDown:z,onLayout:E,isLandscapeMode:$=!1},se)=>{const Z=i.useRef(null),T=i.useRef(null),G=i.useRef(null),Y=i.useRef($);Y.current=$;const W=o.length;i.useImperativeHandle(se,()=>({getCellFromPoint(e,w){const g=T.current;if(!g||!G.current)return null;const y=g.getBoundingClientRect();let d=e-y.left,S=w-y.top;if(Y.current){const C=parseInt(g.style.width||"0",10),q=parseInt(g.style.height||"0",10);if(C&&q){const oe=e-y.left;d=w-y.top,S=q-oe}}const v=G.current,k=Math.floor((d-v.offsetX)/v.cellSize),m=Math.floor((S-v.offsetY)/v.cellSize);return m>=0&&m<v.gridSize&&k>=0&&k<v.gridSize?{row:m,col:k}:null},getCellSize(){var e,w;return(w=(e=G.current)==null?void 0:e.cellSize)!=null?w:24}}),[]);const N=i.useCallback((e,w,g)=>{var _,le;const y=Math.max(1,a.length),d=Rt(w,g,W,y);G.current=d,E==null||E({cellSize:d.cellSize});const{padding:S,scale:v,rightPanelWidth:k,menuRect:m,trayRects:C,offsetX:q,offsetY:oe}=d,pe=8;e.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--canvas-bg").trim()||"#1a1a1a",e.fillRect(0,0,w,g);const F=document.documentElement.getAttribute("data-theme")==="light",Re=F?"rgba(220, 222, 235, 0.95)":"rgba(40, 42, 62, 0.95)",Ee=F?"rgba(124, 138, 255, 0.55)":"rgba(168, 181, 255, 0.5)",ke=F?"rgba(0,0,0,0.03)":"rgba(255,255,255,0.04)",xe=F?"rgba(0,0,0,0.12)":"rgba(255,255,255,0.22)",we=F?"#2d2d2d":"#e8e8e8",Le=F?"rgba(168, 181, 255, 0.35)":"rgba(102, 126, 234, 0.4)",p=F?"rgba(124, 138, 255, 0.6)":"rgba(168, 181, 255, 0.6)",B=Math.max(10,12*v);e.font=`600 ${B}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,e.textAlign="left",e.textBaseline="middle",h&&u&&(e.fillStyle=Le,e.strokeStyle=p,e.lineWidth=2,typeof e.roundRect=="function"?(e.beginPath(),e.roundRect(m.x,m.y,m.w,m.h,8),e.fill(),e.stroke()):(e.fillRect(m.x,m.y,m.w,m.h),e.strokeRect(m.x,m.y,m.w,m.h)),e.fillStyle=we,e.textAlign="center",e.fillText(u,m.x+m.w/2,m.y+m.h/2),e.textAlign="left");const X=m.x+m.w+S,J=m.y+m.h/2,U=B+2;e.textAlign="left",e.fillStyle=we,e.fillText(s!=null?`${s}: ${c}`:String(c),X,J,w-X-k-S),l!=null&&e.fillText(`${l}: ${r}`,X,J+U,w-X-k-S),a.forEach((H,D)=>{var fe,de;const P=C[D];if(!P)return;const I=ze(H);if(x===D&&(e.fillStyle="rgba(168, 181, 255, 0.25)",e.strokeStyle="rgba(168, 181, 255, 0.8)",e.lineWidth=2,typeof e.roundRect=="function"&&(e.beginPath(),e.roundRect(P.x-2,P.y-2,P.w+4,P.h+4,10),e.fill(),e.stroke())),I){const Me=I.length,Te=(de=(fe=I[0])==null?void 0:fe.length)!=null?de:0,ce=Math.min((P.w-8)/Te,(P.h-8)/Me,14),Qe=P.x+(P.w-Te*ce)/2,et=P.y+(P.h-Me*ce)/2;e.fillStyle=Ce(H),e.strokeStyle="rgba(255,255,255,0.4)",e.lineWidth=1;for(let ye=0;ye<Me;ye++)for(let Se=0;Se<Te;Se++)if(I[ye][Se]){const je=Qe+Se*ce+1,Oe=et+ye*ce+1;e.fillRect(je,Oe,ce-2,ce-2),e.strokeRect(je,Oe,ce-2,ce-2)}}});const ee=d.cellSize*W,R=d.cellSize*W,A=q-2,V=oe-2,j=ee+4,L=R+4;e.beginPath(),typeof e.roundRect=="function"?e.roundRect(A,V,j,L,pe):e.rect(A,V,j,L),e.fillStyle=Re,e.fill(),e.strokeStyle=Ee,e.lineWidth=3,e.stroke();for(let H=0;H<W;H++)for(let D=0;D<W;D++){const P=q+D*d.cellSize,I=oe+H*d.cellSize,K=o[H][D];K>0?(e.fillStyle=Ce(yt(K)),e.fillRect(P+2,I+2,d.cellSize-4,d.cellSize-4),e.strokeStyle="rgba(255,255,255,0.35)",e.lineWidth=1,e.strokeRect(P+2,I+2,d.cellSize-4,d.cellSize-4)):(e.fillStyle=ke,e.fillRect(P+1,I+1,d.cellSize-2,d.cellSize-2),e.strokeStyle=xe,e.lineWidth=1,e.strokeRect(P+1,I+1,d.cellSize-2,d.cellSize-2))}if(n&&n.shape){const H=n.colorIndex!==void 0?Ce(n.colorIndex):"rgba(168, 181, 255, 0.6)";e.fillStyle=H,e.globalAlpha=.7,e.strokeStyle="rgba(255,255,255,0.6)",e.lineWidth=2;const D=n.shape.length,P=(le=(_=n.shape[0])==null?void 0:_.length)!=null?le:0;for(let I=0;I<D;I++)for(let K=0;K<P;K++)if(n.shape[I][K]){const fe=q+(n.col+K)*d.cellSize+2,de=oe+(n.row+I)*d.cellSize+2;e.fillRect(fe,de,d.cellSize-4,d.cellSize-4),e.strokeRect(fe,de,d.cellSize-4,d.cellSize-4)}e.globalAlpha=1}},[o,W,n,c,s,r,l,u,h,a,x,E]);i.useEffect(()=>{const e=Z.current,w=T.current;if(!e||!w)return;const g=w.getContext("2d");if(!g)return;const y=()=>{const S=e.clientWidth,v=e.clientHeight,{width:k,height:m}=mt(S,v),C=window.devicePixelRatio||1;w.width=k*C,w.height=m*C,w.style.width=`${k}px`,w.style.height=`${m}px`,g.setTransform(1,0,0,1,0,0),g.scale(C,C),N(g,k,m)};y();const d=new ResizeObserver(y);return d.observe(e),()=>d.disconnect()},[N]),i.useEffect(()=>{const e=T.current;if(!e)return;const w=e.getContext("2d");if(!w)return;const g=parseInt(e.style.width||"0",10),y=parseInt(e.style.height||"0",10);g&&y&&N(w,g,y)},[o,N]);const Q=i.useCallback((e,w)=>{const g=T.current;if(!g)return null;const y=g.getBoundingClientRect(),d=e-y.left,S=w-y.top;if(!$)return{px:d,py:S};const v=parseInt(g.style.width||"0",10),k=parseInt(g.style.height||"0",10);if(!v||!k)return{px:d,py:S};const m=S,C=k-d;return{px:m,py:C}},[$]),O=i.useCallback(e=>{const w="touches"in e?e.touches[0].clientX:e.clientX,g="touches"in e?e.touches[0].clientY:e.clientY,y=Q(w,g);if(!y||!G.current||!z)return;const S=G.current.trayRects.findIndex(v=>y.px>=v.x&&y.px<=v.x+v.w&&y.py>=v.y&&y.py<=v.y+v.h);S>=0&&z(S,w,g)},[Q,z]),re=i.useCallback((e,w)=>{const g=Q(e,w);if(!g)return;const{px:y,py:d}=g,S=G.current;if(!S)return;if(h&&u){const C=S.menuRect;if(y>=C.x&&y<=C.x+C.w&&d>=C.y&&d<=C.y+C.h){h();return}}const v=S.trayRects.findIndex(C=>y>=C.x&&y<=C.x+C.w&&d>=C.y&&d<=C.y+C.h);if(v>=0&&b){b(v);return}const k=Math.floor((y-S.offsetX)/S.cellSize),m=Math.floor((d-S.offsetY)/S.cellSize);t&&m>=0&&m<S.gridSize&&k>=0&&k<S.gridSize&&t(m,k)},[Q,h,u,b,t]),te=i.useCallback(e=>{re(e.clientX,e.clientY)},[re]),ne=i.useRef(null),ie=i.useCallback(e=>{ne.current={x:e.touches[0].clientX,y:e.touches[0].clientY,t:Date.now()}},[]),ue=i.useCallback(e=>{const w=ne.current;if(ne.current=null,!w||!e.changedTouches[0])return;const g=e.changedTouches[0].clientX-w.x,y=e.changedTouches[0].clientY-w.y;Date.now()-w.t<=400&&g*g+y*y<=400&&(e.preventDefault(),re(e.changedTouches[0].clientX,e.changedTouches[0].clientY))},[re]);return M.jsx("div",{ref:Z,className:"block-crush-canvas-wrap",children:M.jsx("canvas",{ref:T,className:"block-crush-canvas",onClick:te,onMouseDown:O,onTouchStart:e=>{O(e),ie(e)},onTouchEnd:ue,"aria-label":f})})});Ze.displayName="BlockCrushCanvas";const Et=i.memo(Ze);const Ke="landscapeMode",qe="highScore",kt=({stageNumber:o,onBack:t})=>{const{t:n}=at(),c=i.useRef(null),[s,r]=i.useState(()=>Fe(Ie)),[l,h]=i.useState([]),[u,f]=i.useState(null),[a,x]=i.useState(0),[b,z]=i.useState(()=>{if(typeof window=="undefined")return 0;const p=ve.get(qe,{fallback:0,silent:!0});return typeof p=="number"&&p>=0?p:0}),[E,$]=i.useState(!1),[se,Z]=i.useState(1),[T,G]=i.useState(()=>{if(typeof window=="undefined")return!1;const p=ve.get(Ke,{fallback:!1,silent:!0});return p!=null?p:!1}),[Y,W]=i.useState(()=>typeof window=="undefined"?!1:window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0),[N,Q]=i.useState(null),[O,re]=i.useState(null),[te,ne]=i.useState(null),[ie,ue]=i.useState(null),[e,w]=i.useState(28),g=i.useRef(null),y=i.useRef(null),d=i.useRef(null),S=i.useRef(null),v=i.useRef(null),k=i.useRef(null),m=i.useRef(null),C=8,q=o*1e3,oe=i.useCallback(()=>{const p=[];for(let B=0;B<Xe;B++)p.push(We(q+Date.now()+B));h(p)},[q]);i.useEffect(()=>{oe()},[oe]);const pe=i.useCallback(()=>{const p=!T;G(p),ve.set(Ke,p,{silent:!0})},[T]);i.useEffect(()=>{const p=()=>{typeof window!="undefined"&&W(window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0)};return window.addEventListener("resize",p),window.addEventListener("orientationchange",p),()=>{window.removeEventListener("resize",p),window.removeEventListener("orientationchange",p)}},[]),i.useEffect(()=>{if(l.length===0)return;Ct(s,l)||$(!0)},[s,l]),i.useEffect(()=>{a<=b||(z(a),ve.set(qe,a,{silent:!0}))},[a,b]);const F=i.useCallback((p,B,X)=>{const J=l[X],U=ze(J);if(!U||!ae(s,U,p,B))return;ut.playPlace();let ee=wt(s,U,p,B,se,J);Z(L=>L+1);let R=0;for(;;){const{rows:L,cols:_}=St(ee);if(L.length===0&&_.length===0)break;R+=L.length+_.length,ee=vt(ee,L,_)}const A=U.flat().filter(Boolean).length,V=bt(A,R);x(L=>L+V),r(ee);const j=l.filter((L,_)=>_!==X);j.length<Xe&&j.push(We(q+Date.now()+j.length)),h(j),f(null)},[s,l,se,q]),Re=i.useCallback((p,B)=>{if(!E&&u!==null){F(p,B,u);return}},[E,u,F]),Ee=i.useCallback((p,B,X)=>{if(E)return;const J=l[p],U=ze(J);U&&(Q({x:B,y:X,index:p,shapeIdx:J,shape:U}),S.current={index:p})},[l,E]),ke=i.useCallback(p=>{E||f(B=>B===p?null:p)},[E]);d.current=O,g.current=te,i.useEffect(()=>{if(!N&&!O)return;const p=(R,A)=>{const V=d.current;if(V&&v.current?(v.current.style.left=`${R}px`,v.current.style.top=`${A}px`):ue({x:R,y:A}),N&&!O){const j=R-N.x,L=A-N.y;if(Math.sqrt(j*j+L*L)>=C){const _={index:N.index,shapeIdx:N.shapeIdx,shape:N.shape};re(_),d.current=_,Q(null),S.current=null,ue({x:R,y:A})}}V&&(m.current={x:R,y:A},k.current==null&&(k.current=requestAnimationFrame(()=>{var le;k.current=null;const j=m.current,L=d.current;if(!j||!L)return;const _=(le=c.current)==null?void 0:le.getCellFromPoint(j.x,j.y);if(_){y.current=_;const H=Be(L.shape),D=_.row-H.row,P=_.col-H.col,I=ae(s,L.shape,D,P)?{row:D,col:P}:Ve(s,L.shape,_.row,_.col);if(I){const K=g.current;(!K||K.row!==I.row||K.col!==I.col)&&(ne(I),g.current=I)}else g.current!==null&&(ne(null),g.current=null)}else g.current!==null&&(ne(null),g.current=null)})))},B=R=>p(R.clientX,R.clientY),X=R=>{R.preventDefault(),p(R.touches[0].clientX,R.touches[0].clientY)},J=(R,A)=>{var _;const V=g.current,j=d.current,L=y.current;if(j){const le=R!=null&&A!=null,H=le&&((_=c.current)==null?void 0:_.getCellFromPoint(R,A))!=null;if(!(le&&!H)){let D=V&&ae(s,j.shape,V.row,V.col)?V:L?Ve(s,j.shape,L.row,L.col):null;D&&F(D.row,D.col,j.index)}}k.current!=null&&(cancelAnimationFrame(k.current),k.current=null),m.current=null,re(null),Q(null),ne(null),ue(null),g.current=null,y.current=null,d.current=null,S.current=null},U=R=>{window.removeEventListener("mousemove",B),window.removeEventListener("mouseup",U),J(R.clientX,R.clientY)},ee=R=>{window.removeEventListener("touchmove",X,{capture:!0}),window.removeEventListener("touchend",ee,{capture:!0});const A=R.changedTouches[0];J(A==null?void 0:A.clientX,A==null?void 0:A.clientY)};return window.addEventListener("mousemove",B),window.addEventListener("mouseup",U),window.addEventListener("touchmove",X,{passive:!1,capture:!0}),window.addEventListener("touchend",ee,{capture:!0}),()=>{window.removeEventListener("mousemove",B),window.removeEventListener("mouseup",U),window.removeEventListener("touchmove",X,{capture:!0}),window.removeEventListener("touchend",ee,{capture:!0})}},[N,O,s,F]);const xe=i.useCallback(p=>{w(p.cellSize)},[]),we=i.useMemo(()=>!O||!te||!ae(s,O.shape,te.row,te.col)?null:{shape:O.shape,row:te.row,col:te.col,colorIndex:O.shapeIdx},[O,te,s]),Le=()=>{r(Fe(Ie)),x(0),$(!1),f(null),re(null),ne(null),Z(1),oe()};return M.jsxs("div",{className:"game-screen",children:[M.jsx("div",{className:`game-board-container ${Y&&T?"landscape-mode":""}`,children:M.jsx("div",{className:`game-area ${E?"game-over":""}`,children:M.jsx("div",{className:"game-view-16-9",children:M.jsx(Et,{ref:c,grid:s,onCellClick:Re,preview:we,onLayout:xe,score:a,scoreLabel:n("game.score"),bestScore:b,bestScoreLabel:n("game.bestScore"),onBack:t,backLabel:n("game.backToStage"),placeHintLabel:n("game.placeHint"),currentBlockIndices:l,selectedIndex:u,onBlockTrayClick:ke,onBlockTrayPointerDown:Ee,isLandscapeMode:Y?T:!1})})})}),Y&&M.jsxs("button",{type:"button",className:`orientation-toggle-button ${T?"landscape-mode":""}`,onClick:pe,"aria-label":n(T?"game.switchToPortrait":"game.switchToLandscape"),title:n(T?"game.switchToPortrait":"game.switchToLandscape"),children:[M.jsx("span",{className:"orientation-icon",children:T?"ðŸ“±":"ðŸ”„"}),M.jsx("span",{className:"orientation-text",children:n(T?"game.portraitMode":"game.landscapeMode")})]}),O&&ie&&typeof document!="undefined"&&ot.createPortal(M.jsx("div",{ref:v,className:`game-drag-ghost ${Y&&T?"landscape-mode":""}`,style:{left:ie.x,top:ie.y},"aria-hidden":!0,children:M.jsx(xt,{shape:O.shape,colorIndex:O.shapeIdx,size:e})}),document.body),E&&M.jsx("div",{className:"game-overlay",children:M.jsxs("div",{className:"game-over-box",children:[M.jsx("h2",{children:n("game.gameOver")}),M.jsxs("p",{children:[n("game.score"),": ",a]}),M.jsxs("p",{className:"game-over-best",children:[n("game.bestScore"),": ",b]}),M.jsxs("div",{className:"game-over-buttons",children:[M.jsx("button",{type:"button",onClick:Le,children:n("game.playAgain")}),M.jsx("button",{type:"button",onClick:t,children:n("game.backToStage")})]})]})})]})};function xt({shape:o,colorIndex:t,size:n=24}){var G,Y;const c=Ce(t),s=o.length,r=(Y=(G=o[0])==null?void 0:G.length)!=null?Y:0,l=n,h=r*l,u=s*l,f=Be(o),a=f.col*l+l/2,x=f.row*l+l/2,b=h/2-a,z=u/2-x,E=4,$=Math.min(0,b)-E,se=Math.min(0,z)-E,Z=h+Math.abs(b)+E*2,T=u+Math.abs(z)+E*2;return M.jsx("svg",{width:Z,height:T,viewBox:`${$} ${se} ${Z} ${T}`,className:"block-preview-svg",children:M.jsx("g",{transform:`translate(${b}, ${z})`,children:o.map((W,N)=>W.map((Q,O)=>Q?M.jsx("rect",{x:O*l+1,y:N*l+1,width:l-1,height:l-1,fill:c,stroke:"rgba(255,255,255,0.4)",strokeWidth:1,rx:4},`${N}-${O}`):null))})})}const _t=Object.freeze(Object.defineProperty({__proto__:null,default:kt},Symbol.toStringTag,{value:"Module"}));export{me as B,_t as G,Tt as L,Pe as S,he as _,ut as a,Ce as g,ve as s,at as u};
