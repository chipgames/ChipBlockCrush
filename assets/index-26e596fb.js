var gt=Object.defineProperty;var mt=(e,t,n)=>t in e?gt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var pt=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Le=(e,t,n)=>(mt(e,typeof t!="symbol"?t+"":t,n),n);var _e=(e,t,n)=>new Promise((a,o)=>{var l=h=>{try{f(n.next(h))}catch(u){o(u)}},c=h=>{try{f(n.throw(h))}catch(u){o(u)}},f=h=>h.done?a(h.value):Promise.resolve(h.value).then(l,c);f((n=n.apply(e,t)).next())});import{r as i,a as nt,R as yt}from"./vendor-ffc9ac40.js";import{W as bt,q as wt}from"./helmet-6da975a7.js";var nn=pt($e=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}})();var ot={exports:{}},Ce={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vt=i,St=Symbol.for("react.element"),kt=Symbol.for("react.fragment"),xt=Object.prototype.hasOwnProperty,Ct=vt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,jt={key:!0,ref:!0,__self:!0,__source:!0};function st(e,t,n){var a,o={},l=null,c=null;n!==void 0&&(l=""+n),t.key!==void 0&&(l=""+t.key),t.ref!==void 0&&(c=t.ref);for(a in t)xt.call(t,a)&&!jt.hasOwnProperty(a)&&(o[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps,t)o[a]===void 0&&(o[a]=t[a]);return{$$typeof:St,type:e,key:l,ref:c,props:o,_owner:Ct.current}}Ce.Fragment=kt;Ce.jsx=st;Ce.jsxs=st;ot.exports=Ce;var s=ot.exports,Ie={},He=nt;Ie.createRoot=He.createRoot,Ie.hydrateRoot=He.hydrateRoot;class Et extends i.Component{constructor(){super(...arguments);Le(this,"state",{hasError:!1})}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,a){console.error("[ChipBlockCrush]",n,a)}render(){return this.state.hasError?s.jsxs("div",{className:"error-boundary",children:[s.jsx("h2",{children:"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"}),s.jsx("p",{children:"íŽ˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ ì£¼ì„¸ìš”."}),s.jsx("button",{type:"button",onClick:()=>window.location.reload(),children:"ìƒˆë¡œê³ ì¹¨"})]}):this.props.children}}const Rt="modulepreload",Nt=function(e){return"/ChipBlockCrush/"+e},Fe={},ge=function(t,n,a){if(!n||n.length===0)return t();const o=document.getElementsByTagName("link");return Promise.all(n.map(l=>{if(l=Nt(l),l in Fe)return;Fe[l]=!0;const c=l.endsWith(".css"),f=c?'[rel="stylesheet"]':"";if(!!a)for(let d=o.length-1;d>=0;d--){const x=o[d];if(x.href===l&&(!c||x.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${f}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":Rt,c||(u.as="script",u.crossOrigin=""),u.href=l,document.head.appendChild(u),c)return new Promise((d,x)=>{u.addEventListener("load",d),u.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${l}`)))})})).then(()=>t()).catch(l=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l})},Lt=(e,t)=>{const n=e[t];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((a,o)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(o.bind(null,new Error("Unknown variable dynamic import: "+t)))})},ke=["ko","en","ja","zh"],_t="ko",Tt={ko:"í•œêµ­ì–´",en:"English",ja:"æ—¥æœ¬èªž",zh:"ä¸­æ–‡"},me={debug:(...e)=>{},info:(...e)=>console.info("[ChipBlockCrush]",...e),warn:(...e)=>console.warn("[ChipBlockCrush]",...e),error:(...e)=>console.error("[ChipBlockCrush]",...e)},Ye="language";class Ue{detectBrowserLanguage(){const t=navigator.language.split("-")[0];return ke.includes(t)?t:_t}getStoredLanguage(){try{return localStorage.getItem(Ye)}catch(t){return me.error("Failed to get stored language",{error:t}),null}}setLanguage(t){if(ke.includes(t))try{localStorage.setItem(Ye,t),window.dispatchEvent(new CustomEvent("languageChanged",{detail:t})),me.debug("Language changed",{language:t})}catch(n){me.error("Failed to set language",{error:n,language:t})}}getCurrentLanguage(){const t=this.getStoredLanguage();return t&&ke.includes(t)?t:this.detectBrowserLanguage()}}const Te={},q=()=>{const[e,t]=i.useState(()=>new Ue().getCurrentLanguage()),[n,a]=i.useState(null),[o,l]=i.useState(!0);return i.useEffect(()=>{(()=>_e($e,null,function*(){l(!0);try{if(Te[e]){a(Te[e]),l(!1);return}const u=yield Lt(Object.assign({"../locales/en.json":()=>ge(()=>import("./en-ad59403d.js"),[]),"../locales/ja.json":()=>ge(()=>import("./ja-ef7d560d.js"),[]),"../locales/ko.json":()=>ge(()=>import("./ko-52084992.js"),[]),"../locales/zh.json":()=>ge(()=>import("./zh-fc92babc.js"),[])}),`../locales/${e}.json`);Te[e]=u.default,a(u.default)}catch(u){try{const d=yield ge(()=>import("./ko-52084992.js"),[]);a(d.default)}catch(d){a({})}}finally{l(!1)}}))()},[e]),i.useEffect(()=>{const h=u=>{const d=u;d.detail&&(d.detail==="ko"||d.detail==="en"||d.detail==="ja"||d.detail==="zh")&&t(d.detail)};return window.addEventListener("languageChanged",h),()=>window.removeEventListener("languageChanged",h)},[]),{language:e,setLanguage:h=>{new Ue().setLanguage(h),(h==="ko"||h==="en"||h==="ja"||h==="zh")&&t(h)},t:h=>{if(o||!n)return h;const u=h.split(".");let d=n;for(const x of u)if(d=d==null?void 0:d[x],d===void 0)break;return(typeof d=="string"?d:h)||h},isLoading:o}},Be=i.memo(()=>{const{language:e,setLanguage:t}=q();return s.jsx("select",{className:"language-selector",value:e,onChange:n=>t(n.target.value),"aria-label":"ì–¸ì–´ ì„ íƒ",children:ke.map(n=>s.jsx("option",{value:n,children:Tt[n]},n))})});Be.displayName="LanguageSelector";const qe="chipBlockCrush_",U={get(e,t={}){var a,o;const n=qe+e;try{const l=localStorage.getItem(n);return l===null?(a=t.fallback)!=null?a:null:JSON.parse(l)}catch(l){return t.silent||me.warn("storage get failed",n,l),(o=t.fallback)!=null?o:null}},set(e,t,n={}){const a=qe+e;try{localStorage.setItem(a,JSON.stringify(t))}catch(o){n.silent||me.warn("storage set failed",a,o)}}},Me="theme",Mt=()=>{if(typeof window=="undefined")return"dark";try{return window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}catch(e){return"dark"}},Pe=e=>{if(typeof document=="undefined")return;document.documentElement.setAttribute("data-theme",e);const t=document.querySelector('meta[name="theme-color"]');t&&t.setAttribute("content",e==="light"?"#f5f5f8":"#1a1a2e")},rt=()=>{const[e,t]=i.useState(()=>{const o=U.get(Me,{fallback:null,silent:!0});return o==="light"||o==="dark"?o:Mt()}),n=i.useCallback(()=>{t(o=>{const l=o==="light"?"dark":"light";return U.set(Me,l,{silent:!0}),Pe(l),l})},[]),a=i.useCallback(o=>{t(o),U.set(Me,o,{silent:!0}),Pe(o)},[]);return i.useEffect(()=>{Pe(e)},[e]),{theme:e,toggleTheme:n,setTheme:a,isLight:e==="light",isDark:e==="dark"}},lt=i.memo(()=>{const{t:e}=q(),{theme:t,toggleTheme:n}=rt(),a=t==="light";return s.jsx("button",{type:"button",className:"theme-toggle",onClick:n,title:e(a?"header.darkMode":"header.lightMode"),"aria-label":e(a?"header.darkMode":"header.lightMode"),children:a?"ðŸŒ™":"â˜€ï¸"})});lt.displayName="ThemeToggle";class Pt{constructor(){Le(this,"enabled",!0)}setEnabled(t){this.enabled=t}playClick(){this.enabled}}const Xe=new Pt,at=i.memo(({onNavigate:e,onStartGame:t})=>{const{t:n}=q(),[a,o]=i.useState(()=>{var u;return(u=U.get("soundEnabled",{fallback:!0,silent:!0}))!=null?u:!0}),[l,c]=i.useState(!1);i.useEffect(()=>{Xe.setEnabled(a),U.set("soundEnabled",a,{silent:!0})},[a]),i.useEffect(()=>(document.body.style.overflow=l?"hidden":"",()=>{document.body.style.overflow=""}),[l]);const f=u=>{e==null||e(u),c(!1)},h=()=>{o(u=>!u),a&&Xe.playClick()};return s.jsx("header",{className:"header",children:s.jsxs("div",{className:"header-content",children:[s.jsxs("div",{className:"header-logo",onClick:()=>f("menu"),role:"button",tabIndex:0,onKeyDown:u=>u.key==="Enter"&&f("menu"),children:[s.jsx("img",{src:"/ChipBlockCrush/ChipGames_Logo.png",alt:n("header.logo"),className:"header-logo-img"}),s.jsx("span",{className:"header-game-title",children:n("header.gameTitle")})]}),l&&s.jsx("div",{className:"header-nav-overlay",onClick:()=>c(!1),"aria-hidden":!0}),s.jsxs("nav",{className:`header-nav ${l?"mobile-open":""}`,children:[s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>t?t():f("menu"),children:n("header.playGame")}),s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>f("guide"),children:n("header.guide")}),s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>f("help"),children:n("header.help")}),s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>f("about"),children:n("header.about")})]}),s.jsxs("div",{className:"header-right",children:[s.jsx(lt,{}),s.jsx("button",{type:"button",className:"header-sound-button",onClick:h,title:n(a?"header.soundOff":"header.soundOn"),"aria-label":n(a?"header.soundOff":"header.soundOn"),children:a?"ðŸ”Š":"ðŸ”‡"}),s.jsx(Be,{}),s.jsxs("button",{type:"button",className:"header-hamburger",onClick:()=>c(u=>!u),"aria-label":"ë©”ë‰´","aria-expanded":l,children:[s.jsx("span",{className:`hamburger-line ${l?"active":""}`}),s.jsx("span",{className:`hamburger-line ${l?"active":""}`}),s.jsx("span",{className:`hamburger-line ${l?"active":""}`})]})]})]})})});at.displayName="Header";const It="1.0.0",ct=i.memo(()=>{const{t:e}=q();return s.jsx("footer",{className:"footer",role:"contentinfo",children:s.jsxs("div",{className:"footer-content",children:[s.jsxs("nav",{className:"footer-links",children:[s.jsx("a",{href:"#privacy",className:"footer-link",children:e("footer.privacy")}),s.jsx("a",{href:"#contact",className:"footer-link",children:e("footer.contact")})]}),s.jsx("div",{className:"footer-center",children:s.jsx(Be,{})}),s.jsxs("div",{className:"footer-copyright",children:[e("footer.copyright")," | v",It]})]})})});ct.displayName="Footer";const Ot=({children:e})=>s.jsx("div",{className:"game-container",children:e}),At=({onNavigate:e,onStartGame:t})=>{const{t:n}=q();return s.jsxs("div",{className:"menu-screen",children:[s.jsx("div",{className:"menu-logo-wrap",children:s.jsx("img",{src:"/ChipBlockCrush/ChipGames_Logo.png",alt:n("header.logo"),className:"menu-logo"})}),s.jsx("h1",{className:"menu-title",children:n("header.gameTitle")}),s.jsx("p",{className:"menu-desc",children:n("menu.subtitle")}),s.jsx("button",{type:"button",className:"menu-play-btn",onClick:t,children:n("header.playGame")}),s.jsxs("nav",{className:"menu-links",children:[s.jsx("button",{type:"button",className:"menu-link",onClick:()=>e("guide"),children:n("header.guide")}),s.jsx("button",{type:"button",className:"menu-link",onClick:()=>e("help"),children:n("header.help")}),s.jsx("button",{type:"button",className:"menu-link",onClick:()=>e("about"),children:n("header.about")})]})]})},Bt=({onNavigate:e})=>{const{t}=q();return s.jsxs("div",{className:"guide-screen",children:[s.jsx("h1",{className:"guide-title",children:t("guide.title")}),s.jsx("p",{className:"guide-description",children:t("guide.description")}),s.jsxs("ol",{className:"guide-steps",children:[s.jsx("li",{children:t("guide.step1")}),s.jsx("li",{children:t("guide.step2")}),s.jsx("li",{children:t("guide.step3")})]}),s.jsx("button",{type:"button",className:"guide-back",onClick:()=>e("stageSelect"),children:t("header.playGame")})]})},zt=({onNavigate:e})=>{const{t}=q();return s.jsxs("div",{className:"help-screen",children:[s.jsx("h1",{className:"help-title",children:t("help.title")}),s.jsxs("div",{className:"help-faq",children:[s.jsx("p",{children:t("help.faq1")}),s.jsx("p",{children:t("help.faq2")})]}),s.jsx("button",{type:"button",className:"help-back",onClick:()=>e("stageSelect"),children:t("header.playGame")})]})},$t=({onNavigate:e})=>{const{t}=q();return s.jsxs("div",{className:"about-screen",children:[s.jsx("h1",{className:"about-title",children:t("about.title")}),s.jsx("p",{className:"about-description",children:t("about.description")}),s.jsx("button",{type:"button",className:"about-back",onClick:()=>e("stageSelect"),children:t("header.playGame")})]})},Dt=16/9;function Gt(e,t){const n=Dt,a=e/t;let o,l;return a>n?(l=t,o=t*n):(o=e,l=e/n),{width:Math.floor(o),height:Math.floor(l)}}const ze=[[[1]],[[1,1]],[[1],[1]],[[1,1,1]],[[1],[1],[1]],[[1,1],[1,0]],[[1,1],[0,1]],[[1,0],[1,1]],[[0,1],[1,1]],[[1,1],[1,1]],[[1,1,1,1]],[[1],[1],[1],[1]],[[1,1,1],[1,0,0]],[[1,1,1],[0,0,1]],[[1,1,1],[0,1,0]],[[1,0],[1,1],[1,0]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]],[[1,1],[1,1],[1,0]],[[1,1],[0,1],[0,1]],[[1,1,1,1,1]],[[1],[1],[1],[1],[1]],[[1,1,1],[1,1,0]],[[1,1,1],[0,1,1]],[[0,1,0],[1,1,1],[0,1,0]],[[1,1,1],[0,1,0],[0,1,0]],[[1,0,0],[1,1,1],[1,0,0]]],Ke=["#a8b5ff","#c5a3ff","#ffb3e6","#7fdfd4","#ffd89b","#ff9f9f","#b5c4ff","#d4b3ff","#ffc4e6","#8fefdf","#ffe0ab","#ffafaf","#a8e6cf","#dda0dd","#87ceeb","#f0e68c"];function Ve(e){return Math.abs(Math.floor(Math.sin(e)*1e6))%ze.length}function xe(e){return Ke[e%Ke.length]}const Oe=9,Je=3,Wt=10,Ze=[0,20,30,40,50,60,70,80,90,100];function Qe(e=Oe){return Array.from({length:e},()=>Array(e).fill(0))}function ie(e,t,n,a){var f,h;const o=t.length,l=(h=(f=t[0])==null?void 0:f.length)!=null?h:0,c=e.length;if(n<0||a<0||n+o>c||a+l>c)return!1;for(let u=0;u<o;u++)for(let d=0;d<l;d++)if(t[u][d]&&e[n+u][a+d]!==0)return!1;return!0}const it=15;function Ht(e,t,n,a,o,l){var d,x;const c=e.map(S=>[...S]),f=t.length,h=(x=(d=t[0])==null?void 0:d.length)!=null?x:0,u=o<<4|l&it;for(let S=0;S<f;S++)for(let y=0;y<h;y++)t[S][y]&&(c[n+S][a+y]=u);return c}function Ft(e){return e>0?e&it:0}function ut(e){var o,l;let t=0,n=0,a=0;for(let c=0;c<e.length;c++)for(let f=0;f<((l=(o=e[0])==null?void 0:o.length)!=null?l:0);f++)e[c][f]&&(t+=c,n+=f,a++);return a===0?{row:0,col:0}:{row:Math.floor(t/a),col:Math.floor(n/a)}}const ve=2;function et(e,t,n,a){const o=ut(t),l=n-o.row,c=a-o.col;let f=null,h=1/0;for(let u=-ve;u<=ve;u++)for(let d=-ve;d<=ve;d++){const x=l+u,S=c+d;if(!ie(e,t,x,S))continue;const y=x+o.row,_=S+o.col,P=Math.abs(y-n)+Math.abs(_-a);P<h&&(h=P,f={row:x,col:S})}return f}function Yt(e){const t=e.length,n=[],a=[];for(let o=0;o<t;o++){let l=!0,c=!0;for(let f=0;f<t;f++)e[o][f]===0&&(l=!1),e[f][o]===0&&(c=!1);l&&n.push(o),c&&a.push(o)}return{rows:n,cols:a}}function Ut(e,t,n){const a=e.length,o=e.map(l=>[...l]);for(const l of t)for(let c=0;c<a;c++)o[l][c]=0;for(const l of n)for(let c=0;c<a;c++)o[c][l]=0;return o}function qt(e,t){var o;const n=e*Wt,a=(o=Ze[Math.min(t,Ze.length-1)])!=null?o:0;return n+a}function Xt(e,t){var a,o;const n=e.length;for(const l of t){const c=ze[l];if(!c)continue;const f=c.length,h=(o=(a=c[0])==null?void 0:a.length)!=null?o:0;for(let u=0;u<=n-f;u++)for(let d=0;d<=n-h;d++)if(ie(e,c,u,d))return!0}return!1}function Ae(e){var t;return(t=ze[e])!=null?t:null}function Kt(e,t,n,a){const l=Math.min(e/400,t/300,1.2),c=Math.max(28,36*l),f=Math.max(56,72*l),h=Math.max(56,70*l),u=Math.max(22,28*l),d=Math.max(44,52*l),x=4,S=e-f-8*2,y=t-c-8*2,_=Math.min(S/n,y/n),P=8+(S-_*n)/2,j=c+8+(y-_*n)/2,I={x:8,y:8,w:h,h:u},le=[],X=e-f+(f-d)/2;let O=c+8;for(let H=0;H<a;H++)le.push({x:X,y:O,w:d,h:d}),O+=d+x;return{padding:8,scale:l,topBarHeight:c,rightPanelWidth:f,menuRect:I,trayRects:le,offsetX:P,offsetY:j,cellSize:_,gridSize:n,traySlotSize:d}}const dt=i.forwardRef(({grid:e,onCellClick:t,preview:n,score:a=0,scoreLabel:o,onBack:l,backLabel:c,placeHintLabel:f,currentBlockIndices:h=[],selectedIndex:u=null,onBlockTrayClick:d,onBlockTrayPointerDown:x,onLayout:S,isLandscapeMode:y=!1},_)=>{const P=i.useRef(null),j=i.useRef(null),I=i.useRef(null),le=i.useRef(y);le.current=y;const X=e.length;i.useImperativeHandle(_,()=>({getCellFromPoint(r,v){const p=j.current;if(!p||!I.current)return null;const b=p.getBoundingClientRect();let g=r-b.left,k=v-b.top;if(le.current){const C=parseInt(p.style.width||"0",10),F=parseInt(p.style.height||"0",10);if(C&&F){const ae=r-b.left;g=v-b.top,k=F-ae}}const E=I.current,R=Math.floor((g-E.offsetX)/E.cellSize),m=Math.floor((k-E.offsetY)/E.cellSize);return m>=0&&m<E.gridSize&&R>=0&&R<E.gridSize?{row:m,col:R}:null},getCellSize(){var r,v;return(v=(r=I.current)==null?void 0:r.cellSize)!=null?v:24}}),[]);const O=i.useCallback((r,v,p)=>{var ce,De;const b=Math.max(1,h.length),g=Kt(v,p,X,b);I.current=g,S==null||S({cellSize:g.cellSize});const{padding:k,scale:E,rightPanelWidth:R,menuRect:m,trayRects:C,offsetX:F,offsetY:ae}=g,ye=8;r.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--canvas-bg").trim()||"#1a1a1a",r.fillRect(0,0,v,p);const Q=document.documentElement.getAttribute("data-theme")==="light",je=Q?"rgba(220, 222, 235, 0.95)":"rgba(40, 42, 62, 0.95)",Ee=Q?"rgba(124, 138, 255, 0.55)":"rgba(168, 181, 255, 0.5)",w=Q?"rgba(0,0,0,0.03)":"rgba(255,255,255,0.04)",T=Q?"rgba(0,0,0,0.12)":"rgba(255,255,255,0.22)",Y=Q?"#2d2d2d":"#e8e8e8",K=Q?"rgba(168, 181, 255, 0.35)":"rgba(102, 126, 234, 0.4)",$=Q?"rgba(124, 138, 255, 0.6)":"rgba(168, 181, 255, 0.6)",V=Math.max(10,12*E);r.font=`600 ${V}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,r.textAlign="left",r.textBaseline="middle",l&&c&&(r.fillStyle=K,r.strokeStyle=$,r.lineWidth=2,typeof r.roundRect=="function"?(r.beginPath(),r.roundRect(m.x,m.y,m.w,m.h,8),r.fill(),r.stroke()):(r.fillRect(m.x,m.y,m.w,m.h),r.strokeRect(m.x,m.y,m.w,m.h)),r.fillStyle=Y,r.textAlign="center",r.fillText(c,m.x+m.w/2,m.y+m.h/2),r.textAlign="left");const N=m.x+m.w+k,G=m.y+m.h/2;r.textAlign="left",r.fillStyle=Y,r.fillText(o!=null?`${o}: ${a}`:String(a),N,G,v-N-R-k),h.forEach((ee,te)=>{var he,fe;const M=C[te];if(!M)return;const z=Ae(ee);if(u===te&&(r.fillStyle="rgba(168, 181, 255, 0.25)",r.strokeStyle="rgba(168, 181, 255, 0.8)",r.lineWidth=2,typeof r.roundRect=="function"&&(r.beginPath(),r.roundRect(M.x-2,M.y-2,M.w+4,M.h+4,10),r.fill(),r.stroke())),z){const Re=z.length,Ne=(fe=(he=z[0])==null?void 0:he.length)!=null?fe:0,re=Math.min((M.w-8)/Ne,(M.h-8)/Re,14),ht=M.x+(M.w-Ne*re)/2,ft=M.y+(M.h-Re*re)/2;r.fillStyle=xe(ee),r.strokeStyle="rgba(255,255,255,0.4)",r.lineWidth=1;for(let be=0;be<Re;be++)for(let we=0;we<Ne;we++)if(z[be][we]){const Ge=ht+we*re+1,We=ft+be*re+1;r.fillRect(Ge,We,re-2,re-2),r.strokeRect(Ge,We,re-2,re-2)}}});const W=g.cellSize*X,D=g.cellSize*X,L=F-2,B=ae-2,oe=W+4,de=D+4;r.beginPath(),typeof r.roundRect=="function"?r.roundRect(L,B,oe,de,ye):r.rect(L,B,oe,de),r.fillStyle=je,r.fill(),r.strokeStyle=Ee,r.lineWidth=3,r.stroke();for(let ee=0;ee<X;ee++)for(let te=0;te<X;te++){const M=F+te*g.cellSize,z=ae+ee*g.cellSize,se=e[ee][te];se>0?(r.fillStyle=xe(Ft(se)),r.fillRect(M+2,z+2,g.cellSize-4,g.cellSize-4),r.strokeStyle="rgba(255,255,255,0.35)",r.lineWidth=1,r.strokeRect(M+2,z+2,g.cellSize-4,g.cellSize-4)):(r.fillStyle=w,r.fillRect(M+1,z+1,g.cellSize-2,g.cellSize-2),r.strokeStyle=T,r.lineWidth=1,r.strokeRect(M+1,z+1,g.cellSize-2,g.cellSize-2))}if(n&&n.shape){const ee=n.colorIndex!==void 0?xe(n.colorIndex):"rgba(168, 181, 255, 0.6)";r.fillStyle=ee,r.globalAlpha=.7,r.strokeStyle="rgba(255,255,255,0.6)",r.lineWidth=2;const te=n.shape.length,M=(De=(ce=n.shape[0])==null?void 0:ce.length)!=null?De:0;for(let z=0;z<te;z++)for(let se=0;se<M;se++)if(n.shape[z][se]){const he=F+(n.col+se)*g.cellSize+2,fe=ae+(n.row+z)*g.cellSize+2;r.fillRect(he,fe,g.cellSize-4,g.cellSize-4),r.strokeRect(he,fe,g.cellSize-4,g.cellSize-4)}r.globalAlpha=1}},[e,X,n,a,o,c,l,h,u,S]);i.useEffect(()=>{const r=P.current,v=j.current;if(!r||!v)return;const p=v.getContext("2d");if(!p)return;const b=()=>{const k=r.clientWidth,E=r.clientHeight,{width:R,height:m}=Gt(k,E),C=window.devicePixelRatio||1;v.width=R*C,v.height=m*C,v.style.width=`${R}px`,v.style.height=`${m}px`,p.setTransform(1,0,0,1,0,0),p.scale(C,C),O(p,R,m)};b();const g=new ResizeObserver(b);return g.observe(r),()=>g.disconnect()},[O]),i.useEffect(()=>{const r=j.current;if(!r)return;const v=r.getContext("2d");if(!v)return;const p=parseInt(r.style.width||"0",10),b=parseInt(r.style.height||"0",10);p&&b&&O(v,p,b)},[e,O]);const H=i.useCallback((r,v)=>{const p=j.current;if(!p)return null;const b=p.getBoundingClientRect(),g=r-b.left,k=v-b.top;if(!y)return{px:g,py:k};const E=parseInt(p.style.width||"0",10),R=parseInt(p.style.height||"0",10);if(!E||!R)return{px:g,py:k};const m=k,C=R-g;return{px:m,py:C}},[y]),A=i.useCallback(r=>{const v="touches"in r?r.touches[0].clientX:r.clientX,p="touches"in r?r.touches[0].clientY:r.clientY,b=H(v,p);if(!b||!I.current||!x)return;const k=I.current.trayRects.findIndex(E=>b.px>=E.x&&b.px<=E.x+E.w&&b.py>=E.y&&b.py<=E.y+E.h);k>=0&&x(k,v,p)},[H,x]),ne=i.useCallback((r,v)=>{const p=H(r,v);if(!p)return;const{px:b,py:g}=p,k=I.current;if(!k)return;if(l&&c){const C=k.menuRect;if(b>=C.x&&b<=C.x+C.w&&g>=C.y&&g<=C.y+C.h){l();return}}const E=k.trayRects.findIndex(C=>b>=C.x&&b<=C.x+C.w&&g>=C.y&&g<=C.y+C.h);if(E>=0&&d){d(E);return}const R=Math.floor((b-k.offsetX)/k.cellSize),m=Math.floor((g-k.offsetY)/k.cellSize);t&&m>=0&&m<k.gridSize&&R>=0&&R<k.gridSize&&t(m,R)},[H,l,c,d,t]),J=i.useCallback(r=>{ne(r.clientX,r.clientY)},[ne]),Z=i.useRef(null),ue=i.useCallback(r=>{Z.current={x:r.touches[0].clientX,y:r.touches[0].clientY,t:Date.now()}},[]),pe=i.useCallback(r=>{const v=Z.current;if(Z.current=null,!v||!r.changedTouches[0])return;const p=r.changedTouches[0].clientX-v.x,b=r.changedTouches[0].clientY-v.y;Date.now()-v.t<=400&&p*p+b*b<=400&&(r.preventDefault(),ne(r.changedTouches[0].clientX,r.changedTouches[0].clientY))},[ne]);return s.jsx("div",{ref:P,className:"block-crush-canvas-wrap",children:s.jsx("canvas",{ref:j,className:"block-crush-canvas",onClick:J,onMouseDown:A,onTouchStart:r=>{A(r),ue(r)},onTouchEnd:pe,"aria-label":f})})});dt.displayName="BlockCrushCanvas";const tt="landscapeMode",Vt=({stageNumber:e,onBack:t})=>{const{t:n}=q(),a=i.useRef(null),[o,l]=i.useState(()=>Qe(Oe)),[c,f]=i.useState([]),[h,u]=i.useState(null),[d,x]=i.useState(0),[S,y]=i.useState(!1),[_,P]=i.useState(1),[j,I]=i.useState(()=>{if(typeof window=="undefined")return!1;const w=U.get(tt,{fallback:!1,silent:!0});return w!=null?w:!1}),[le,X]=i.useState(()=>typeof window=="undefined"?!1:window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0),[O,H]=i.useState(null),[A,ne]=i.useState(null),[J,Z]=i.useState(null),[ue,pe]=i.useState(null),[r,v]=i.useState(28),p=i.useRef(null),b=i.useRef(null),g=i.useRef(null),k=i.useRef(null),E=8,R=e*1e3,m=i.useCallback(()=>{const w=[];for(let T=0;T<Je;T++)w.push(Ve(R+Date.now()+T));f(w)},[R]);i.useEffect(()=>{m()},[m]);const C=i.useCallback(()=>{const w=!j;I(w),U.set(tt,w,{silent:!0})},[j]);i.useEffect(()=>{const w=()=>{typeof window!="undefined"&&X(window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0)};return window.addEventListener("resize",w),window.addEventListener("orientationchange",w),()=>{window.removeEventListener("resize",w),window.removeEventListener("orientationchange",w)}},[]),i.useEffect(()=>{if(c.length===0)return;Xt(o,c)||y(!0)},[o,c]);const F=i.useCallback((w,T,Y)=>{const K=c[Y],$=Ae(K);if(!$||!ie(o,$,w,T))return;let V=Ht(o,$,w,T,_,K);P(L=>L+1);let N=0;for(;;){const{rows:L,cols:B}=Yt(V);if(L.length===0&&B.length===0)break;N+=L.length+B.length,V=Ut(V,L,B)}const G=$.flat().filter(Boolean).length,W=qt(G,N);x(L=>L+W),l(V);const D=c.filter((L,B)=>B!==Y);D.length<Je&&D.push(Ve(R+Date.now()+D.length)),f(D),u(null)},[o,c,_,R]),ae=i.useCallback((w,T)=>{if(!S&&h!==null){F(w,T,h);return}},[S,h,F]),ye=i.useCallback((w,T,Y)=>{if(S)return;const K=c[w],$=Ae(K);$&&(H({x:T,y:Y,index:w,shapeIdx:K,shape:$}),k.current={index:w})},[c,S]),Q=i.useCallback(w=>{S||u(T=>T===w?null:w)},[S]);g.current=A,p.current=J,i.useEffect(()=>{if(!O&&!A)return;const w=(N,G)=>{var D;if(pe({x:N,y:G}),O&&!A){const L=N-O.x,B=G-O.y;if(Math.sqrt(L*L+B*B)>=E){const oe={index:O.index,shapeIdx:O.shapeIdx,shape:O.shape};ne(oe),g.current=oe,H(null),k.current=null}}const W=g.current;if(W){const L=(D=a.current)==null?void 0:D.getCellFromPoint(N,G);if(L){b.current=L;const B=ut(W.shape),oe=L.row-B.row,de=L.col-B.col;let ce=ie(o,W.shape,oe,de)?{row:oe,col:de}:et(o,W.shape,L.row,L.col);ce?(Z(ce),p.current=ce):(Z(null),p.current=null)}else Z(null),p.current=null}},T=N=>w(N.clientX,N.clientY),Y=N=>{N.preventDefault(),w(N.touches[0].clientX,N.touches[0].clientY)},K=()=>{const N=p.current,G=g.current,W=b.current;if(G){let D=N&&ie(o,G.shape,N.row,N.col)?N:W?et(o,G.shape,W.row,W.col):null;D&&F(D.row,D.col,G.index)}ne(null),H(null),Z(null),pe(null),p.current=null,b.current=null,g.current=null,k.current=null},$=()=>{window.removeEventListener("mousemove",T),window.removeEventListener("mouseup",$),K()},V=()=>{window.removeEventListener("touchmove",Y,{capture:!0}),window.removeEventListener("touchend",V,{capture:!0}),K()};return window.addEventListener("mousemove",T),window.addEventListener("mouseup",$),window.addEventListener("touchmove",Y,{passive:!1,capture:!0}),window.addEventListener("touchend",V,{capture:!0}),()=>{window.removeEventListener("mousemove",T),window.removeEventListener("mouseup",$),window.removeEventListener("touchmove",Y,{capture:!0}),window.removeEventListener("touchend",V,{capture:!0})}},[O,A,o,F]);const je=i.useMemo(()=>!A||!J||!ie(o,A.shape,J.row,J.col)?null:{shape:A.shape,row:J.row,col:J.col,colorIndex:A.shapeIdx},[A,J,o]),Ee=()=>{l(Qe(Oe)),x(0),y(!1),u(null),ne(null),Z(null),P(1),m()};return s.jsxs("div",{className:"game-screen",children:[s.jsx("div",{className:`game-board-container ${j?"landscape-mode":""}`,children:s.jsx("div",{className:`game-area ${S?"game-over":""}`,children:s.jsx("div",{className:"game-view-16-9",children:s.jsx(dt,{ref:a,grid:o,onCellClick:ae,preview:je,onLayout:w=>v(w.cellSize),score:d,scoreLabel:n("game.score"),onBack:t,backLabel:n("game.backToStage"),placeHintLabel:n("game.placeHint"),currentBlockIndices:c,selectedIndex:h,onBlockTrayClick:Q,onBlockTrayPointerDown:ye,isLandscapeMode:j})})})}),le&&s.jsxs("button",{type:"button",className:`orientation-toggle-button ${j?"landscape-mode":""}`,onClick:C,"aria-label":n(j?"game.switchToPortrait":"game.switchToLandscape"),title:n(j?"game.switchToPortrait":"game.switchToLandscape"),children:[s.jsx("span",{className:"orientation-icon",children:j?"ðŸ“±":"ðŸ”„"}),s.jsx("span",{className:"orientation-text",children:n(j?"game.portraitMode":"game.landscapeMode")})]}),A&&ue&&typeof document!="undefined"&&nt.createPortal(s.jsx("div",{className:`game-drag-ghost ${j?"landscape-mode":""}`,style:{left:ue.x,top:ue.y},"aria-hidden":!0,children:s.jsx(Jt,{shape:A.shape,colorIndex:A.shapeIdx,size:r})}),document.body),S&&s.jsx("div",{className:"game-overlay",children:s.jsxs("div",{className:"game-over-box",children:[s.jsx("h2",{children:n("game.gameOver")}),s.jsxs("p",{children:[n("game.score"),": ",d]}),s.jsxs("div",{className:"game-over-buttons",children:[s.jsx("button",{type:"button",onClick:Ee,children:n("game.playAgain")}),s.jsx("button",{type:"button",onClick:t,children:n("game.backToStage")})]})]})})]})};function Jt({shape:e,colorIndex:t,size:n=24}){var u,d;const a=xe(t),o=e.length,l=(d=(u=e[0])==null?void 0:u.length)!=null?d:0,c=n,f=l*c,h=o*c;return s.jsx("svg",{width:f,height:h,viewBox:`0 0 ${f} ${h}`,className:"block-preview-svg",children:e.map((x,S)=>x.map((y,_)=>y?s.jsx("rect",{x:_*c+2,y:S*c+2,width:c-4,height:c-4,fill:a,stroke:"rgba(255,255,255,0.4)",strokeWidth:1,rx:4},`${S}-${_}`):null))})}const Zt="https://chipgames.github.io/ChipBlockCrush/",Qt=({title:e,description:t,keywords:n,url:a=Zt})=>{const{t:o,language:l}=q(),c=e!=null?e:o("seo.title"),f=t!=null?t:o("seo.description"),h=n!=null?n:o("seo.keywords"),u=l!=="ko"?`?lang=${l}`:"";return s.jsxs(bt,{children:[s.jsx("title",{children:c}),s.jsx("meta",{name:"description",content:f}),s.jsx("meta",{name:"keywords",content:h}),s.jsx("meta",{property:"og:title",content:c}),s.jsx("meta",{property:"og:description",content:f}),s.jsx("meta",{property:"og:type",content:"website"}),s.jsx("meta",{property:"og:url",content:a+u}),s.jsx("link",{rel:"canonical",href:a+u})]})};function en(){if(typeof window=="undefined"||!("serviceWorker"in navigator))return;const e="/ChipBlockCrush/";window.addEventListener("load",()=>{navigator.serviceWorker.register(`${e}sw.js`,{scope:e}).catch(()=>{})})}const Se="chipBlockCrush_orientationLocked",tn=()=>{rt();const{t:e}=q();i.useEffect(()=>{en()},[]);const[t,n]=i.useState("menu"),[a,o]=i.useState(null),[l,c]=i.useState(()=>typeof window=="undefined"?!1:window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0),[f,h]=i.useState(()=>{var y;return(y=typeof window!="undefined"&&U.get(Se,{fallback:"false"})==="true")!=null?y:!1}),u=y=>{n(y)},d=()=>{o(1),n("game")},x=()=>{n("menu"),o(null)},S=()=>_e($e,null,function*(){const y=screen;if(typeof window=="undefined"||!y.orientation){alert(e("header.orientationUnlock"));return}const _=y.orientation;try{if(f)yield _.unlock(),h(!1),U.set(Se,"false",{silent:!0});else{try{const I=document.documentElement;I.requestFullscreen?yield I.requestFullscreen():I.webkitRequestFullscreen&&(yield I.webkitRequestFullscreen())}catch(I){}const j=_.type.startsWith("portrait")?"portrait":"landscape";yield _.lock(j),h(!0),U.set(Se,"true",{silent:!0})}}catch(P){console.warn("í™”ë©´ ê³ ì • ì‹¤íŒ¨:",P);const j=P instanceof Error?P.message:String(P);(j.includes("not allowed")||j.includes("denied"))&&alert(e("header.orientationUnlock"))}});return i.useEffect(()=>{const y=()=>{typeof window!="undefined"&&c(window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0)};return window.addEventListener("resize",y),window.addEventListener("orientationchange",y),()=>{window.removeEventListener("resize",y),window.removeEventListener("orientationchange",y)}},[]),i.useEffect(()=>{const y=screen;if(typeof window=="undefined"||!y.orientation||!f)return;const _=y.orientation,j=_.type.startsWith("portrait")?"portrait":"landscape";_.lock(j).catch(()=>{h(!1),U.set(Se,"false",{silent:!0})})},[]),s.jsx(Et,{children:s.jsxs(wt,{children:[s.jsx(Qt,{}),s.jsxs("div",{className:"app-container",children:[s.jsx(at,{onNavigate:u,onStartGame:d,currentScreen:t}),s.jsxs(Ot,{children:[t==="guide"&&s.jsx(Bt,{onNavigate:u}),t==="help"&&s.jsx(zt,{onNavigate:u}),t==="about"&&s.jsx($t,{onNavigate:u}),t==="menu"&&s.jsx(At,{onNavigate:u,onStartGame:d}),t==="game"&&a!=null&&s.jsx(Vt,{stageNumber:a,onBack:x})]}),s.jsx(ct,{})]}),l&&typeof window!="undefined"&&screen.orientation?s.jsx("button",{type:"button",className:"orientation-lock-button",onClick:S,"aria-label":e(f?"header.orientationUnlock":"header.orientationLock"),title:e(f?"header.orientationUnlock":"header.orientationLock"),children:f?"ðŸ”’":"ðŸ”“"}):null]})})};Ie.createRoot(document.getElementById("root")).render(s.jsx(yt.StrictMode,{children:s.jsx(tn,{})}))});export default nn();
