var Ue=Object.defineProperty;var He=(e,t,n)=>t in e?Ue(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var We=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ie=(e,t,n)=>(He(e,typeof t!="symbol"?t+"":t,n),n);var ve=(e,t,n)=>new Promise((l,o)=>{var r=d=>{try{h(n.next(d))}catch(i){o(i)}},a=d=>{try{h(n.throw(d))}catch(i){o(i)}},h=d=>d.done?l(d.value):Promise.resolve(d.value).then(r,a);h((n=n.apply(e,t)).next())});import{r as u,a as qe,R as Ke}from"./vendor-ffc9ac40.js";import{W as Ye,q as Ve}from"./helmet-6da975a7.js";var Lt=We(Fe=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();var Be={exports:{}},re={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xe=u,Je=Symbol.for("react.element"),Ze=Symbol.for("react.fragment"),Qe=Object.prototype.hasOwnProperty,et=Xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,tt={key:!0,ref:!0,__self:!0,__source:!0};function Pe(e,t,n){var l,o={},r=null,a=null;n!==void 0&&(r=""+n),t.key!==void 0&&(r=""+t.key),t.ref!==void 0&&(a=t.ref);for(l in t)Qe.call(t,l)&&!tt.hasOwnProperty(l)&&(o[l]=t[l]);if(e&&e.defaultProps)for(l in t=e.defaultProps,t)o[l]===void 0&&(o[l]=t[l]);return{$$typeof:Je,type:e,key:r,ref:a,props:o,_owner:et.current}}re.Fragment=Ze;re.jsx=Pe;re.jsxs=Pe;Be.exports=re;var s=Be.exports,fe={},xe=qe;fe.createRoot=xe.createRoot,fe.hydrateRoot=xe.hydrateRoot;class nt extends u.Component{constructor(){super(...arguments);ie(this,"state",{hasError:!1})}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,l){console.error("[ChipBlockCrush]",n,l)}render(){return this.state.hasError?s.jsxs("div",{className:"error-boundary",children:[s.jsx("h2",{children:"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"}),s.jsx("p",{children:"íŽ˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ ì£¼ì„¸ìš”."}),s.jsx("button",{type:"button",onClick:()=>window.location.reload(),children:"ìƒˆë¡œê³ ì¹¨"})]}):this.props.children}}const st="modulepreload",ot=function(e){return"/ChipBlockCrush/"+e},ye={},Z=function(t,n,l){if(!n||n.length===0)return t();const o=document.getElementsByTagName("link");return Promise.all(n.map(r=>{if(r=ot(r),r in ye)return;ye[r]=!0;const a=r.endsWith(".css"),h=a?'[rel="stylesheet"]':"";if(!!l)for(let f=o.length-1;f>=0;f--){const C=o[f];if(C.href===r&&(!a||C.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${h}`))return;const i=document.createElement("link");if(i.rel=a?"stylesheet":st,a||(i.as="script",i.crossOrigin=""),i.href=r,document.head.appendChild(i),a)return new Promise((f,C)=>{i.addEventListener("load",f),i.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>t()).catch(r=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=r,window.dispatchEvent(a),!a.defaultPrevented)throw r})},rt=(e,t)=>{const n=e[t];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((l,o)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(o.bind(null,new Error("Unknown variable dynamic import: "+t)))})},oe=["ko","en","ja","zh"],lt="ko",at={ko:"í•œêµ­ì–´",en:"English",ja:"æ—¥æœ¬èªž",zh:"ä¸­æ–‡"},Q={debug:(...e)=>{},info:(...e)=>console.info("[ChipBlockCrush]",...e),warn:(...e)=>console.warn("[ChipBlockCrush]",...e),error:(...e)=>console.error("[ChipBlockCrush]",...e)},je="language";class ke{detectBrowserLanguage(){const t=navigator.language.split("-")[0];return oe.includes(t)?t:lt}getStoredLanguage(){try{return localStorage.getItem(je)}catch(t){return Q.error("Failed to get stored language",{error:t}),null}}setLanguage(t){if(oe.includes(t))try{localStorage.setItem(je,t),window.dispatchEvent(new CustomEvent("languageChanged",{detail:t})),Q.debug("Language changed",{language:t})}catch(n){Q.error("Failed to set language",{error:n,language:t})}}getCurrentLanguage(){const t=this.getStoredLanguage();return t&&oe.includes(t)?t:this.detectBrowserLanguage()}}const ue={},H=()=>{const[e,t]=u.useState(()=>new ke().getCurrentLanguage()),[n,l]=u.useState(null),[o,r]=u.useState(!0);return u.useEffect(()=>{(()=>ve(Fe,null,function*(){r(!0);try{if(ue[e]){l(ue[e]),r(!1);return}const i=yield rt(Object.assign({"../locales/en.json":()=>Z(()=>import("./en-fcb4acef.js"),[]),"../locales/ja.json":()=>Z(()=>import("./ja-d82a1324.js"),[]),"../locales/ko.json":()=>Z(()=>import("./ko-f9d15432.js"),[]),"../locales/zh.json":()=>Z(()=>import("./zh-5f4eefc9.js"),[])}),`../locales/${e}.json`);ue[e]=i.default,l(i.default)}catch(i){try{const f=yield Z(()=>import("./ko-f9d15432.js"),[]);l(f.default)}catch(f){l({})}}finally{r(!1)}}))()},[e]),u.useEffect(()=>{const d=i=>{const f=i;f.detail&&(f.detail==="ko"||f.detail==="en"||f.detail==="ja"||f.detail==="zh")&&t(f.detail)};return window.addEventListener("languageChanged",d),()=>window.removeEventListener("languageChanged",d)},[]),{language:e,setLanguage:d=>{new ke().setLanguage(d),(d==="ko"||d==="en"||d==="ja"||d==="zh")&&t(d)},t:d=>{if(o||!n)return d;const i=d.split(".");let f=n;for(const C of i)if(f=f==null?void 0:f[C],f===void 0)break;return(typeof f=="string"?f:d)||d},isLoading:o}},pe=u.memo(()=>{const{language:e,setLanguage:t}=H();return s.jsx("select",{className:"language-selector",value:e,onChange:n=>t(n.target.value),"aria-label":"ì–¸ì–´ ì„ íƒ",children:oe.map(n=>s.jsx("option",{value:n,children:at[n]},n))})});pe.displayName="LanguageSelector";const Se="chipBlockCrush_",ee={get(e,t={}){var l,o;const n=Se+e;try{const r=localStorage.getItem(n);return r===null?(l=t.fallback)!=null?l:null:JSON.parse(r)}catch(r){return t.silent||Q.warn("storage get failed",n,r),(o=t.fallback)!=null?o:null}},set(e,t,n={}){const l=Se+e;try{localStorage.setItem(l,JSON.stringify(t))}catch(o){n.silent||Q.warn("storage set failed",l,o)}}},de="theme",ct=()=>{if(typeof window=="undefined")return"dark";try{return window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}catch(e){return"dark"}},he=e=>{if(typeof document=="undefined")return;document.documentElement.setAttribute("data-theme",e);const t=document.querySelector('meta[name="theme-color"]');t&&t.setAttribute("content",e==="light"?"#f5f5f8":"#1a1a2e")},Te=()=>{const[e,t]=u.useState(()=>{const o=ee.get(de,{fallback:null,silent:!0});return o==="light"||o==="dark"?o:ct()}),n=u.useCallback(()=>{t(o=>{const r=o==="light"?"dark":"light";return ee.set(de,r,{silent:!0}),he(r),r})},[]),l=u.useCallback(o=>{t(o),ee.set(de,o,{silent:!0}),he(o)},[]);return u.useEffect(()=>{he(e)},[e]),{theme:e,toggleTheme:n,setTheme:l,isLight:e==="light",isDark:e==="dark"}},Ae=u.memo(()=>{const{t:e}=H(),{theme:t,toggleTheme:n}=Te(),l=t==="light";return s.jsx("button",{type:"button",className:"theme-toggle",onClick:n,title:e(l?"header.darkMode":"header.lightMode"),"aria-label":e(l?"header.darkMode":"header.lightMode"),children:l?"ðŸŒ™":"â˜€ï¸"})});Ae.displayName="ThemeToggle";class it{constructor(){ie(this,"enabled",!0)}setEnabled(t){this.enabled=t}playClick(){this.enabled}}const Ce=new it,Me=u.memo(({onNavigate:e,onStartGame:t})=>{const{t:n}=H(),[l,o]=u.useState(()=>{var i;return(i=ee.get("soundEnabled",{fallback:!0,silent:!0}))!=null?i:!0}),[r,a]=u.useState(!1);u.useEffect(()=>{Ce.setEnabled(l),ee.set("soundEnabled",l,{silent:!0})},[l]),u.useEffect(()=>(document.body.style.overflow=r?"hidden":"",()=>{document.body.style.overflow=""}),[r]);const h=i=>{e==null||e(i),a(!1)},d=()=>{o(i=>!i),l&&Ce.playClick()};return s.jsx("header",{className:"header",children:s.jsxs("div",{className:"header-content",children:[s.jsxs("div",{className:"header-logo",onClick:()=>h("menu"),role:"button",tabIndex:0,onKeyDown:i=>i.key==="Enter"&&h("menu"),children:[s.jsx("img",{src:"/ChipBlockCrush/ChipGames_Logo.png",alt:n("header.logo"),className:"header-logo-img"}),s.jsx("span",{className:"header-game-title",children:n("header.gameTitle")})]}),r&&s.jsx("div",{className:"header-nav-overlay",onClick:()=>a(!1),"aria-hidden":!0}),s.jsxs("nav",{className:`header-nav ${r?"mobile-open":""}`,children:[s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>t?t():h("menu"),children:n("header.playGame")}),s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>h("guide"),children:n("header.guide")}),s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>h("help"),children:n("header.help")}),s.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>h("about"),children:n("header.about")})]}),s.jsxs("div",{className:"header-right",children:[s.jsx(Ae,{}),s.jsx("button",{type:"button",className:"header-sound-button",onClick:d,title:n(l?"header.soundOff":"header.soundOn"),"aria-label":n(l?"header.soundOff":"header.soundOn"),children:l?"ðŸ”Š":"ðŸ”‡"}),s.jsx(pe,{}),s.jsxs("button",{type:"button",className:"header-hamburger",onClick:()=>a(i=>!i),"aria-label":"ë©”ë‰´","aria-expanded":r,children:[s.jsx("span",{className:`hamburger-line ${r?"active":""}`}),s.jsx("span",{className:`hamburger-line ${r?"active":""}`}),s.jsx("span",{className:`hamburger-line ${r?"active":""}`})]})]})]})})});Me.displayName="Header";const ut="1.0.0",$e=u.memo(()=>{const{t:e}=H();return s.jsx("footer",{className:"footer",role:"contentinfo",children:s.jsxs("div",{className:"footer-content",children:[s.jsxs("nav",{className:"footer-links",children:[s.jsx("a",{href:"#privacy",className:"footer-link",children:e("footer.privacy")}),s.jsx("a",{href:"#contact",className:"footer-link",children:e("footer.contact")})]}),s.jsx("div",{className:"footer-center",children:s.jsx(pe,{})}),s.jsxs("div",{className:"footer-copyright",children:[e("footer.copyright")," | v",ut]})]})})});$e.displayName="Footer";const dt=({children:e})=>s.jsx("div",{className:"game-container",children:e}),ht=({onNavigate:e,onStartGame:t})=>{const{t:n}=H();return s.jsxs("div",{className:"menu-screen",children:[s.jsx("div",{className:"menu-logo-wrap",children:s.jsx("img",{src:"/ChipBlockCrush/ChipGames_Logo.png",alt:n("header.logo"),className:"menu-logo"})}),s.jsx("h1",{className:"menu-title",children:n("header.gameTitle")}),s.jsx("p",{className:"menu-desc",children:n("menu.subtitle")}),s.jsx("button",{type:"button",className:"menu-play-btn",onClick:t,children:n("header.playGame")}),s.jsxs("nav",{className:"menu-links",children:[s.jsx("button",{type:"button",className:"menu-link",onClick:()=>e("guide"),children:n("header.guide")}),s.jsx("button",{type:"button",className:"menu-link",onClick:()=>e("help"),children:n("header.help")}),s.jsx("button",{type:"button",className:"menu-link",onClick:()=>e("about"),children:n("header.about")})]})]})},ft=({onNavigate:e})=>{const{t}=H();return s.jsxs("div",{className:"guide-screen",children:[s.jsx("h1",{className:"guide-title",children:t("guide.title")}),s.jsx("p",{className:"guide-description",children:t("guide.description")}),s.jsxs("ol",{className:"guide-steps",children:[s.jsx("li",{children:t("guide.step1")}),s.jsx("li",{children:t("guide.step2")}),s.jsx("li",{children:t("guide.step3")})]}),s.jsx("button",{type:"button",className:"guide-back",onClick:()=>e("stageSelect"),children:t("header.playGame")})]})},gt=({onNavigate:e})=>{const{t}=H();return s.jsxs("div",{className:"help-screen",children:[s.jsx("h1",{className:"help-title",children:t("help.title")}),s.jsxs("div",{className:"help-faq",children:[s.jsx("p",{children:t("help.faq1")}),s.jsx("p",{children:t("help.faq2")})]}),s.jsx("button",{type:"button",className:"help-back",onClick:()=>e("stageSelect"),children:t("header.playGame")})]})},mt=({onNavigate:e})=>{const{t}=H();return s.jsxs("div",{className:"about-screen",children:[s.jsx("h1",{className:"about-title",children:t("about.title")}),s.jsx("p",{className:"about-description",children:t("about.description")}),s.jsx("button",{type:"button",className:"about-back",onClick:()=>e("stageSelect"),children:t("header.playGame")})]})},pt=16/9;function bt(e,t){const n=pt,l=e/t;let o,r;return l>n?(r=t,o=t*n):(o=e,r=e/n),{width:Math.floor(o),height:Math.floor(r)}}const le=[[[1]],[[1,1]],[[1],[1]],[[1,1,1]],[[1],[1],[1]],[[1,1],[1,0]],[[1,1],[0,1]],[[1,0],[1,1]],[[0,1],[1,1]],[[1,1],[1,1]],[[1,1,1,1]],[[1],[1],[1],[1]],[[1,1,1],[1,0,0]],[[1,1,1],[0,0,1]],[[1,1,1],[0,1,0]],[[1,0],[1,1],[1,0]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]],[[1,1],[1,1],[1,0]],[[1,1],[0,1],[0,1]],[[1,1,1,1,1]],[[1],[1],[1],[1],[1]],[[1,1,1],[1,1,0]],[[1,1,1],[0,1,1]],[[0,1,0],[1,1,1],[0,1,0]],[[1,1,1],[0,1,0],[0,1,0]],[[1,0,0],[1,1,1],[1,0,0]]],we=["#a8b5ff","#c5a3ff","#ffb3e6","#7fdfd4","#ffd89b","#ff9f9f","#b5c4ff","#d4b3ff","#ffc4e6","#8fefdf","#ffe0ab","#ffafaf","#a8e6cf","#dda0dd","#87ceeb","#f0e68c"];function Ee(e){return Math.abs(Math.floor(Math.sin(e)*1e6))%le.length}function ge(e){return we[e%we.length]}const me=9,Ne=3,vt=10,Re=[0,20,30,40,50,60,70,80,90,100];function _e(e=me){return Array.from({length:e},()=>Array(e).fill(0))}function Y(e,t,n,l){var h,d;const o=t.length,r=(d=(h=t[0])==null?void 0:h.length)!=null?d:0,a=e.length;if(n+o>a||l+r>a)return!1;for(let i=0;i<o;i++)for(let f=0;f<r;f++)if(t[i][f]&&e[n+i][l+f]!==0)return!1;return!0}const De=15;function xt(e,t,n,l,o,r){var f,C;const a=e.map(v=>[...v]),h=t.length,d=(C=(f=t[0])==null?void 0:f.length)!=null?C:0,i=o<<4|r&De;for(let v=0;v<h;v++)for(let I=0;I<d;I++)t[v][I]&&(a[n+v][l+I]=i);return a}function yt(e){return e>0?e&De:0}function Ge(e){var o,r;let t=0,n=0,l=0;for(let a=0;a<e.length;a++)for(let h=0;h<((r=(o=e[0])==null?void 0:o.length)!=null?r:0);h++)e[a][h]&&(t+=a,n+=h,l++);return l===0?{row:0,col:0}:{row:Math.floor(t/l),col:Math.floor(n/l)}}const se=2;function Le(e,t,n,l){const o=Ge(t),r=n-o.row,a=l-o.col;let h=null,d=1/0;for(let i=-se;i<=se;i++)for(let f=-se;f<=se;f++){const C=r+i,v=a+f;if(!Y(e,t,C,v))continue;const I=C+o.row,j=v+o.col,z=Math.abs(I-n)+Math.abs(j-l);z<d&&(d=z,h={row:C,col:v})}return h}function jt(e){const t=e.length,n=[],l=[];for(let o=0;o<t;o++){let r=!0,a=!0;for(let h=0;h<t;h++)e[o][h]===0&&(r=!1),e[h][o]===0&&(a=!1);r&&n.push(o),a&&l.push(o)}return{rows:n,cols:l}}function kt(e,t,n){const l=e.length,o=e.map(r=>[...r]);for(const r of t)for(let a=0;a<l;a++)o[r][a]=0;for(const r of n)for(let a=0;a<l;a++)o[a][r]=0;return o}function St(e,t){var o;const n=e*vt,l=(o=Re[Math.min(t,Re.length-1)])!=null?o:0;return n+l}function Ct(e,t){var l,o;const n=e.length;for(const r of t){const a=le[r];if(!a)continue;const h=a.length,d=(o=(l=a[0])==null?void 0:l.length)!=null?o:0;for(let i=0;i<=n-h;i++)for(let f=0;f<=n-d;f++)if(Y(e,a,i,f))return!0}return!1}function Ie(e){var t;return(t=le[e])!=null?t:null}const ze=u.forwardRef(({grid:e,onCellClick:t,preview:n,score:l,scoreLabel:o,onBack:r,backLabel:a,placeHintLabel:h,blockTrayContent:d,onLayout:i},f)=>{const C=u.useRef(null),v=u.useRef(null),I=u.useRef(null),j=e.length;u.useImperativeHandle(f,()=>({getCellFromPoint(c,k){const x=v.current;if(!x||!I.current)return null;const E=x.getBoundingClientRect(),A=c-E.left,G=k-E.top,{offsetX:g,offsetY:O,cellSize:S,gridSize:B}=I.current,M=Math.floor((A-g)/S),D=Math.floor((G-O)/S);return D>=0&&D<B&&M>=0&&M<B?{row:D,col:M}:null},getCellSize(){var c,k;return(k=(c=I.current)==null?void 0:c.cellSize)!=null?k:24}}),[]);const z=u.useCallback((c,k,x)=>{var b,P;const A=k-16,G=x-8*2,g=Math.min(A/j,G/j),O=8+(A-g*j)/2,S=8+(G-g*j)/2;I.current={offsetX:O,offsetY:S,cellSize:g,gridSize:j,padding:8},i==null||i({cellSize:g});const B=g*j,M=g*j,D=8;c.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--canvas-bg").trim()||"#1a1a1a",c.fillRect(0,0,k,x);const q=document.documentElement.getAttribute("data-theme")==="light",U=q?"rgba(220, 222, 235, 0.95)":"rgba(40, 42, 62, 0.95)",W=q?"rgba(124, 138, 255, 0.55)":"rgba(168, 181, 255, 0.5)",K=q?"rgba(0,0,0,0.03)":"rgba(255,255,255,0.04)",ae=q?"rgba(0,0,0,0.12)":"rgba(255,255,255,0.22)",X=O-2,te=S-2,ne=B+4,m=M+4;c.beginPath(),typeof c.roundRect=="function"?c.roundRect(X,te,ne,m,D):c.rect(X,te,ne,m),c.fillStyle=U,c.fill(),c.strokeStyle=W,c.lineWidth=3,c.stroke();for(let N=0;N<j;N++)for(let R=0;R<j;R++){const y=O+R*g,p=S+N*g,_=e[N][R];_>0?(c.fillStyle=ge(yt(_)),c.fillRect(y+2,p+2,g-4,g-4),c.strokeStyle="rgba(255,255,255,0.35)",c.lineWidth=1,c.strokeRect(y+2,p+2,g-4,g-4)):(c.fillStyle=K,c.fillRect(y+1,p+1,g-2,g-2),c.strokeStyle=ae,c.lineWidth=1,c.strokeRect(y+1,p+1,g-2,g-2))}if(n&&n.shape){const N=n.colorIndex!==void 0?ge(n.colorIndex):"rgba(168, 181, 255, 0.6)";c.fillStyle=N,c.globalAlpha=.7,c.strokeStyle="rgba(255,255,255,0.6)",c.lineWidth=2;const R=n.shape.length,y=(P=(b=n.shape[0])==null?void 0:b.length)!=null?P:0;for(let p=0;p<R;p++)for(let _=0;_<y;_++)if(n.shape[p][_]){const $=O+(n.col+_)*g+2,T=S+(n.row+p)*g+2;c.fillRect($,T,g-4,g-4),c.strokeRect($,T,g-4,g-4)}c.globalAlpha=1}},[e,j,n]);u.useEffect(()=>{const c=C.current,k=v.current;if(!c||!k)return;const x=k.getContext("2d");if(!x)return;const E=()=>{const G=c.clientWidth,g=c.clientHeight,{width:O,height:S}=bt(G,g),B=window.devicePixelRatio||1;k.width=O*B,k.height=S*B,k.style.width=`${O}px`,k.style.height=`${S}px`,x.setTransform(1,0,0,1,0,0),x.scale(B,B),z(x,O,S)};E();const A=new ResizeObserver(E);return A.observe(c),()=>A.disconnect()},[z]),u.useEffect(()=>{const c=v.current;if(!c)return;const k=c.getContext("2d");if(!k)return;const x=parseInt(c.style.width||"0",10),E=parseInt(c.style.height||"0",10);x&&E&&z(k,x,E)},[e,z]);const F=c=>{if(!t)return;const k=v.current;if(!k)return;const x=k.getBoundingClientRect(),E=8,A=x.width,G=x.height,g=A-E*2,O=G-E*2,S=Math.min(g/j,O/j),B=E+(g-S*j)/2,M=E+(O-S*j)/2,D=c.clientX-x.left,q=c.clientY-x.top,U=Math.floor((D-B)/S),W=Math.floor((q-M)/S);W>=0&&W<j&&U>=0&&U<j&&t(W,U)},V=l!==void 0&&r!==void 0&&a!==void 0&&h!==void 0;return s.jsxs("div",{ref:C,className:"block-crush-canvas-wrap",children:[s.jsx("canvas",{ref:v,className:"block-crush-canvas",onClick:F}),V&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"game-ui-overlay game-ui-left",children:[s.jsx("button",{type:"button",className:"game-back-btn",onClick:r,children:a}),s.jsx("span",{className:"game-score",children:o!=null?`${o}: ${l}`:String(l)})]}),d!=null&&s.jsxs("aside",{className:"game-ui-overlay game-block-tray","aria-label":h,children:[s.jsx("p",{className:"game-blocks-label",children:h}),s.jsx("div",{className:"game-blocks-row",children:d})]})]})]})});ze.displayName="BlockCrushCanvas";const wt=({stageNumber:e,onBack:t})=>{const{t:n}=H(),l=u.useRef(null),[o,r]=u.useState(()=>_e(me)),[a,h]=u.useState([]),[d,i]=u.useState(null),[f,C]=u.useState(0),[v,I]=u.useState(!1),[j,z]=u.useState(1),[F,V]=u.useState(null),[c,k]=u.useState(null),[x,E]=u.useState(null),[A,G]=u.useState(null),[g,O]=u.useState(28),S=u.useRef(null),B=u.useRef(null),M=u.useRef(null),D=u.useRef(null),q=8,U=e*1e3,W=u.useCallback(()=>{const m=[];for(let b=0;b<Ne;b++)m.push(Ee(U+Date.now()+b));h(m)},[U]);u.useEffect(()=>{W()},[W]),u.useEffect(()=>{if(a.length===0)return;Ct(o,a)||I(!0)},[o,a]);const K=u.useCallback((m,b,P)=>{const N=a[P],R=Ie(N);if(!R||!Y(o,R,m,b))return;let y=xt(o,R,m,b,j,N);z(w=>w+1);let p=0;for(;;){const{rows:w,cols:L}=jt(y);if(w.length===0&&L.length===0)break;p+=w.length+L.length,y=kt(y,w,L)}const _=R.flat().filter(Boolean).length,$=St(_,p);C(w=>w+$),r(y);const T=a.filter((w,L)=>L!==P);T.length<Ne&&T.push(Ee(U+Date.now()+T.length)),h(T),i(null)},[o,a,j,U]),ae=u.useCallback((m,b)=>{if(!v&&d!==null){K(m,b,d);return}},[v,d,K]),X=u.useCallback((m,b)=>{if(v)return;const P=a[b],N=Ie(P);if(!N)return;m.preventDefault();const R="touches"in m?m.touches[0].clientX:m.clientX,y="touches"in m?m.touches[0].clientY:m.clientY;V({x:R,y,index:b,shapeIdx:P,shape:N}),D.current={index:b}},[a,v]);M.current=c,S.current=x,u.useEffect(()=>{if(!F&&!c)return;const m=(p,_)=>{var T;if(G({x:p,y:_}),F&&!c){const w=p-F.x,L=_-F.y;if(Math.sqrt(w*w+L*L)>=q){const J={index:F.index,shapeIdx:F.shapeIdx,shape:F.shape};k(J),M.current=J,V(null),D.current=null}}const $=M.current;if($){const w=(T=l.current)==null?void 0:T.getCellFromPoint(p,_);if(w){B.current=w;const L=Ge($.shape),J=w.row-L.row,be=w.col-L.col;let ce=Y(o,$.shape,J,be)?{row:J,col:be}:Le(o,$.shape,w.row,w.col);ce?(E(ce),S.current=ce):(E(null),S.current=null)}else E(null),S.current=null}},b=p=>m(p.clientX,p.clientY),P=p=>{p.preventDefault(),m(p.touches[0].clientX,p.touches[0].clientY)},N=()=>{var w;const p=S.current,_=M.current,$=B.current;if(_){let L=p&&Y(o,_.shape,p.row,p.col)?p:$?Le(o,_.shape,$.row,$.col):null;L&&K(L.row,L.col,_.index)}const T=(w=D.current)==null?void 0:w.index;!_&&T!==void 0&&i(L=>L===T?null:T),k(null),V(null),E(null),G(null),S.current=null,B.current=null,M.current=null,D.current=null},R=()=>{window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",R),N()},y=()=>{window.removeEventListener("touchmove",P,{capture:!0}),window.removeEventListener("touchend",y,{capture:!0}),N()};return window.addEventListener("mousemove",b),window.addEventListener("mouseup",R),window.addEventListener("touchmove",P,{passive:!1,capture:!0}),window.addEventListener("touchend",y,{capture:!0}),()=>{window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",R),window.removeEventListener("touchmove",P,{capture:!0}),window.removeEventListener("touchend",y,{capture:!0})}},[F,c,o,K]);const te=u.useMemo(()=>!c||!x||!Y(o,c.shape,x.row,x.col)?null:{shape:c.shape,row:x.row,col:x.col,colorIndex:c.shapeIdx},[c,x,o]),ne=()=>{r(_e(me)),C(0),I(!1),i(null),k(null),E(null),z(1),W()};return s.jsxs("div",{className:"game-screen",children:[s.jsx("div",{className:`game-area ${v?"game-over":""}`,children:s.jsx("div",{className:"game-view-16-9",children:s.jsx("div",{className:"game-canvas-box",children:s.jsx(ze,{ref:l,grid:o,onCellClick:ae,preview:te,onLayout:m=>O(m.cellSize),score:f,scoreLabel:n("game.score"),onBack:t,backLabel:n("game.backToStage"),placeHintLabel:n("game.placeHint"),blockTrayContent:a.map((m,b)=>{const P=le[m],N=d===b,R=(c==null?void 0:c.index)===b;return P?s.jsx("div",{className:`game-block-preview ${N?"selected":""} ${R?"dragging":""}`,onMouseDown:y=>X(y,b),onTouchStart:y=>X(y,b),onClick:y=>{y.preventDefault(),c||i(N?null:b)},role:"button",tabIndex:0,onKeyDown:y=>{(y.key==="Enter"||y.key===" ")&&i(N?null:b)},children:s.jsx(Oe,{shape:P,colorIndex:m})},`${m}-${b}`):null})})})})}),c&&A&&s.jsx("div",{className:"game-drag-ghost",style:{left:A.x,top:A.y},"aria-hidden":!0,children:s.jsx(Oe,{shape:c.shape,colorIndex:c.shapeIdx,size:g})}),v&&s.jsx("div",{className:"game-overlay",children:s.jsxs("div",{className:"game-over-box",children:[s.jsx("h2",{children:n("game.gameOver")}),s.jsxs("p",{children:[n("game.score"),": ",f]}),s.jsxs("div",{className:"game-over-buttons",children:[s.jsx("button",{type:"button",onClick:ne,children:n("game.playAgain")}),s.jsx("button",{type:"button",onClick:t,children:n("game.backToStage")})]})]})})]})};function Oe({shape:e,colorIndex:t,size:n=24}){var i,f;const l=ge(t),o=e.length,r=(f=(i=e[0])==null?void 0:i.length)!=null?f:0,a=n,h=r*a,d=o*a;return s.jsx("svg",{width:h,height:d,viewBox:`0 0 ${h} ${d}`,className:"block-preview-svg",children:e.map((C,v)=>C.map((I,j)=>I?s.jsx("rect",{x:j*a+2,y:v*a+2,width:a-4,height:a-4,fill:l,stroke:"rgba(255,255,255,0.4)",strokeWidth:1,rx:4},`${v}-${j}`):null))})}const Et="https://chipgames.github.io/ChipBlockCrush/",Nt=({title:e,description:t,keywords:n,url:l=Et})=>{const{t:o,language:r}=H(),a=e!=null?e:o("seo.title"),h=t!=null?t:o("seo.description"),d=n!=null?n:o("seo.keywords"),i=r!=="ko"?`?lang=${r}`:"";return s.jsxs(Ye,{children:[s.jsx("title",{children:a}),s.jsx("meta",{name:"description",content:h}),s.jsx("meta",{name:"keywords",content:d}),s.jsx("meta",{property:"og:title",content:a}),s.jsx("meta",{property:"og:description",content:h}),s.jsx("meta",{property:"og:type",content:"website"}),s.jsx("meta",{property:"og:url",content:l+i}),s.jsx("link",{rel:"canonical",href:l+i})]})};function Rt(){if(typeof window=="undefined"||!("serviceWorker"in navigator))return;const e="/ChipBlockCrush/";window.addEventListener("load",()=>{navigator.serviceWorker.register(`${e}sw.js`,{scope:e}).catch(()=>{})})}const _t=()=>{Te(),u.useEffect(()=>{Rt()},[]);const[e,t]=u.useState("menu"),[n,l]=u.useState(null),o=h=>{t(h)},r=()=>{l(1),t("game")},a=()=>{t("menu"),l(null)};return s.jsx(nt,{children:s.jsxs(Ve,{children:[s.jsx(Nt,{}),s.jsxs("div",{className:"app-container",children:[s.jsx(Me,{onNavigate:o,onStartGame:r,currentScreen:e}),s.jsxs(dt,{children:[e==="guide"&&s.jsx(ft,{onNavigate:o}),e==="help"&&s.jsx(gt,{onNavigate:o}),e==="about"&&s.jsx(mt,{onNavigate:o}),e==="menu"&&s.jsx(ht,{onNavigate:o,onStartGame:r}),e==="game"&&n!=null&&s.jsx(wt,{stageNumber:n,onBack:a})]}),s.jsx($e,{})]})]})})};fe.createRoot(document.getElementById("root")).render(s.jsx(Ke.StrictMode,{children:s.jsx(_t,{})}))});export default Lt();
