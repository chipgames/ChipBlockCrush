var bt=Object.defineProperty;var wt=(e,t,n)=>t in e?bt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var vt=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Pe=(e,t,n)=>(wt(e,typeof t!="symbol"?t+"":t,n),n);var Ie=(e,t,n)=>new Promise((a,s)=>{var l=f=>{try{h(n.next(f))}catch(u){s(u)}},c=f=>{try{h(n.throw(f))}catch(u){s(u)}},h=f=>f.done?a(f.value):Promise.resolve(f.value).then(l,c);h((n=n.apply(e,t)).next())});import{r as i,a as at,R as St}from"./vendor-ffc9ac40.js";import{W as xt,q as kt}from"./helmet-6da975a7.js";var ln=vt(We=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(s){if(s.ep)return;s.ep=!0;const l=n(s);fetch(s.href,l)}})();var ct={exports:{}},Ee={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ct=i,jt=Symbol.for("react.element"),Et=Symbol.for("react.fragment"),Rt=Object.prototype.hasOwnProperty,Nt=Ct.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Lt={key:!0,ref:!0,__self:!0,__source:!0};function it(e,t,n){var a,s={},l=null,c=null;n!==void 0&&(l=""+n),t.key!==void 0&&(l=""+t.key),t.ref!==void 0&&(c=t.ref);for(a in t)Rt.call(t,a)&&!Lt.hasOwnProperty(a)&&(s[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps,t)s[a]===void 0&&(s[a]=t[a]);return{$$typeof:jt,type:e,key:l,ref:c,props:s,_owner:Nt.current}}Ee.Fragment=Et;Ee.jsx=it;Ee.jsxs=it;ct.exports=Ee;var o=ct.exports,$e={},qe=at;$e.createRoot=qe.createRoot,$e.hydrateRoot=qe.hydrateRoot;class _t extends i.Component{constructor(){super(...arguments);Pe(this,"state",{hasError:!1})}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,a){console.error("[ChipBlockCrush]",n,a)}render(){return this.state.hasError?o.jsxs("div",{className:"error-boundary",children:[o.jsx("h2",{children:"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"}),o.jsx("p",{children:"íŽ˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ ì£¼ì„¸ìš”."}),o.jsx("button",{type:"button",onClick:()=>window.location.reload(),children:"ìƒˆë¡œê³ ì¹¨"})]}):this.props.children}}const Mt="modulepreload",Tt=function(e){return"/ChipBlockCrush/"+e},Xe={},pe=function(t,n,a){if(!n||n.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(n.map(l=>{if(l=Tt(l),l in Xe)return;Xe[l]=!0;const c=l.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(!!a)for(let d=s.length-1;d>=0;d--){const S=s[d];if(S.href===l&&(!c||S.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${h}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":Mt,c||(u.as="script",u.crossOrigin=""),u.href=l,document.head.appendChild(u),c)return new Promise((d,S)=>{u.addEventListener("load",d),u.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${l}`)))})})).then(()=>t()).catch(l=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l})},Pt=(e,t)=>{const n=e[t];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((a,s)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(s.bind(null,new Error("Unknown variable dynamic import: "+t)))})},Ce=["ko","en","ja","zh"],It="ko",Ot={ko:"í•œêµ­ì–´",en:"English",ja:"æ—¥æœ¬èªž",zh:"ä¸­æ–‡"},ye={debug:(...e)=>{},info:(...e)=>console.info("[ChipBlockCrush]",...e),warn:(...e)=>console.warn("[ChipBlockCrush]",...e),error:(...e)=>console.error("[ChipBlockCrush]",...e)},Ke="language";class Ve{detectBrowserLanguage(){const t=navigator.language.split("-")[0];return Ce.includes(t)?t:It}getStoredLanguage(){try{return localStorage.getItem(Ke)}catch(t){return ye.error("Failed to get stored language",{error:t}),null}}setLanguage(t){if(Ce.includes(t))try{localStorage.setItem(Ke,t),window.dispatchEvent(new CustomEvent("languageChanged",{detail:t})),ye.debug("Language changed",{language:t})}catch(n){ye.error("Failed to set language",{error:n,language:t})}}getCurrentLanguage(){const t=this.getStoredLanguage();return t&&Ce.includes(t)?t:this.detectBrowserLanguage()}}const Oe={},Q=()=>{const[e,t]=i.useState(()=>new Ve().getCurrentLanguage()),[n,a]=i.useState(null),[s,l]=i.useState(!0);return i.useEffect(()=>{(()=>Ie(We,null,function*(){l(!0);try{if(Oe[e]){a(Oe[e]),l(!1);return}const u=yield Pt(Object.assign({"../locales/en.json":()=>pe(()=>import("./en-0d0c3768.js"),[]),"../locales/ja.json":()=>pe(()=>import("./ja-f1d73617.js"),[]),"../locales/ko.json":()=>pe(()=>import("./ko-3b0b0601.js"),[]),"../locales/zh.json":()=>pe(()=>import("./zh-67bd03a5.js"),[])}),`../locales/${e}.json`);Oe[e]=u.default,a(u.default)}catch(u){try{const d=yield pe(()=>import("./ko-3b0b0601.js"),[]);a(d.default)}catch(d){a({})}}finally{l(!1)}}))()},[e]),i.useEffect(()=>{const f=u=>{const d=u;d.detail&&(d.detail==="ko"||d.detail==="en"||d.detail==="ja"||d.detail==="zh")&&t(d.detail)};return window.addEventListener("languageChanged",f),()=>window.removeEventListener("languageChanged",f)},[]),{language:e,setLanguage:f=>{new Ve().setLanguage(f),(f==="ko"||f==="en"||f==="ja"||f==="zh")&&t(f)},t:f=>{if(s||!n)return f;const u=f.split(".");let d=n;for(const S of u)if(d=d==null?void 0:d[S],d===void 0)break;return(typeof d=="string"?d:f)||f},isLoading:s}},Ge=i.memo(()=>{const{language:e,setLanguage:t}=Q();return o.jsx("select",{className:"language-selector",value:e,onChange:n=>t(n.target.value),"aria-label":"ì–¸ì–´ ì„ íƒ",children:Ce.map(n=>o.jsx("option",{value:n,children:Ot[n]},n))})});Ge.displayName="LanguageSelector";const Je="chipBlockCrush_",q={get(e,t={}){var a,s;const n=Je+e;try{const l=localStorage.getItem(n);return l===null?(a=t.fallback)!=null?a:null:JSON.parse(l)}catch(l){return t.silent||ye.warn("storage get failed",n,l),(s=t.fallback)!=null?s:null}},set(e,t,n={}){const a=Je+e;try{localStorage.setItem(a,JSON.stringify(t))}catch(s){n.silent||ye.warn("storage set failed",a,s)}}},Ae="theme",At=()=>{if(typeof window=="undefined")return"dark";try{return window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}catch(e){return"dark"}},Be=e=>{if(typeof document=="undefined")return;document.documentElement.setAttribute("data-theme",e);const t=document.querySelector('meta[name="theme-color"]');t&&t.setAttribute("content",e==="light"?"#f5f5f8":"#1a1a2e")},ut=()=>{const[e,t]=i.useState(()=>{const s=q.get(Ae,{fallback:null,silent:!0});return s==="light"||s==="dark"?s:At()}),n=i.useCallback(()=>{t(s=>{const l=s==="light"?"dark":"light";return q.set(Ae,l,{silent:!0}),Be(l),l})},[]),a=i.useCallback(s=>{t(s),q.set(Ae,s,{silent:!0}),Be(s)},[]);return i.useEffect(()=>{Be(e)},[e]),{theme:e,toggleTheme:n,setTheme:a,isLight:e==="light",isDark:e==="dark"}},dt=i.memo(()=>{const{t:e}=Q(),{theme:t,toggleTheme:n}=ut(),a=t==="light";return o.jsx("button",{type:"button",className:"theme-toggle",onClick:n,title:e(a?"header.darkMode":"header.lightMode"),"aria-label":e(a?"header.darkMode":"header.lightMode"),children:a?"ðŸŒ™":"â˜€ï¸"})});dt.displayName="ThemeToggle";class Bt{constructor(){Pe(this,"enabled",!0)}setEnabled(t){this.enabled=t}playClick(){this.enabled}}const Ze=new Bt,ht=i.memo(({onNavigate:e,onStartGame:t})=>{const{t:n}=Q(),[a,s]=i.useState(()=>{var u;return(u=q.get("soundEnabled",{fallback:!0,silent:!0}))!=null?u:!0}),[l,c]=i.useState(!1);i.useEffect(()=>{Ze.setEnabled(a),q.set("soundEnabled",a,{silent:!0})},[a]),i.useEffect(()=>(document.body.style.overflow=l?"hidden":"",()=>{document.body.style.overflow=""}),[l]);const h=u=>{e==null||e(u),c(!1)},f=()=>{s(u=>!u),a&&Ze.playClick()};return o.jsx("header",{className:"header",children:o.jsxs("div",{className:"header-content",children:[o.jsxs("div",{className:"header-logo",onClick:()=>h("menu"),role:"button",tabIndex:0,onKeyDown:u=>u.key==="Enter"&&h("menu"),children:[o.jsx("img",{src:"/ChipBlockCrush/ChipGames_Logo.png",alt:n("header.logo"),className:"header-logo-img"}),o.jsx("span",{className:"header-game-title",children:n("header.gameTitle")})]}),l&&o.jsx("div",{className:"header-nav-overlay",onClick:()=>c(!1),"aria-hidden":!0}),o.jsxs("nav",{className:`header-nav ${l?"mobile-open":""}`,children:[o.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>t?t():h("menu"),children:n("header.playGame")}),o.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>h("guide"),children:n("header.guide")}),o.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>h("help"),children:n("header.help")}),o.jsx("button",{type:"button",className:"header-nav-button",onClick:()=>h("about"),children:n("header.about")})]}),o.jsxs("div",{className:"header-right",children:[o.jsx(dt,{}),o.jsx("button",{type:"button",className:"header-sound-button",onClick:f,title:n(a?"header.soundOff":"header.soundOn"),"aria-label":n(a?"header.soundOff":"header.soundOn"),children:a?"ðŸ”Š":"ðŸ”‡"}),o.jsx(Ge,{}),o.jsxs("button",{type:"button",className:"header-hamburger",onClick:()=>c(u=>!u),"aria-label":"ë©”ë‰´","aria-expanded":l,children:[o.jsx("span",{className:`hamburger-line ${l?"active":""}`}),o.jsx("span",{className:`hamburger-line ${l?"active":""}`}),o.jsx("span",{className:`hamburger-line ${l?"active":""}`})]})]})]})})});ht.displayName="Header";const $t="1.0.1",ft=i.memo(()=>{const{t:e}=Q();return o.jsx("footer",{className:"footer",role:"contentinfo",children:o.jsxs("div",{className:"footer-content",children:[o.jsxs("nav",{className:"footer-links",children:[o.jsx("a",{href:"#privacy",className:"footer-link",children:e("footer.privacy")}),o.jsx("a",{href:"#contact",className:"footer-link",children:e("footer.contact")})]}),o.jsx("div",{className:"footer-center",children:o.jsx(Ge,{})}),o.jsxs("div",{className:"footer-copyright",children:[e("footer.copyright")," | v",$t]})]})})});ft.displayName="Footer";const zt=({children:e})=>o.jsx("div",{className:"game-container",children:e}),Dt=({onNavigate:e,onStartGame:t})=>{const{t:n}=Q();return o.jsxs("div",{className:"menu-screen",children:[o.jsx("div",{className:"menu-logo-wrap",children:o.jsx("img",{src:"/ChipBlockCrush/ChipGames_Logo.png",alt:n("header.logo"),className:"menu-logo"})}),o.jsx("h1",{className:"menu-title",children:n("header.gameTitle")}),o.jsx("p",{className:"menu-desc",children:n("menu.subtitle")}),o.jsx("button",{type:"button",className:"menu-play-btn",onClick:t,children:n("header.playGame")}),o.jsxs("nav",{className:"menu-links",children:[o.jsx("button",{type:"button",className:"menu-link",onClick:()=>e("guide"),children:n("header.guide")}),o.jsx("button",{type:"button",className:"menu-link",onClick:()=>e("help"),children:n("header.help")}),o.jsx("button",{type:"button",className:"menu-link",onClick:()=>e("about"),children:n("header.about")})]})]})},Gt=({onNavigate:e})=>{const{t}=Q();return o.jsxs("div",{className:"guide-screen",children:[o.jsx("h1",{className:"guide-title",children:t("guide.title")}),o.jsx("p",{className:"guide-description",children:t("guide.description")}),o.jsxs("ol",{className:"guide-steps",children:[o.jsx("li",{children:t("guide.step1")}),o.jsx("li",{children:t("guide.step2")}),o.jsx("li",{children:t("guide.step3")})]}),o.jsx("button",{type:"button",className:"guide-back",onClick:()=>e("stageSelect"),children:t("header.playGame")})]})},Ft=({onNavigate:e})=>{const{t}=Q();return o.jsxs("div",{className:"help-screen",children:[o.jsx("h1",{className:"help-title",children:t("help.title")}),o.jsxs("div",{className:"help-faq",children:[o.jsx("p",{children:t("help.faq1")}),o.jsx("p",{children:t("help.faq2")})]}),o.jsx("button",{type:"button",className:"help-back",onClick:()=>e("stageSelect"),children:t("header.playGame")})]})},Ht=({onNavigate:e})=>{const{t}=Q();return o.jsxs("div",{className:"about-screen",children:[o.jsx("h1",{className:"about-title",children:t("about.title")}),o.jsx("p",{className:"about-description",children:t("about.description")}),o.jsx("button",{type:"button",className:"about-back",onClick:()=>e("stageSelect"),children:t("header.playGame")})]})},Wt=16/9;function Yt(e,t){const n=Wt,a=e/t;let s,l;return a>n?(l=t,s=t*n):(s=e,l=e/n),{width:Math.floor(s),height:Math.floor(l)}}const Fe=[[[1]],[[1,1]],[[1],[1]],[[1,1,1]],[[1],[1],[1]],[[1,1],[1,0]],[[1,1],[0,1]],[[1,0],[1,1]],[[0,1],[1,1]],[[1,1],[1,1]],[[1,1,1,1]],[[1],[1],[1],[1]],[[1,1,1],[1,0,0]],[[1,1,1],[0,0,1]],[[1,1,1],[0,1,0]],[[1,0],[1,1],[1,0]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]],[[1,1],[1,1],[1,0]],[[1,1],[0,1],[0,1]],[[1,1,1,1,1]],[[1],[1],[1],[1],[1]],[[1,1,1],[1,1,0]],[[1,1,1],[0,1,1]],[[0,1,0],[1,1,1],[0,1,0]],[[1,1,1],[0,1,0],[0,1,0]],[[1,0,0],[1,1,1],[1,0,0]]],Qe=["#a8b5ff","#c5a3ff","#ffb3e6","#7fdfd4","#ffd89b","#ff9f9f","#b5c4ff","#d4b3ff","#ffc4e6","#8fefdf","#ffe0ab","#ffafaf","#a8e6cf","#dda0dd","#87ceeb","#f0e68c"];function et(e){return Math.abs(Math.floor(Math.sin(e)*1e6))%Fe.length}function je(e){return Qe[e%Qe.length]}const ze=9,tt=3,Ut=10,nt=[0,20,30,40,50,60,70,80,90,100];function ot(e=ze){return Array.from({length:e},()=>Array(e).fill(0))}function de(e,t,n,a){var h,f;const s=t.length,l=(f=(h=t[0])==null?void 0:h.length)!=null?f:0,c=e.length;if(n<0||a<0||n+s>c||a+l>c)return!1;for(let u=0;u<s;u++)for(let d=0;d<l;d++)if(t[u][d]&&e[n+u][a+d]!==0)return!1;return!0}const gt=15;function qt(e,t,n,a,s,l){var d,S;const c=e.map(x=>[...x]),h=t.length,f=(S=(d=t[0])==null?void 0:d.length)!=null?S:0,u=s<<4|l&gt;for(let x=0;x<h;x++)for(let T=0;T<f;T++)t[x][T]&&(c[n+x][a+T]=u);return c}function Xt(e){return e>0?e&gt:0}function He(e){var s,l;let t=0,n=0,a=0;for(let c=0;c<e.length;c++)for(let h=0;h<((l=(s=e[0])==null?void 0:s.length)!=null?l:0);h++)e[c][h]&&(t+=c,n+=h,a++);return a===0?{row:0,col:0}:{row:Math.floor(t/a),col:Math.floor(n/a)}}const xe=2;function st(e,t,n,a){const s=He(t),l=n-s.row,c=a-s.col;let h=null,f=1/0;for(let u=-xe;u<=xe;u++)for(let d=-xe;d<=xe;d++){const S=l+u,x=c+d;if(!de(e,t,S,x))continue;const T=S+s.row,E=x+s.col,v=Math.abs(T-n)+Math.abs(E-a);v<f&&(f=v,h={row:S,col:x})}return h}function Kt(e){const t=e.length,n=[],a=[];for(let s=0;s<t;s++){let l=!0,c=!0;for(let h=0;h<t;h++)e[s][h]===0&&(l=!1),e[h][s]===0&&(c=!1);l&&n.push(s),c&&a.push(s)}return{rows:n,cols:a}}function Vt(e,t,n){const a=e.length,s=e.map(l=>[...l]);for(const l of t)for(let c=0;c<a;c++)s[l][c]=0;for(const l of n)for(let c=0;c<a;c++)s[c][l]=0;return s}function Jt(e,t){var s;const n=e*Ut,a=(s=nt[Math.min(t,nt.length-1)])!=null?s:0;return n+a}function Zt(e,t){var a,s;const n=e.length;for(const l of t){const c=Fe[l];if(!c)continue;const h=c.length,f=(s=(a=c[0])==null?void 0:a.length)!=null?s:0;for(let u=0;u<=n-h;u++)for(let d=0;d<=n-f;d++)if(de(e,c,u,d))return!0}return!1}function De(e){var t;return(t=Fe[e])!=null?t:null}function Qt(e,t,n,a){const l=Math.min(e/400,t/300,1.2),c=Math.max(28,36*l),h=Math.max(56,72*l),f=Math.max(56,70*l),u=Math.max(22,28*l),d=Math.max(44,52*l),S=4,x=e-h-8*2,T=t-c-8*2,E=Math.min(x/n,T/n),v=8+(x-E*n)/2,H=c+8+(T-E*n)/2,D={x:8,y:8,w:f,h:u},k=[],I=e-h+(h-d)/2;let ee=c+8;for(let Y=0;Y<a;Y++)k.push({x:I,y:ee,w:d,h:d}),ee+=d+S;return{padding:8,scale:l,topBarHeight:c,rightPanelWidth:h,menuRect:D,trayRects:k,offsetX:v,offsetY:H,cellSize:E,gridSize:n,traySlotSize:d}}const mt=i.forwardRef(({grid:e,onCellClick:t,preview:n,score:a=0,scoreLabel:s,bestScore:l=0,bestScoreLabel:c,onBack:h,backLabel:f,placeHintLabel:u,currentBlockIndices:d=[],selectedIndex:S=null,onBlockTrayClick:x,onBlockTrayPointerDown:T,onLayout:E,isLandscapeMode:v=!1},H)=>{const D=i.useRef(null),k=i.useRef(null),I=i.useRef(null),ee=i.useRef(v);ee.current=v;const Y=e.length;i.useImperativeHandle(H,()=>({getCellFromPoint(r,b){const m=k.current;if(!m||!I.current)return null;const w=m.getBoundingClientRect();let g=r-w.left,C=b-w.top;if(ee.current){const R=parseInt(m.style.width||"0",10),J=parseInt(m.style.height||"0",10);if(R&&J){const re=r-w.left;g=b-w.top,C=J-re}}const j=I.current,L=Math.floor((g-j.offsetX)/j.cellSize),p=Math.floor((C-j.offsetY)/j.cellSize);return p>=0&&p<j.gridSize&&L>=0&&L<j.gridSize?{row:p,col:L}:null},getCellSize(){var r,b;return(b=(r=I.current)==null?void 0:r.cellSize)!=null?b:24}}),[]);const G=i.useCallback((r,b,m)=>{var ae,ue;const w=Math.max(1,d.length),g=Qt(b,m,Y,w);I.current=g,E==null||E({cellSize:g.cellSize});const{padding:C,scale:j,rightPanelWidth:L,menuRect:p,trayRects:R,offsetX:J,offsetY:re}=g,be=8;r.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--canvas-bg").trim()||"#1a1a1a",r.fillRect(0,0,b,m);const X=document.documentElement.getAttribute("data-theme")==="light",Re=X?"rgba(220, 222, 235, 0.95)":"rgba(40, 42, 62, 0.95)",Ne=X?"rgba(124, 138, 255, 0.55)":"rgba(168, 181, 255, 0.5)",Le=X?"rgba(0,0,0,0.03)":"rgba(255,255,255,0.04)",_e=X?"rgba(0,0,0,0.12)":"rgba(255,255,255,0.22)",we=X?"#2d2d2d":"#e8e8e8",y=X?"rgba(168, 181, 255, 0.35)":"rgba(102, 126, 234, 0.4)",$=X?"rgba(124, 138, 255, 0.6)":"rgba(168, 181, 255, 0.6)",Z=Math.max(10,12*j);r.font=`600 ${Z}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,r.textAlign="left",r.textBaseline="middle",h&&f&&(r.fillStyle=y,r.strokeStyle=$,r.lineWidth=2,typeof r.roundRect=="function"?(r.beginPath(),r.roundRect(p.x,p.y,p.w,p.h,8),r.fill(),r.stroke()):(r.fillRect(p.x,p.y,p.w,p.h),r.strokeRect(p.x,p.y,p.w,p.h)),r.fillStyle=we,r.textAlign="center",r.fillText(f,p.x+p.w/2,p.y+p.h/2),r.textAlign="left");const U=p.x+p.w+C,W=p.y+p.h/2,ne=Z+2;r.textAlign="left",r.fillStyle=we,r.fillText(s!=null?`${s}: ${a}`:String(a),U,W,b-U-L-C),c!=null&&r.fillText(`${c}: ${l}`,U,W+ne,b-U-L-C),d.forEach((F,V)=>{var ge,me;const _=R[V];if(!_)return;const z=De(F);if(S===V&&(r.fillStyle="rgba(168, 181, 255, 0.25)",r.strokeStyle="rgba(168, 181, 255, 0.8)",r.lineWidth=2,typeof r.roundRect=="function"&&(r.beginPath(),r.roundRect(_.x-2,_.y-2,_.w+4,_.h+4,10),r.fill(),r.stroke())),z){const Me=z.length,Te=(me=(ge=z[0])==null?void 0:ge.length)!=null?me:0,ie=Math.min((_.w-8)/Te,(_.h-8)/Me,14),pt=_.x+(_.w-Te*ie)/2,yt=_.y+(_.h-Me*ie)/2;r.fillStyle=je(F),r.strokeStyle="rgba(255,255,255,0.4)",r.lineWidth=1;for(let ve=0;ve<Me;ve++)for(let Se=0;Se<Te;Se++)if(z[ve][Se]){const Ye=pt+Se*ie+1,Ue=yt+ve*ie+1;r.fillRect(Ye,Ue,ie-2,ie-2),r.strokeRect(Ye,Ue,ie-2,ie-2)}}});const N=g.cellSize*Y,O=g.cellSize*Y,K=J-2,A=re-2,M=N+4,P=O+4;r.beginPath(),typeof r.roundRect=="function"?r.roundRect(K,A,M,P,be):r.rect(K,A,M,P),r.fillStyle=Re,r.fill(),r.strokeStyle=Ne,r.lineWidth=3,r.stroke();for(let F=0;F<Y;F++)for(let V=0;V<Y;V++){const _=J+V*g.cellSize,z=re+F*g.cellSize,ce=e[F][V];ce>0?(r.fillStyle=je(Xt(ce)),r.fillRect(_+2,z+2,g.cellSize-4,g.cellSize-4),r.strokeStyle="rgba(255,255,255,0.35)",r.lineWidth=1,r.strokeRect(_+2,z+2,g.cellSize-4,g.cellSize-4)):(r.fillStyle=Le,r.fillRect(_+1,z+1,g.cellSize-2,g.cellSize-2),r.strokeStyle=_e,r.lineWidth=1,r.strokeRect(_+1,z+1,g.cellSize-2,g.cellSize-2))}if(n&&n.shape){const F=n.colorIndex!==void 0?je(n.colorIndex):"rgba(168, 181, 255, 0.6)";r.fillStyle=F,r.globalAlpha=.7,r.strokeStyle="rgba(255,255,255,0.6)",r.lineWidth=2;const V=n.shape.length,_=(ue=(ae=n.shape[0])==null?void 0:ae.length)!=null?ue:0;for(let z=0;z<V;z++)for(let ce=0;ce<_;ce++)if(n.shape[z][ce]){const ge=J+(n.col+ce)*g.cellSize+2,me=re+(n.row+z)*g.cellSize+2;r.fillRect(ge,me,g.cellSize-4,g.cellSize-4),r.strokeRect(ge,me,g.cellSize-4,g.cellSize-4)}r.globalAlpha=1}},[e,Y,n,a,s,l,c,f,h,d,S,E]);i.useEffect(()=>{const r=D.current,b=k.current;if(!r||!b)return;const m=b.getContext("2d");if(!m)return;const w=()=>{const C=r.clientWidth,j=r.clientHeight,{width:L,height:p}=Yt(C,j),R=window.devicePixelRatio||1;b.width=L*R,b.height=p*R,b.style.width=`${L}px`,b.style.height=`${p}px`,m.setTransform(1,0,0,1,0,0),m.scale(R,R),G(m,L,p)};w();const g=new ResizeObserver(w);return g.observe(r),()=>g.disconnect()},[G]),i.useEffect(()=>{const r=k.current;if(!r)return;const b=r.getContext("2d");if(!b)return;const m=parseInt(r.style.width||"0",10),w=parseInt(r.style.height||"0",10);m&&w&&G(b,m,w)},[e,G]);const te=i.useCallback((r,b)=>{const m=k.current;if(!m)return null;const w=m.getBoundingClientRect(),g=r-w.left,C=b-w.top;if(!v)return{px:g,py:C};const j=parseInt(m.style.width||"0",10),L=parseInt(m.style.height||"0",10);if(!j||!L)return{px:g,py:C};const p=C,R=L-g;return{px:p,py:R}},[v]),B=i.useCallback(r=>{const b="touches"in r?r.touches[0].clientX:r.clientX,m="touches"in r?r.touches[0].clientY:r.clientY,w=te(b,m);if(!w||!I.current||!T)return;const C=I.current.trayRects.findIndex(j=>w.px>=j.x&&w.px<=j.x+j.w&&w.py>=j.y&&w.py<=j.y+j.h);C>=0&&T(C,b,m)},[te,T]),le=i.useCallback((r,b)=>{const m=te(r,b);if(!m)return;const{px:w,py:g}=m,C=I.current;if(!C)return;if(h&&f){const R=C.menuRect;if(w>=R.x&&w<=R.x+R.w&&g>=R.y&&g<=R.y+R.h){h();return}}const j=C.trayRects.findIndex(R=>w>=R.x&&w<=R.x+R.w&&g>=R.y&&g<=R.y+R.h);if(j>=0&&x){x(j);return}const L=Math.floor((w-C.offsetX)/C.cellSize),p=Math.floor((g-C.offsetY)/C.cellSize);t&&p>=0&&p<C.gridSize&&L>=0&&L<C.gridSize&&t(p,L)},[te,h,f,x,t]),oe=i.useCallback(r=>{le(r.clientX,r.clientY)},[le]),se=i.useRef(null),he=i.useCallback(r=>{se.current={x:r.touches[0].clientX,y:r.touches[0].clientY,t:Date.now()}},[]),fe=i.useCallback(r=>{const b=se.current;if(se.current=null,!b||!r.changedTouches[0])return;const m=r.changedTouches[0].clientX-b.x,w=r.changedTouches[0].clientY-b.y;Date.now()-b.t<=400&&m*m+w*w<=400&&(r.preventDefault(),le(r.changedTouches[0].clientX,r.changedTouches[0].clientY))},[le]);return o.jsx("div",{ref:D,className:"block-crush-canvas-wrap",children:o.jsx("canvas",{ref:k,className:"block-crush-canvas",onClick:oe,onMouseDown:B,onTouchStart:r=>{B(r),he(r)},onTouchEnd:fe,"aria-label":u})})});mt.displayName="BlockCrushCanvas";const rt="landscapeMode",lt="highScore",en=({stageNumber:e,onBack:t})=>{const{t:n}=Q(),a=i.useRef(null),[s,l]=i.useState(()=>ot(ze)),[c,h]=i.useState([]),[f,u]=i.useState(null),[d,S]=i.useState(0),[x,T]=i.useState(()=>{if(typeof window=="undefined")return 0;const y=q.get(lt,{fallback:0,silent:!0});return typeof y=="number"&&y>=0?y:0}),[E,v]=i.useState(!1),[H,D]=i.useState(1),[k,I]=i.useState(()=>{if(typeof window=="undefined")return!1;const y=q.get(rt,{fallback:!1,silent:!0});return y!=null?y:!1}),[ee,Y]=i.useState(()=>typeof window=="undefined"?!1:window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0),[G,te]=i.useState(null),[B,le]=i.useState(null),[oe,se]=i.useState(null),[he,fe]=i.useState(null),[r,b]=i.useState(28),m=i.useRef(null),w=i.useRef(null),g=i.useRef(null),C=i.useRef(null),j=i.useRef(null),L=i.useRef(null),p=i.useRef(null),R=8,J=e*1e3,re=i.useCallback(()=>{const y=[];for(let $=0;$<tt;$++)y.push(et(J+Date.now()+$));h(y)},[J]);i.useEffect(()=>{re()},[re]);const be=i.useCallback(()=>{const y=!k;I(y),q.set(rt,y,{silent:!0})},[k]);i.useEffect(()=>{const y=()=>{typeof window!="undefined"&&Y(window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0)};return window.addEventListener("resize",y),window.addEventListener("orientationchange",y),()=>{window.removeEventListener("resize",y),window.removeEventListener("orientationchange",y)}},[]),i.useEffect(()=>{if(c.length===0)return;Zt(s,c)||v(!0)},[s,c]),i.useEffect(()=>{d<=x||(T(d),q.set(lt,d,{silent:!0}))},[d,x]);const X=i.useCallback((y,$,Z)=>{const U=c[Z],W=De(U);if(!W||!de(s,W,y,$))return;let ne=qt(s,W,y,$,H,U);D(M=>M+1);let N=0;for(;;){const{rows:M,cols:P}=Kt(ne);if(M.length===0&&P.length===0)break;N+=M.length+P.length,ne=Vt(ne,M,P)}const O=W.flat().filter(Boolean).length,K=Jt(O,N);S(M=>M+K),l(ne);const A=c.filter((M,P)=>P!==Z);A.length<tt&&A.push(et(J+Date.now()+A.length)),h(A),u(null)},[s,c,H,J]),Re=i.useCallback((y,$)=>{if(!E&&f!==null){X(y,$,f);return}},[E,f,X]),Ne=i.useCallback((y,$,Z)=>{if(E)return;const U=c[y],W=De(U);W&&(te({x:$,y:Z,index:y,shapeIdx:U,shape:W}),C.current={index:y})},[c,E]),Le=i.useCallback(y=>{E||u($=>$===y?null:y)},[E]);g.current=B,m.current=oe,i.useEffect(()=>{if(!G&&!B)return;const y=(N,O)=>{const K=g.current;if(K&&j.current?(j.current.style.left=`${N}px`,j.current.style.top=`${O}px`):fe({x:N,y:O}),G&&!B){const A=N-G.x,M=O-G.y;if(Math.sqrt(A*A+M*M)>=R){const P={index:G.index,shapeIdx:G.shapeIdx,shape:G.shape};le(P),g.current=P,te(null),C.current=null,fe({x:N,y:O})}}K&&(p.current={x:N,y:O},L.current==null&&(L.current=requestAnimationFrame(()=>{var ae;L.current=null;const A=p.current,M=g.current;if(!A||!M)return;const P=(ae=a.current)==null?void 0:ae.getCellFromPoint(A.x,A.y);if(P){w.current=P;const ue=He(M.shape),F=P.row-ue.row,V=P.col-ue.col,_=de(s,M.shape,F,V)?{row:F,col:V}:st(s,M.shape,P.row,P.col);if(_){const z=m.current;(!z||z.row!==_.row||z.col!==_.col)&&(se(_),m.current=_)}else m.current!==null&&(se(null),m.current=null)}else m.current!==null&&(se(null),m.current=null)})))},$=N=>y(N.clientX,N.clientY),Z=N=>{N.preventDefault(),y(N.touches[0].clientX,N.touches[0].clientY)},U=(N,O)=>{var P;const K=m.current,A=g.current,M=w.current;if(A){const ae=N!=null&&O!=null,ue=ae&&((P=a.current)==null?void 0:P.getCellFromPoint(N,O))!=null;if(!(ae&&!ue)){let F=K&&de(s,A.shape,K.row,K.col)?K:M?st(s,A.shape,M.row,M.col):null;F&&X(F.row,F.col,A.index)}}L.current!=null&&(cancelAnimationFrame(L.current),L.current=null),p.current=null,le(null),te(null),se(null),fe(null),m.current=null,w.current=null,g.current=null,C.current=null},W=N=>{window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",W),U(N.clientX,N.clientY)},ne=N=>{window.removeEventListener("touchmove",Z,{capture:!0}),window.removeEventListener("touchend",ne,{capture:!0});const O=N.changedTouches[0];U(O==null?void 0:O.clientX,O==null?void 0:O.clientY)};return window.addEventListener("mousemove",$),window.addEventListener("mouseup",W),window.addEventListener("touchmove",Z,{passive:!1,capture:!0}),window.addEventListener("touchend",ne,{capture:!0}),()=>{window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",W),window.removeEventListener("touchmove",Z,{capture:!0}),window.removeEventListener("touchend",ne,{capture:!0})}},[G,B,s,X]);const _e=i.useMemo(()=>!B||!oe||!de(s,B.shape,oe.row,oe.col)?null:{shape:B.shape,row:oe.row,col:oe.col,colorIndex:B.shapeIdx},[B,oe,s]),we=()=>{l(ot(ze)),S(0),v(!1),u(null),le(null),se(null),D(1),re()};return o.jsxs("div",{className:"game-screen",children:[o.jsx("div",{className:`game-board-container ${k?"landscape-mode":""}`,children:o.jsx("div",{className:`game-area ${E?"game-over":""}`,children:o.jsx("div",{className:"game-view-16-9",children:o.jsx(mt,{ref:a,grid:s,onCellClick:Re,preview:_e,onLayout:y=>b(y.cellSize),score:d,scoreLabel:n("game.score"),bestScore:x,bestScoreLabel:n("game.bestScore"),onBack:t,backLabel:n("game.backToStage"),placeHintLabel:n("game.placeHint"),currentBlockIndices:c,selectedIndex:f,onBlockTrayClick:Le,onBlockTrayPointerDown:Ne,isLandscapeMode:k})})})}),ee&&o.jsxs("button",{type:"button",className:`orientation-toggle-button ${k?"landscape-mode":""}`,onClick:be,"aria-label":n(k?"game.switchToPortrait":"game.switchToLandscape"),title:n(k?"game.switchToPortrait":"game.switchToLandscape"),children:[o.jsx("span",{className:"orientation-icon",children:k?"ðŸ“±":"ðŸ”„"}),o.jsx("span",{className:"orientation-text",children:n(k?"game.portraitMode":"game.landscapeMode")})]}),B&&he&&typeof document!="undefined"&&at.createPortal(o.jsx("div",{ref:j,className:`game-drag-ghost ${k?"landscape-mode":""}`,style:{left:he.x,top:he.y},"aria-hidden":!0,children:o.jsx(tn,{shape:B.shape,colorIndex:B.shapeIdx,size:r})}),document.body),E&&o.jsx("div",{className:"game-overlay",children:o.jsxs("div",{className:"game-over-box",children:[o.jsx("h2",{children:n("game.gameOver")}),o.jsxs("p",{children:[n("game.score"),": ",d]}),o.jsxs("p",{className:"game-over-best",children:[n("game.bestScore"),": ",x]}),o.jsxs("div",{className:"game-over-buttons",children:[o.jsx("button",{type:"button",onClick:we,children:n("game.playAgain")}),o.jsx("button",{type:"button",onClick:t,children:n("game.backToStage")})]})]})})]})};function tn({shape:e,colorIndex:t,size:n=24}){var I,ee;const a=je(t),s=e.length,l=(ee=(I=e[0])==null?void 0:I.length)!=null?ee:0,c=n,h=l*c,f=s*c,u=He(e),d=u.col*c+c/2,S=u.row*c+c/2,x=h/2-d,T=f/2-S,E=4,v=Math.min(0,x)-E,H=Math.min(0,T)-E,D=h+Math.abs(x)+E*2,k=f+Math.abs(T)+E*2;return o.jsx("svg",{width:D,height:k,viewBox:`${v} ${H} ${D} ${k}`,className:"block-preview-svg",children:o.jsx("g",{transform:`translate(${x}, ${T})`,children:e.map((Y,G)=>Y.map((te,B)=>te?o.jsx("rect",{x:B*c+1,y:G*c+1,width:c-1,height:c-1,fill:a,stroke:"rgba(255,255,255,0.4)",strokeWidth:1,rx:4},`${G}-${B}`):null))})})}const nn="https://chipgames.github.io/ChipBlockCrush/",on=({title:e,description:t,keywords:n,url:a=nn})=>{const{t:s,language:l}=Q(),c=e!=null?e:s("seo.title"),h=t!=null?t:s("seo.description"),f=n!=null?n:s("seo.keywords"),u=l!=="ko"?`?lang=${l}`:"";return o.jsxs(xt,{children:[o.jsx("title",{children:c}),o.jsx("meta",{name:"description",content:h}),o.jsx("meta",{name:"keywords",content:f}),o.jsx("meta",{property:"og:title",content:c}),o.jsx("meta",{property:"og:description",content:h}),o.jsx("meta",{property:"og:type",content:"website"}),o.jsx("meta",{property:"og:url",content:a+u}),o.jsx("link",{rel:"canonical",href:a+u})]})};function sn(){if(typeof window=="undefined"||!("serviceWorker"in navigator))return;const e="/ChipBlockCrush/";window.addEventListener("load",()=>{navigator.serviceWorker.register(`${e}sw.js`,{scope:e}).catch(()=>{})})}const ke="chipBlockCrush_orientationLocked",rn=()=>{ut();const{t:e}=Q();i.useEffect(()=>{sn()},[]);const[t,n]=i.useState("menu"),[a,s]=i.useState(null),[l,c]=i.useState(()=>typeof window=="undefined"?!1:window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0),[h,f]=i.useState(()=>{var v;return(v=typeof window!="undefined"&&q.get(ke,{fallback:"false"})==="true")!=null?v:!1}),[u,d]=i.useState(!1),S=v=>{n(v)},x=()=>{s(1),n("game")},T=()=>{n("menu"),s(null)},E=()=>Ie(We,null,function*(){const v=screen;if(typeof window=="undefined"||!v.orientation){alert(e("header.orientationUnlock"));return}const H=v.orientation;try{if(h)yield H.unlock(),f(!1),q.set(ke,"false",{silent:!0});else{try{const I=document.documentElement;I.requestFullscreen?yield I.requestFullscreen():I.webkitRequestFullscreen&&(yield I.webkitRequestFullscreen())}catch(I){}const k=H.type.startsWith("portrait")?"portrait":"landscape";yield H.lock(k),f(!0),q.set(ke,"true",{silent:!0})}}catch(D){console.warn("í™”ë©´ ê³ ì • ì‹¤íŒ¨:",D);const k=D instanceof Error?D.message:String(D);(k.includes("not allowed")||k.includes("denied"))&&alert(e("header.orientationUnlock"))}});return i.useEffect(()=>{const v=()=>{typeof window!="undefined"&&c(window.innerWidth<=768||window.innerHeight<=768||"ontouchstart"in window||navigator.maxTouchPoints>0)};return window.addEventListener("resize",v),window.addEventListener("orientationchange",v),()=>{window.removeEventListener("resize",v),window.removeEventListener("orientationchange",v)}},[]),i.useEffect(()=>{const v=screen;if(typeof window=="undefined"||!v.orientation||!h)return;const H=v.orientation,k=H.type.startsWith("portrait")?"portrait":"landscape";H.lock(k).catch(()=>{f(!1),q.set(ke,"false",{silent:!0})})},[]),o.jsx(_t,{children:o.jsxs(kt,{children:[o.jsx(on,{}),o.jsxs("div",{className:`app-container${u?" menu-footer-hidden":""}`,children:[o.jsx(ht,{onNavigate:S,onStartGame:x,currentScreen:t}),o.jsxs(zt,{children:[t==="guide"&&o.jsx(Gt,{onNavigate:S}),t==="help"&&o.jsx(Ft,{onNavigate:S}),t==="about"&&o.jsx(Ht,{onNavigate:S}),t==="menu"&&o.jsx(Dt,{onNavigate:S,onStartGame:x}),t==="game"&&a!=null&&o.jsx(en,{stageNumber:a,onBack:T})]}),o.jsx(ft,{})]}),l&&typeof window!="undefined"&&screen.orientation?o.jsx("button",{type:"button",className:"orientation-lock-button",onClick:E,"aria-label":e(h?"header.orientationUnlock":"header.orientationLock"),title:e(h?"header.orientationUnlock":"header.orientationLock"),children:h?"ðŸ”’":"ðŸ”“"}):null,l&&o.jsx("button",{type:"button",className:"menu-footer-toggle",onClick:()=>d(v=>!v),"aria-label":e(u?"header.showMenuFooter":"header.hideMenuFooter"),title:e(u?"header.showMenuFooter":"header.hideMenuFooter"),children:u?"â˜°":"âœ•"})]})})};$e.createRoot(document.getElementById("root")).render(o.jsx(St.StrictMode,{children:o.jsx(rn,{})}))});export default ln();
